{
  "FileID":  573785173,
  "FileVersion":  8,
  "ViewPos.x":  -631,
  "ViewPos.y":  -138,
  "ScriptName":  "Mod_ExpPhysGun",
  "ScriptFileOut":  "H:\\Mod_ExpPhysGun.scr",
  "ScriptTextOut":  "H:\\Mod_ExpPhysGun.txt",
  "GraphPoint.Count":  135,
  "GraphLink.Count":  91,
  "GraphRectText.Count":  16,
  "Variables.Count":  36,
  "Stars.Count":  1,
  "Planets.Count":  3,
  "Ships.Count":  1,
  "States.Count":  6,
  "Groups.Count":  4,
  "Places.Count":  1,
  "Items.Count":  1,
  "Ethers.Count":  0,
  "Dialogs.Count":  6,
  "DialogMessages.Count":  17,
  "DialogAnswers.Count":  21,
  "Operations.Count":  22,
  "Statements.Count":  16,
  "Loops.Count":  0,
  "Visual.Objects":  
  [
    {
      "DialogAnswers":      
      [
        {
          "Type":  "TDialogAnswer",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  23,
          "#":  24,
          "Msg":  "<tstr2>",
          "AMsg.Num":  "0"        
        },
        {
          "Type":  "TDialogAnswer",
          "Name":  "exit",
          "Pos.x":  20,
          "Pos.y":  20,
          "Parent":  23,
          "#":  25,
          "Msg":  "<tstr3>",
          "AMsg.Num":  "1"        
        },
        {
          "Type":  "TDialogAnswer",
          "Name":  "exit",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  29,
          "#":  30,
          "Msg":  "<tstr2>",
          "AMsg.Num":  "2"        
        },
        {
          "Type":  "TDialogAnswer",
          "Name":  "fastexit",
          "Pos.x":  -290,
          "Pos.y":  530,
          "Parent":  -1,
          "#":  40,
          "Msg":  "Понял, конец связи",
          "AMsg.Num":  "3"        
        },
        {
          "Type":  "TDialogAnswer",
          "Name":  "",
          "Pos.x":  -160,
          "Pos.y":  670,
          "Parent":  -1,
          "#":  44,
          "Msg":  "И что же теперь делать? Неужели опускать руки и дать планете погибнуть?",
          "AMsg.Num":  "4"        
        },
        {
          "Type":  "TDialogAnswer",
          "Name":  "",
          "Pos.x":  -110,
          "Pos.y":  690,
          "Parent":  -1,
          "#":  46,
          "Msg":  "Ладно, уговорили. Ставьте свой агрегат",
          "AMsg.Num":  "5"        
        },
        {
          "Type":  "TDialogAnswer",
          "Name":  "",
          "Pos.x":  -160,
          "Pos.y":  690,
          "Parent":  -1,
          "#":  47,
          "Msg":  "Ну уж нет, не надо мне такой радости. Еще взорвется у меня на корабле, знаю я вас",
          "AMsg.Num":  "6"        
        },
        {
          "Type":  "TDialogAnswer",
          "Name":  "hangar",
          "Pos.x":  -110,
          "Pos.y":  750,
          "Parent":  -1,
          "#":  49,
          "Msg":  "Уже вылетаю!",
          "AMsg.Num":  "7"        
        },
        {
          "Type":  "TDialogAnswer",
          "Name":  "hangar",
          "Pos.x":  -160,
          "Pos.y":  750,
          "Parent":  -1,
          "#":  51,
          "Msg":  "Ничем не могу вам с этим помочь",
          "AMsg.Num":  "8"        
        },
        {
          "Type":  "TDialogAnswer",
          "Name":  "fastexit",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  63,
          "#":  64,
          "Msg":  "Конец связи",
          "AMsg.Num":  "9"        
        },
        {
          "Type":  "TDialogAnswer",
          "Name":  "",
          "Pos.x":  200,
          "Pos.y":  610,
          "Parent":  -1,
          "#":  69,
          "Msg":  "Разумеется готов!",
          "AMsg.Num":  "10"        
        },
        {
          "Type":  "TDialogAnswer",
          "Name":  "",
          "Pos.x":  180,
          "Pos.y":  520,
          "Parent":  -1,
          "#":  70,
          "Msg":  "Мы все погибнем! Надо бежать! КОНЕЦ БЛИЗОК!",
          "AMsg.Num":  "11"        
        },
        {
          "Type":  "TDialogAnswer",
          "Name":  "hangar",
          "Pos.x":  230,
          "Pos.y":  580,
          "Parent":  -1,
          "#":  72,
          "Msg":  "Уже бегу!",
          "AMsg.Num":  "12"        
        },
        {
          "Type":  "TDialogAnswer",
          "Name":  "hangar",
          "Pos.x":  110,
          "Pos.y":  600,
          "Parent":  -1,
          "#":  76,
          "Msg":  "Сматываемся отсюда!",
          "AMsg.Num":  "13"        
        },
        {
          "Type":  "TDialogAnswer",
          "Name":  "planet",
          "Pos.x":  270,
          "Pos.y":  630,
          "Parent":  -1,
          "#":  88,
          "Msg":  "Нет, я уже ухожу",
          "AMsg.Num":  "14"        
        },
        {
          "Type":  "TDialogAnswer",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  94,
          "#":  95,
          "Msg":  "Всегда хотел оставить свой след в истории! Новое имя планеты... дайте-ка подумать...",
          "AMsg.Num":  "15"        
        },
        {
          "Type":  "TDialogAnswer",
          "Name":  "planet",
          "Pos.x":  330,
          "Pos.y":  630,
          "Parent":  -1,
          "#":  96,
          "Msg":  "Проследовать на банкет",
          "AMsg.Num":  "16"        
        },
        {
          "Type":  "TDialogAnswer",
          "Name":  "planet",
          "Pos.x":  20,
          "Pos.y":  20,
          "Parent":  94,
          "#":  98,
          "Msg":  "Благодарю за оказаную честь, но я не могу себе такого позволить... А от банкета не откажусь!",
          "AMsg.Num":  "17"        
        },
        {
          "Type":  "TDialogAnswer",
          "Name":  "restart",
          "Pos.x":  -290,
          "Pos.y":  690,
          "Parent":  -1,
          "#":  102,
          "Msg":  "Ну, давайте сюда свою пукалку. Только учтите, если и она попытается меня взорвать, то я сюда вернусь!",
          "AMsg.Num":  "18"        
        },
        {
          "Type":  "TDialogAnswer",
          "Name":  "restart",
          "Pos.x":  -230,
          "Pos.y":  690,
          "Parent":  -1,
          "#":  103,
          "Msg":  "Нет уж, спасибо. Не надо мне такого счастья. Не доверяю я теперь этим вашим экспериментальным технологиям",
          "AMsg.Num":  "19"        
        },
        {
          "Type":  "TDialogAnswer",
          "Name":  "planet",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  126,
          "#":  127,
          "Msg":  "Рад, что вам тоже понравилось :-)",
          "AMsg.Num":  "20"        
        }      
      ],
      "DialogMessages":      
      [
        {
          "Type":  "TDialogMsg",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  40,
          "Parent":  22,
          "#":  23,
          "Msg":  "<tstr1>",
          "DMsg.Num":  "0"        
        },
        {
          "Type":  "TDialogMsg",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  32,
          "#":  29,
          "Msg":  "<tstr1>",
          "DMsg.Num":  "1"        
        },
        {
          "Type":  "TDialogMsg",
          "Name":  "",
          "Pos.x":  -290,
          "Pos.y":  490,
          "Parent":  -1,
          "#":  39,
          "Msg":  "Внимание, рейнджер <Player>! Немедленно прекратите атаку на планетоид и как можно скорее прибудьте на технологический центр <QuestTC_Name>! Это дело первостепенной важности!",
          "DMsg.Num":  "2"        
        },
        {
          "Type":  "TDialogMsg",
          "Name":  "",
          "Pos.x":  -160,
          "Pos.y":  650,
          "Parent":  -1,
          "#":  43,
          "Msg":  "Рейнджер <Player>, наконец-то вы прибыли! Мы боялись, что вы пропустите наше сообщение или не предадите ему значения, особенно учитывая насколько важным делом вы были заняты. Но все дело в том, что ваши попытки сбить данный планетоид ни к чему не приведут, он обладает слишком необычной структурой, стандартное бортовое вооружение просто не в состоянии нанести ему хоть сколько-нибудь существенный урон.",
          "DMsg.Num":  "3"        
        },
        {
          "Type":  "TDialogMsg",
          "Name":  "",
          "Pos.x":  -140,
          "Pos.y":  670,
          "Parent":  -1,
          "#":  45,
          "Msg":  "Что вы, разумеется нет... Позвольте, я вам объясню: дело в том, что внутренняя структура данного космического тела представляет собой огромный кристалл. Плотность этого кристалла невероятно высока и все, что сможет ему сделать наше стандартное вооружение - уничтожить верхний слой, состоящий из мягких горных пород и водяного льда, и слегка поцарапать сердцевину. Однако путь есть и он состоит в том, чтобы разбить кристалл. Достаточно всего нескольких точных ударов большой мощности. Приложить, так сказать, достаточно кинетической энергии, на достаточно малой площади и к счастью мы уже придумали, как это сделать. Нужно запустить в нашего Разрушителя, именно так мы его тут называем, другой астероид, точнее несколько...<br>Не надо смотреть на меня как на умалишенного, это действительно можно сделать. Слышали когда-нибудь о физических устройствах направленной антигравитации? В просторечье физганах? Эти устройства были изобретены знаменитым гаальским инженером Рее-Кляйном и используются сейчас для погрузочных работ. Мы же увеличили энергетическое ядро физгана и добавили ему стазисный генератор нулевой энергии, естественно это привело к увеличению устройства и невозможности его ручного использования, зато резко увеличили максимальную массу объектов, которые он может перемещать, а создание вокруг перемещаемого объекта энергетического стазиса защищает его от любых повреждений. Короче говоря - представляем вам первую экспериментальную модель <clr>Бортового физгана<clrEnd>. Он способен захватывать объекты размером со стандартный астероид и помещать их в стазис под днищем корабля, а когда вам понадобиться, достаточно направить физган в нужную сторону и отключить стазис - большое количество энергии, до тех пор изолируемое от объекта с помощью стазиса, войдет в свои права и придаст объекту огромное ускорение. К сожалению это делает бортовой физган совершенно несостоятельным как устройство для перемещения грузов, зато делает его полезным в качестве оружия, чем вам и необходимо воспользоваться, если вы конечно согласитесь. Как я уже сказал - это первая экспериментальная модель. Возможны... форс-мажоры... Но учтите, если вы откажетесь - это может стать причиной гибели целой планеты.",
          "DMsg.Num":  "4"        
        },
        {
          "Type":  "TDialogMsg",
          "Name":  "",
          "Pos.x":  -110,
          "Pos.y":  730,
          "Parent":  -1,
          "#":  48,
          "Msg":  "Отлично, мы уже перенесли физган в ваш трюм. Как только взлетите, ищите ближайший астероид, подлетите к нему и используйте встроенный в физган захват, чтобы поймать его. После чего запустите импровизированный снаряд в Разрушителя, вот собственно и все. Ничего сложного, но время поджимает, так что поторопитесь!",
          "DMsg.Num":  "5"        
        },
        {
          "Type":  "TDialogMsg",
          "Name":  "",
          "Pos.x":  -160,
          "Pos.y":  730,
          "Parent":  -1,
          "#":  50,
          "Msg":  "Ну что же... Это ваше право. К сожалению, мы вряд ли теперь успеем найти кого-нибудь еще... Боюсь, жителям планеты <Name(TargetPlanet)> теперь остается рассчитывать только на скорейшую эвакуацию... Если честно - я разочарован в вас <Player>.",
          "DMsg.Num":  "6"        
        },
        {
          "Type":  "TDialogMsg",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  83,
          "#":  63,
          "Msg":  "Мне сейчас некогда общаться, <Player>. Я провожу эвакуацию населения с планеты <Name(TargetPlanet)>, которая находиться под угрозой столкновения с астероидом. Нужно вывести от туда как можно больше жителей, ни секунды нет, чтобы передохнуть.",
          "DMsg.Num":  "7"        
        },
        {
          "Type":  "TDialogMsg",
          "Name":  "",
          "Pos.x":  200,
          "Pos.y":  520,
          "Parent":  -1,
          "#":  67,
          "Msg":  "Рейнджер <Player>! Наконец-то адекватное лицо. Вы просто представить себе не можете, что тут творится. Все наши попытки не допустить паники потерпели сокрушительное фиаско! В космопорте гигантские толпы беженцев, все наши транспортники работают на пределе, но всех вывезти мы все равно не успеем.\r\nНарод уже дошел до предела, бегают повсюду с плакатами на тему нашего незавидного будущего, а точнее его отсутствия. Из всех щелей повылезали фанатики, зачитывающие такие места из религиозных текстов, что мне самому становится не по себе, и я уже не говорю про мародеров... Словом - ад, такое впечатление, что астероид уже в нас врезался. Не помню такого бардака с тех времен, когда широкая общественность впервые услышала о доминаторах.\r\nТак или иначе, у нас тут объявлено чрезвычайное положение и нам бы очень пригодилась ваша помощь. Астероид необходимо уничтожить и за это мы уже назначили крупную награду, вы готовы нам помочь?",
          "DMsg.Num":  "8"        
        },
        {
          "Type":  "TDialogMsg",
          "Name":  "",
          "Pos.x":  230,
          "Pos.y":  610,
          "Parent":  -1,
          "#":  71,
          "Msg":  "Отлично! Покажите там этой каменюке! Вдарьте всей мощью, что у вас есть! Да и еще кое-что: как я уже говорил мы проводим эвакуацию, однако она и гроша ломанного не будет стоить, если на наши лайнеры нападут пираты, а ведь они могут. Очень вас прошу, если у вас будет возможность, постарайтесь защитить наши эвакуационные лайнеры, в случае чего. А теперь идите... Скорее, <Player>, наша жизнь сейчас в ваших руках... Еще в руках других пилотов, что сейчас пытаются сбить астероид, но это не повод расслабляться! Вперед!",
          "DMsg.Num":  "9"        
        },
        {
          "Type":  "TDialogMsg",
          "Name":  "",
          "Pos.x":  180,
          "Pos.y":  560,
          "Parent":  -1,
          "#":  75,
          "Msg":  "И вы туда же? Проклятье, скоро с этим астероидом вообще нормальных гуманоидов не останется. Ну тогда проваливайте, хватит отнимать мое время! Единственная просьба: когда будете убегать, словно крыса с тонущего корабля, хотя бы захватите с собой кого-нибудь из местных. Хотя бы чуть-чуть облегчите мою задачу.",
          "DMsg.Num":  "10"        
        },
        {
          "Type":  "TDialogMsg",
          "Name":  "",
          "Pos.x":  110,
          "Pos.y":  560,
          "Parent":  -1,
          "#":  78,
          "Msg":  "Опять вы?! У меня нет времени слушать ваши апокалиптические бредни! Я пытаюсь как-то организовать то недоразумение, что у нас называют эвакуацией, и вы мне тут совсем не помогаете. Проваливайте.",
          "DMsg.Num":  "11"        
        },
        {
          "Type":  "TDialogMsg",
          "Name":  "",
          "Pos.x":  230,
          "Pos.y":  520,
          "Parent":  -1,
          "#":  80,
          "Msg":  "Вы что все еще здесь? На нас все еще летит самый большой астероид в истории коалиции, у нас действительно нет времени на праздные разговоры. Отправляйтесь в космос и уничтожьте уже эту чертову каменюгу!",
          "DMsg.Num":  "12"        
        },
        {
          "Type":  "TDialogMsg",
          "Name":  "",
          "Pos.x":  270,
          "Pos.y":  560,
          "Parent":  -1,
          "#":  87,
          "Msg":  "А, это вы, <Player>... а вы чего хотите? Награду за уничтожение астероида? Ну ладно, так уж и быть. Спасибо! Похоже вы чем-то недовольны, придётся добавить лично от себя... БОЛЬШОЕ СПАСИБО!!!\r\nМы всё видели, астероид развалился сам по себе так и не долетев до нашей планеты. А паники то сколько было! Вам ещё что-то надо?",
          "DMsg.Num":  "13"        
        },
        {
          "Type":  "TDialogMsg",
          "Name":  "",
          "Pos.x":  330,
          "Pos.y":  540,
          "Parent":  -1,
          "#":  91,
          "Msg":  "Вот вы где! Наш герой и спаситель рейнджер <Player>! Я бы расцеловал вас, но боюсь меня могут не правильно понять. Мы вас уже тут заждались! Банкет в вашу честь уже подготовлен, но это не самое главное... Что? А награда! Конечно, как я мог забыть! Сумма в <int1> cr. уже переведена на ваш счет, точно также как и наша бесконечная благодарность!\r\n<tstr1>",
          "DMsg.Num":  "14"        
        },
        {
          "Type":  "TDialogMsg",
          "Name":  "",
          "Pos.x":  -290,
          "Pos.y":  670,
          "Parent":  -1,
          "#":  101,
          "Msg":  "Вы спасли целую планету! Мы видели, как это произошло. Было так круто! Вы запускаете свой астероид прямо по Разрушителю, и он раскалывается на мелкие кусочки! У нас тут столько народу хотят взять у вас автограф! Что говорите? Физган взорвался от перегрузки? Ну, бывает, это ведь первая экспериментальная модель была. Так вы дадите мне автограф? Ну ладно, ладно, не надо на меня так смотреть...\r\nВ качестве извинения за инцидент с поломкой мы хотим предложить вам обновленную версию физгана. Защитные механизмы были значительно усовершенствованы, так что теперь мы можем гарантировать, что никаких взрывов от перегрузки не будет… Ну по крайней мере в <clr>99%<clrEnd> случаев... В <clr>98%<clrEnd> так точно... Ну может быть в <clr>97%<clrEnd>...\r\nКроме того, мы оборудовали новую модель удобным приемником, позволяющим заряжать её прямо <clr>изнутри корабля<clrEnd>. Собственно, вы и раньше могли это делать, просто это было бы не так удобно... А я что, не говорил вам? Ну значит забыл. Так вот, заряжать вы его можете практически чем угодно. Абсолютно все, что есть у вас в трюме, может быть использовано в качестве снаряда для физгана. Разумеется, возможность захватывать астероиды тоже никуда не делась. Единственное, что нам так и не удалось - это добавить совместимость с микромодулями. Уж слишком нетипичное в плане применения устройство, так сказать.\r\nНу, что скажете?",
          "DMsg.Num":  "15"        
        },
        {
          "Type":  "TDialogMsg",
          "Name":  "",
          "Pos.x":  20,
          "Pos.y":  0,
          "Parent":  99,
          "#":  126,
          "Msg":  "Ого! А вы затейник, <Player>. Замечательное название подобрали нашей планете.\r\nЧтобы утрясти все бюрократические формальности нам потребуется где-то ещё неделька. Но не сомневайтесь, жители планеты <addRew> уже приняли своё твёрдое решение!",
          "DMsg.Num":  "16"        
        }      
      ],
      "Dialogs":      
      [
        {
          "Type":  "TDialog",
          "Name":  "QuestBeginDialog",
          "Pos.x":  -130,
          "Pos.y":  430,
          "Parent":  -1,
          "#":  22        
        },
        {
          "Type":  "TDialog",
          "Name":  "TCSpaceDialog",
          "Pos.x":  -290,
          "Pos.y":  460,
          "Parent":  -1,
          "#":  38        
        },
        {
          "Type":  "TDialog",
          "Name":  "TCPhysGunDialog",
          "Pos.x":  -160,
          "Pos.y":  630,
          "Parent":  -1,
          "#":  42        
        },
        {
          "Type":  "TDialog",
          "Name":  "EvacTalk",
          "Pos.x":  300,
          "Pos.y":  310,
          "Parent":  -1,
          "#":  62        
        },
        {
          "Type":  "TDialog",
          "Name":  "TargetPlanetDialog",
          "Pos.x":  230,
          "Pos.y":  450,
          "Parent":  -1,
          "#":  65        
        },
        {
          "Type":  "TDialog",
          "Name":  "TCFinalDialog",
          "Pos.x":  -290,
          "Pos.y":  640,
          "Parent":  -1,
          "#":  100        
        }      
      ],
      "Groups":      
      [
        {
          "Type":  "TGroup",
          "Name":  "PlayerGroup",
          "Pos.x":  100,
          "Pos.y":  190,
          "Parent":  -1,
          "#":  3,
          "Owner":  62,
          "Group.Type":  126,
          "CntShipMin":  1,
          "CntShipMax":  1,
          "SpeedMin":  100,
          "SpeedMax":  10000,
          "Weapon":  0,
          "CargoHook":  0,
          "EmptySpace":  0,
          "AddPlayer":  true,
          "StatusTraderMin":  0,
          "StatusTraderMax":  100,
          "StatusWarriorMin":  0,
          "StatusWarriorMax":  100,
          "StatusPirateMin":  0,
          "StatusPirateMax":  100,
          "DistSearch":  10000,
          "Dialog":  -1,
          "StrengthMin":  "0",
          "StrengthMax":  "0",
          "Ruins":  ""        
        },
        {
          "Type":  "TGroup",
          "Name":  "Asteroid",
          "Pos.x":  240,
          "Pos.y":  170,
          "Parent":  -1,
          "#":  14,
          "Owner":  62,
          "Group.Type":  33554433,
          "CntShipMin":  0,
          "CntShipMax":  0,
          "SpeedMin":  100,
          "SpeedMax":  10000,
          "Weapon":  0,
          "CargoHook":  0,
          "EmptySpace":  0,
          "AddPlayer":  false,
          "StatusTraderMin":  0,
          "StatusTraderMax":  100,
          "StatusWarriorMin":  0,
          "StatusWarriorMax":  100,
          "StatusPirateMin":  0,
          "StatusPirateMax":  100,
          "DistSearch":  10000,
          "Dialog":  -1,
          "StrengthMin":  "0",
          "StrengthMax":  "0",
          "Ruins":  ""        
        },
        {
          "Type":  "TGroup",
          "Name":  "EvacShips",
          "Pos.x":  200,
          "Pos.y":  260,
          "Parent":  -1,
          "#":  55,
          "Owner":  62,
          "Group.Type":  126,
          "CntShipMin":  0,
          "CntShipMax":  0,
          "SpeedMin":  100,
          "SpeedMax":  10000,
          "Weapon":  0,
          "CargoHook":  0,
          "EmptySpace":  0,
          "AddPlayer":  false,
          "StatusTraderMin":  0,
          "StatusTraderMax":  100,
          "StatusWarriorMin":  0,
          "StatusWarriorMax":  100,
          "StatusPirateMin":  0,
          "StatusPirateMax":  100,
          "DistSearch":  10000,
          "Dialog":  -1,
          "StrengthMin":  "0",
          "StrengthMax":  "0",
          "Ruins":  ""        
        },
        {
          "Type":  "TGroup",
          "Name":  "PlanetDefenders",
          "Pos.x":  50,
          "Pos.y":  260,
          "Parent":  -1,
          "#":  56,
          "Owner":  62,
          "Group.Type":  126,
          "CntShipMin":  0,
          "CntShipMax":  0,
          "SpeedMin":  100,
          "SpeedMax":  10000,
          "Weapon":  0,
          "CargoHook":  0,
          "EmptySpace":  0,
          "AddPlayer":  false,
          "StatusTraderMin":  0,
          "StatusTraderMax":  100,
          "StatusWarriorMin":  0,
          "StatusWarriorMax":  100,
          "StatusPirateMin":  0,
          "StatusPirateMax":  100,
          "DistSearch":  10000,
          "Dialog":  -1,
          "StrengthMin":  "0",
          "StrengthMax":  "0",
          "Ruins":  ""        
        }      
      ],
      "Items":      
      [
        {
          "Type":  "TItem",
          "Name":  "PhysGunPrototype",
          "Pos.x":  -200,
          "Pos.y":  30,
          "Parent":  -1,
          "#":  54,
          "Class":  5,
          "Item.Type":  0,
          "Size":  10,
          "Level":  1,
          "Radius":  150,
          "Owner":  6,
          "Useless":  ""        
        }      
      ],
      "Operations":      
      [
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  40,
          "Pos.y":  -40,
          "Parent":  -1,
          "#":  5,
          "Total.Lines":  23,
          "Code.Type":  "Global",
          "Code":          
          [
              "//GExpPhysGunGlobalState >= 0 - число запусков данного скрипта (при запуске может быть сброшен игроком)",
              "//GExpPhysGunGlobalState == -3 - астероид успешно уничтожен, квест завершён",
              "//GExpPhysGunGlobalState == -4 - астероид врезался в планету, все погибли, квест завершён",
              "//Если не выставлен маркер о завершении квеста",
              "if(GExpPhysGunGlobalState >= 0)",
              "{",
              "    //Скрипт стартует не раньше, чем через 5 лет от начала игры",
              "    if(CurTurn() >= 2125)",
              "    {",
              "        //Попытка запуска скрипта происходит не чаще чем раз в 10 ходов и только в момент выхода игрока из гипера (влёта в систему)",
              "        if(GRunFrom == 3)",
              "        {",
              "            if(CurTurn() - GLastTurnRun(GScriptName) > 10)",
              "            {",
              "                //У игрока в слоте также должен быть установлен радар",
              "                if(ShipEqInSlot(Player(), t_Radar))",
              "                {",
              "                    GRun();",
              "                }",
              "            }",
              "        }",
              "    }",
              "}"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  20,
          "Pos.y":  0,
          "Parent":  5,
          "#":  6,
          "Total.Lines":  88,
          "Code.Type":  "Init",
          "Code":          
          [
              "dialogVar = -1;",
              "//Для тестирования можно выставить значение меньше 1200 (или закоментить следующие условие), это влияет на дальность стартовой позиции астероида",
              "if(PlanetOrbitRadius(TargetPlanet) < 1200)",
              "{",
              "    questState = -2;",
              "    exit;",
              "}",
              "//Если игрок имеет слишком медленный корабль, отменяем запуск скрипта",
              "if(ShipSpeed(Player()) < 800)",
              "{",
              "    questState = -2;",
              "    exit;",
              "}",
              "//Если в системе нет ТЦ, отменяем запуск скрипта",
              "if(!StarRuins(ScriptStar, 'TC'))",
              "{",
              "    questState = -2;",
              "    exit;",
              "}",
              "else",
              "{",
              "    QuestTC_Id = Id(StarRuins(ScriptStar, 'TC'));",
              "    QuestTC_Name = ShipName(StarRuins(ScriptStar, 'TC'));",
              "    //Определяем верхний лимит популяции на планете, которой угрожает астероид",
              "    //1000 единиц популяции соответствует в игре миллиону человек, а не тысяче",
              "    //MaxTargetPlanetPopulation = round(PortionInDiapason(PlanetSize(TargetPlanet), 60, 100, 100000, 1000000));",
              "}",
              "",
              "function AsteroidActCode()",
              "{",
              "    //if(ScriptItemActionType(t_OnStep))",
              "    //{",
              "    //Астероид находится всего в одном дне от столкновения с планетой",
              "    if(moveState == 6)",
              "    {",
              "        dword asteroid = ScriptItemActShip();",
              "        if(asteroid)",
              "        {",
              "            if(GroupIn(Asteroid, TargetRadius))",
              "            {",
              "                //Чтобы боты перестали стрелять по астероиду в \"момент столкновения\"",
              "                for(int i = 0; i < StarShips(ScriptStar); i = i + 1)",
              "                {",
              "                    dword ship = StarShips(ScriptStar, i);",
              "                    if(!RelationToShip(ship, asteroid)) TruceBetweenShips(ship, asteroid);",
              "                }",
              "",
              "                //Рисуем взрыв на планете в которую \"попал астероид\"",
              "                if(ShipInNormalSpace(Player()))",
              "                {",
              "                    if(ShipStar(Player()) == ScriptStar)",
              "                    {",
              "                        ShowEffect('Weapon.MissileHit', 32, TargetPlanet, TargetPlanet, 0, 0, 0, 0, 0, 0);",
              "                        //Повышаем громкость",
              "                        FilmSound('Sound.KillerAsteroidCrashed', TargetPlanet);",
              "                        FilmSound('Sound.expl1', TargetPlanet);",
              "                        FilmSound('Sound.expl1', TargetPlanet);",
              "                        FilmSound('Sound.expl1', TargetPlanet);",
              "                        FilmSound('Sound.expl2', TargetPlanet);",
              "                        FilmSound('Sound.expl2', TargetPlanet);",
              "                        FilmSound('Sound.expl2', TargetPlanet);",
              "                        FilmSound('Sound.expl2', TargetPlanet);",
              "                        FilmSound('Sound.expl2', TargetPlanet);",
              "                        FilmSound('Sound.expl2', TargetPlanet);",
              "                        FilmSound('Sound.expl2', TargetPlanet);",
              "                        FilmSound('Sound.expl5', TargetPlanet);",
              "                        FilmSound('Sound.expl5', TargetPlanet);",
              "                        FilmSound('Sound.expl5', TargetPlanet);",
              "                        FilmSound('Sound.expl5', TargetPlanet);",
              "                        FilmSound('Sound.expl5', TargetPlanet);",
              "                        FilmSound('Sound.expl5', TargetPlanet);",
              "                    }",
              "                }",
              "",
              "                //Типа от столкновения планета аж замедлила вращение вокруг звезды, лол",
              "                PlanetOrbitalVelocity(TargetPlanet, 5);//max(PlanetOrbitalVelocity(TargetPlanet) - 10, 5));",
              "",
              "                //Ставим маркеры, о том что астероид врезался в планету и все погибли :С",
              "                questState = 10; //Маркер для последующего завершения скрипта через",
              "                moveState = 7; //Маркер попадания астероида в планету (триггерит код гибели планеты в тёрне)",
              "                dialogVar = -3; //Маркер завершения всех диалогов (даже если игрок ни разу ни с кем не говорил и вообще забил на астероид)",
              "                GExpPhysGunGlobalState = -4;",
              "                ShipDestroy(asteroid, 1);",
              "            }",
              "        }",
              "    }",
              "    //}",
              "}"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  25,
          "#":  28,
          "Total.Lines":  16,
          "Code.Type":  "Turn",
          "Code":          
          [
              "//Число запусков скрипта +1",
              "GExpPhysGunGlobalState = GExpPhysGunGlobalState + 1;",
              "//Квест временно отменяется (но позднее игрок всё равно сможет его начать)",
              "questState = -2;",
              "",
              "//Прячем астероид на планету и уничтожаем",
              "asteroid = GroupToShip(Asteroid);",
              "if(asteroid)",
              "{",
              "    OrderNone(asteroid);",
              "    TransferShip(asteroid, PlanetNone);",
              "    ShipDestroy(asteroid, 1);",
              "    ShipOut(asteroid);",
              "}",
              "",
              "ShipOut(Player());"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  -20,
          "Pos.y":  0,
          "Parent":  30,
          "#":  31,
          "Total.Lines":  2,
          "Code.Type":  "Turn",
          "Code":          
          [
              "OrderFollowShip(Player(), asteroid, 1);",
              "AutoBattle(asteroid);"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  24,
          "#":  32,
          "Total.Lines":  50,
          "Code.Type":  "Turn",
          "Code":          
          [
              "//Накладываем на астероид инфошку бессмертия (только физган будет наносить урон)",
              "asteroid = GroupToShip(Asteroid);",
              "",
              "ShipAddCustomShipInfo(asteroid, 'ExpPhysGun_ImmortalAsteroid');",
              "NoTalkToShip(asteroid, 1);",
              "NoScanToShip(asteroid, 1);",
              "//Запрет на дроп вещей (не глобальный, иначе потом не выпадут минералы)",
              "for(i = 0; i < ShipItems(asteroid); i = i + 1) NoDropItem(ShipItems(asteroid, i), 1);",
              "//Запрещаем всем другим NPC нападать на астероид (всем кроме доминаторов, естественно)",
              "NoTargetToShip(asteroid, 2);",
              "",
              "//Добавляем кучу ценной руды и минералов в дроп к астероиду",
              "for(i = 1; i <= RndObject(7, 10, asteroid); i = i + 1)",
              "{",
              "    cur_item = CreateCustomCountableItem('NuggetAsteroid', RndObject(35, 70, asteroid), 1);",
              "    ItemCost(cur_item, ItemCost(cur_item) * (GoodsBuyPrice(TargetPlanet, t_Minerals) * 7));",
              "    ShipAddDropItem(asteroid, cur_item);",
              "}",
              "for(i = 1; i <= RndObject(4, 7, asteroid); i = i + 1)",
              "{",
              "    cur_item = CreateGoods(t_Minerals, RndObject(35, 70, asteroid), 1);",
              "    ShipAddDropItem(asteroid, cur_item);",
              "}",
              "",
              "//Центрируем камеру на астероиде",
              "StarMapCenterView(CoordX(asteroid), CoordY(asteroid));",
              "ShipSetBad(asteroid, Player());",
              "",
              "//Выставляем маркер начала эвакуации (прирост населения эвакуируемой планеты будет остановлен)",
              "EvacInProcess = PlanetPopulation(TargetPlanet);",
              "//На время квеста блокируем все атаки доминаторов на систему",
              "NoComeKlingToStar(ScriptStar, 1);",
              "",
              "//Выводим уведомление о задании, добавляем текст о приближении астероида к планете",
              "tstr1 = '</color>' + Format(CT('Script.Mod_ExpPhysGun.WholePlanetInDanger'),",
              "        '<AsteroidNumber'+'>', AsteroidNumber,",
              "        '<PlanetName'+'>', Name(TargetPlanet), '255,240,100');",
              "Ether(3, 'ExpPhysGun_QuestEther', tstr1, asteroid);",
              "questState = 2;",
              "",
              "tstr1 = '</color>' + Format(CT('Script.Mod_ExpPhysGun.AsteroidDetected'),",
              "        '<AsteroidNumber'+'>', AsteroidNumber,",
              "        '<AsteroidSpeed'+'>', ShipSpeed(asteroid),",
              "        '<AsteroidCoordX'+'>', CoordX(asteroid),",
              "        '<AsteroidCoordY'+'>', CoordY(asteroid),",
              "        '<AsteroidDirection'+'>', abs((360 - (ShipAngle(asteroid) - 90)) % 360),",
              "        '<ChanceToHit'+'>', RndObject(75, 85, asteroid),",
              "        '<PlanetName'+'>', Name(TargetPlanet));",
              "tstr2 = '</color>' + Format(CT('Script.Mod_ExpPhysGun.PlayerLockOnAsteroid'),",
              "        '<PlanetName'+'>', Name(TargetPlanet));"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  125,
          "#":  33,
          "Total.Lines":  367,
          "Code.Type":  "Turn",
          "Code":          
          [
              "//Обеспечиваем \"Враждебное\" отношение астероида к игроку (потому что \"Отличное\" выглядит тупее)",
              "if(GroupToShip(Asteroid)) ShipSetBad(GroupToShip(Asteroid), Player());",
              "",
              "//Каждый день, пока идёт эвакуация, компенсируем прирост населения эвакуируемой планеты",
              "if(EvacInProcess)",
              "{",
              "    PlanetPopulation(TargetPlanet, EvacInProcess); //В переменную EvacInProcess из стейтов \"эвакуаторов\" записывается обновлённое значение населения",
              "",
              "    //Можно считать по оригинальным формулам, а можно тупо запомнить число населения на момент начала эвакуации",
              "    //if(EvacInProcess < CurTurn())",
              "    //{",
              "        //Используем оригинальную игровую формулу для расчёта сегодняшнего прироста населения планеты",
              "        //1000 единиц популяции соответствует в игре миллиону человек, а не тысяче",
              "        //300 - константа прироста населения при превышении доступного для планеты лимита",
              "    //    flt0 = PlanetPopulation(TargetPlanet);",
              "    //    if(flt0 > MaxTargetPlanetPopulation) PlanetPopulation(TargetPlanet, round(flt0 - 300));",
              "    //    else PlanetPopulation(TargetPlanet, round(flt0 / 0.02));",
              "        //Делаем пометку, что за текущий ход убыль населения уже обеспечили",
              "    //    EvacInProcess = CurTurn();",
              "    //}",
              "}",
              "",
              "//Скрипт успешно стартовал, начинаем расчёт координат, скоростей, орбит и т.д.",
              "if(!questState)",
              "{",
              "    //Код транка-астероида",
              "    //Создаём транк-астероид и выставляем ему нужные параметры/координаты",
              "    asteroid = BuyTranclucator(PlanetNone);",
              "    //Меняем некоторые параметры для выставления нужной скорости",
              "",
              "    //Удаляем все предметы кроме двигателя/бака/корпуса",
              "    for(i = ShipItems(asteroid) - 1; i > 0; i = i - 1)",
              "    {",
              "        cur_item = ShipItems(asteroid, i);",
              "        if(!ItemIsInUse(cur_item) || ItemType(cur_item) >= t_Weapon1) FreeItem(GetItemFromShip(asteroid, cur_item));",
              "        else",
              "        {",
              "            tint1 = ItemType(cur_item);",
              "            if(tint1 >= t_Hull && tint1 <= t_Engine)",
              "            {",
              "                if(tint1 == t_Engine) SetEquipmentStats(cur_item, RndObject(103, 131, asteroid), 0);",
              "                else continue;",
              "            }",
              "            else FreeItem(GetItemFromShip(asteroid, cur_item));",
              "        }",
              "    }",
              "    //Выставляем размер корпуса в зависимости от уровня сложности настройки удачи",
              "    ItemSize(ShipEqInSlot(asteroid, t_Hull), 900 * (GalaxyDiffLevels(7) / 50) + RndObject(125, 250, asteroid));",
              "    HullHP(asteroid, ItemSize(ShipEqInSlot(asteroid, t_Hull)));",
              "    //Выставляем ТУ корпуса 6, так как при данном ТУ сопротивление ракетам (и всем остальным типам) равно 100",
              "    cur_item = ShipEqInSlot(asteroid, t_Hull);",
              "    ItemLevel(cur_item, 6);",
              "    //Обнуляем броню корпуса",
              "    SetEquipmentStats(cur_item, 0, 0);",
              "    //Накладываем штраф к массе корабля в 20%, для нужного коэффициента скорости",
              "    //ShipSpecialBonuses(asteroid, bonMass, 20);",
              "    ShipRepairEq(asteroid);",
              "    //Выставляем транклюкатору кастомный тип",
              "    ShipType(asteroid, 'KillerAsteroid');",
              "    AsteroidNumber = RndObject(333, 999, asteroid); //Позже используется для вывода названия астероида в уведомлениях",
              "    SetName(asteroid, ' -<color=255,240,100>' + AsteroidNumber + '</color>-');",
              "    //Меняем скин на астероид",
              "    Chameleon(asteroid, 'Ship.Akrin.KillerAsteroid');",
              "    ShipCalcParam(asteroid);",
              "    ShipJoin(Asteroid, asteroid);",
              "    //Чтобы из астероида выбивались белые цифры урона",
              "    ShipCustomFaction(asteroid, 'Asteroid');",
              "",
              "    //Выставляем астероиду начальные координаты и координаты движения для последующего пересечения с планетой",
              "    int turnsToCrash = RndObject(37, 45, ScriptStar); //Через сколько ходов произойдёт столкновение",
              "",
              "    float omega = pi * PlanetOrbitalVelocity(TargetPlanet) / 1800.0;",
              "    float planetX0 = CoordX(TargetPlanet);",
              "    float planetY0 = CoordY(TargetPlanet);",
              "    float phi = omega * turnsToCrash;",
              "    float planetX1 = planetX0 * cos(phi) - planetY0 * sin(phi);",
              "    float planetY1 = planetY0 * cos(phi) + planetX0 * sin(phi);",
              "    float nx = -planetY1;",
              "    float ny =  planetX1;",
              "",
              "    if(omega < 0)",
              "    {",
              "        nx = -nx;",
              "        ny = -ny;",
              "    }",
              "",
              "    float l = sqrt(nx * nx + ny * ny);",
              "    nx = nx / l;",
              "    ny = ny / l;",
              "    float dx = nx * ShipSpeed(asteroid) * turnsToCrash;",
              "    float dy = ny * ShipSpeed(asteroid) * turnsToCrash;",
              "    float shipStartX = planetX1 + dx;",
              "    float shipStartY = planetY1 + dy;",
              "    float shipOrderX = planetX1 - dx;",
              "    float shipOrderY = planetY1 - dy;",
              "",
              "    turnStart = CurTurn();",
              "    //На каком ходу произойдёт столкновение с планетой",
              "    turnCrash = CurTurn() + turnsToCrash;",
              "",
              "    TransferShip(asteroid, ScriptStar);",
              "    ShipSetCoords(asteroid, shipStartX, shipStartY);",
              "    OrderMove(asteroid, shipOrderX, shipOrderY);",
              "    OrderLock(asteroid, 1);",
              "",
              "    //Квест начинается",
              "    moveState = 1;",
              "    questState = 1;",
              "}",
              "//Если условия в системе оказались неподходящими для запуска квеста (проверяется в инит-коде), завершаем скрипт",
              "else if(questState == -2)",
              "{",
              "    ShipOut(Player());",
              "    exit;",
              "}",
              "//Код этапов запущенного квеста",
              "else if(questState > 1)",
              "{",
              "    asteroid = GroupToShip(Asteroid);",
              "",
              "    //Создаём лайнеры и военных",
              "    if(questState == 2)",
              "    {",
              "        questState = 3;",
              "        questVar = 0;",
              "        dialogVar = 0;",
              "",
              "        if(ShipStar(Player()) == ScriptStar)",
              "        {",
              "            Sound('Sound.NewMsg');",
              "            CustomEther('GalaxyAlert', 7, 'ExpPhysGun_AsteroidComing', \"Требуется помощь всех свободных пилотов! СРОЧНО! ВСЕМ КОРАБЛЯМ!<br>Чрезвычайная ситуация в системе <Name(ScriptStar)>! Планета <Name(TargetPlanet)> в большой опасности!<br>Повторяю: Требуется помощь всех свободных пилотов! СРОЧНО! ВСЕМ КОРАБЛЯМ! Чрезвычайная ситуация в системе...\");",
              "        }",
              "",
              "        AddPlanetNews(\"Поступила информация, что в системе <Name(ScriptStar)> обнаружен астероид рекордных размеров. К несчастью, траектория полета астероида с большой вероятностью пересечется с планетой <Name(TargetPlanet)>, на которой сейчас объявлен режим чрезвычайного положения. В случае столкновения ни системы планетарной защиты, ни подземные убежища не смогут уберечь жителей планеты. Галактический Совет обратился с убедительной просьбой к каждому пилоту прибыть в систему и помочь с эвакуацией, либо с уничтожением астероида.\");",
              "",
              "        for(i = 1; i <= 5; i = i + 1)",
              "        {",
              "            cur_ship = BuyTransport(TargetPlanet, 1);",
              "            ShipJoin(EvacShips, cur_ship);",
              "            ChangeState('GoToEvac', cur_ship);",
              "        }",
              "        for(i = 1; i <= 3; i = i + 1)",
              "        {",
              "            cur_ship = BuyWarrior(EvacPlanet, 1);",
              "            ShipJoin(PlanetDefenders, cur_ship);",
              "        }",
              "",
              "        GroupSetBad(PlanetDefenders, asteroid);",
              "        ShipSetBad(asteroid, Player());",
              "        for(i = 1; i <= 5; i = i + 1)",
              "        {",
              "            cur_ship = BuyTransport(EvacPlanet, 1);",
              "            ShipJoin(EvacShips, cur_ship);",
              "            ChangeState('GoToTarget', cur_ship);",
              "        }",
              "    }",
              "    //Ждём, пока игрок атакует астероид",
              "    else if(questState == 3)",
              "    {",
              "        if(asteroid)",
              "        {",
              "            if(Hit(asteroid, 0))",
              "            {",
              "                questVar = questVar + 1;",
              "                if(questVar >= 2) questState = 4;",
              "            }",
              "        }",
              "    }",
              "    else",
              "    {",
              "        if(!asteroid)",
              "        {",
              "            if(moveState > 0) //Отрицательные значения означают завершение пути астероида",
              "            {",
              "                //Если астероид столкнулся с планетой",
              "                if(moveState == 7)",
              "                {",
              "                    if(ShipStar(Player()) == ScriptStar)",
              "                    {",
              "                        Sound('Sound.NewMsg');",
              "                        CustomEther('GalaxyAlert', 7, 'ExpPhysGun_AsteroidComing',\"Столкновение подтверждено. Практически всё население и вся инфраструктура планеты <Name(TargetPlanet)> были уничтожены. Повторяю. Столкновение подтверждено...\", TargetPlanet);",
              "                    }",
              "",
              "                    AddPlanetNews(\"Сегодняшний день <GameDateTxtByTurn(CurTurn() + 1)> объявлен датой траура. Сегодня произошла одна из самых ужасных катастроф за все историю Коалиции. Миллионы жителей планеты <Name(TargetPlanet)> (система <Name(ScriptStar)>) погибли в результате её столкновения с Астероидом -<AsteroidNumber>-. Поиски выживших уже ведутся, но спасатели утверждают, что надежды очень призрачны - столкновение было безумно мощным. Почтим погибших минутой молчания.\");",
              "                    if(questState == 3) Ether(5, 'ExpPhysGun_QuestEther', \"Планета <Name(TargetPlanet)> находится в большой опасности. Мне необходимо найти способ уничтожить Астероид -<AsteroidNumber>-, который угрожает с ней столкнуться.\");",
              "                    if(questState == 5 && QuestTC_Id != -3) Ether(5, 'ExpPhysGun_QuestEther', \"Похоже, обычные пушки его не берут. Мне прислали сообщение с технологического центра <QuestTC_Name>, возможно, они чем-то смогут помочь.\");",
              "                    if(questState == 6) Ether(5, 'ExpPhysGun_QuestEther', \"Мне предоставили какую-то экспериментальную пушку, говорят, с помощью неё астероид можно будет уничтожить. Ну попробуем. Все что от меня требуется - это ловить маленькие астероиды и запускать их в большой. Даже ребенок справиться.\");",
              "",
              "                    if(GetShipPlanet(Player()))",
              "                    {",
              "                        if(GetShipPlanet(Player()) == TargetPlanet) CustomLose('FormGameEnd.LossKilledByExplosion');",
              "                    }",
              "",
              "                    PlanetOwner(TargetPlanet, 6);",
              "                    PlanetTerrain(TargetPlanet, 0, 100);",
              "                    PlanetTerrain(TargetPlanet, 1, 80);",
              "                    PlanetTerrain(TargetPlanet, 2, 50);",
              "                    //if(ShipInNormalSpace(Player())) StarMapCenterView(crashX, crashY);",
              "",
              "                    //Проверяем наличие физгана на борту игрока",
              "                    cur_item = ScriptItemToItem(PhysGunPrototype);",
              "                    //Физган существует (не уничтожен)",
              "                    if(cur_item)",
              "                    {",
              "                        ItemOnActCode(cur_item, '');",
              "                        ItemOnUseCode(cur_item, '');",
              "                        //Физган у игрока в трюме",
              "                        //Взрываем физган",
              "                        if(ItemIn(PhysGunPrototype, Player()))",
              "                        {",
              "                            HullHP(Player(), HullHP(Player()) - round(0.40 * HullHP(Player())));",
              "                            if(HullHP(Player()) < 1) HullHP(Player(), 1);",
              "                            Ether(8, '', \"Мощный взрыв сотряс корабль и выбил вас из кресла пилота. Физган взорвался и чуть было не уничтожил ваш корабль. Не совсем, правда, понятно, что стало тому причиной... Может быть, пыль попала? Или он не выдержал полетных нагрузок? Так или иначе, теперь от этой игрушки пользы нет.\");",
              "                            dwd1 = CreateQuestItem('BrokenPhysGun');",
              "                            ItemSize(dwd1, ItemSize(PhysGunPrototype));",
              "                            ItemCost(dwd1, 1);",
              "                            FreeItem(GetItemFromShip(Player(), FindItemInShip(Player(), cur_item)));",
              "                            SetName(dwd1, CT('Script.Mod_ExpPhysGun.PhysGunDestroyedName'));",
              "                            AddItemToShip(Player(), dwd1);",
              "                        }",
              "                    }",
              "",
              "                    //3 хода на завершение скрипта",
              "                    endDate = CurTurn() + 3;",
              "                    //Тернкод астероида полностью отключается",
              "                    moveState = -1;",
              "                }",
              "                //Если астероид был как-либо уничтожен до столкновения",
              "                else",
              "                {",
              "                    if(ShipStar(Player()) == ScriptStar)",
              "                    {",
              "                        Sound('Sound.NewMsg');",
              "                        CustomEther('GalaxyAlert', 7, 'ExpPhysGun_AsteroidComing', \"Уничтожение цели - Астероид -<AsteroidNumber>- подтверждено. Планета <Name(TargetPlanet)> вне опасности. Повторяю. Уничтожение цели...\");",
              "                    }",
              "",
              "                    if(questState == 3) Ether(4, 'ExpPhysGun_QuestEther', \"Планета <Name(TargetPlanet)> находится в большой опасности. Мне необходимо найти способ уничтожить Астероид -<AsteroidNumber>-, который может вскоре с ней столкнуться.\");",
              "                    if(questState == 5 && QuestTC_Id != -3) Ether(4, 'ExpPhysGun_QuestEther', \"Похоже, обычные пушки его не берут. Мне прислали сообщение с технологического центра <QuestTC_Name>, возможно, они чем-то смогут помочь.\");",
              "",
              "                    //Изначально выставляем стейт \"игрок уничтожил астероид нечестно\", пока непонятно чем он его атаковал",
              "                    //Если не отказался от задания на ТЦ (questState = 5)",
              "                    if(questState == 5 && QuestTC_Id == -3) questState = 5;",
              "                    else questState = 8;",
              "",
              "                    //Проверяем наличие физгана на борту игрока и атаковал ли он им астероид, если да то выдаём сломанный физган (юзлес)",
              "                    cur_item = ScriptItemToItem(PhysGunPrototype);",
              "                    //Физган существует (не уничтожен)",
              "                    if(cur_item)",
              "                    {",
              "                        ItemOnActCode(cur_item, '');",
              "                        ItemOnUseCode(cur_item, '');",
              "                        //Физган у игрока в трюме",
              "                        //Взрываем физган",
              "                        if(ItemIn(PhysGunPrototype, Player()))",
              "                        {",
              "                            HullHP(Player(), HullHP(Player()) - round(0.40 * HullHP(Player())));",
              "                            if(HullHP(Player()) < 1) HullHP(Player(), 1);",
              "                            Ether(8, '', \"Мощный взрыв сотряс корабль и выбил вас из кресла пилота. Физган взорвался и чуть было не уничтожил ваш корабль. Не совсем, правда, понятно, что стало тому причиной... Может быть, пыль попала? Или он не выдержал полётных нагрузок? Так или иначе, теперь от этой игрушки пользы нет.\");",
              "",
              "                            //Игрок использовал физган, выдаём сломаный",
              "                            if(ScriptItemData(cur_item, 1) == 3)",
              "                            {",
              "                                //Выставляем стейт \"игрок атаковал астероид физганом\"",
              "                                questState = 7;",
              "                                EvacInProcess = 0;",
              "                                dwd1 = CreateQuestItem('BrokenPhysGun');",
              "                                ItemSize(dwd1, ItemSize(PhysGunPrototype));",
              "                                ItemCost(dwd1, 1);",
              "                                LinkItemToScript(dwd1, PhysGunPrototype);",
              "                                AddItemToShip(Player(), dwd1);",
              "                                AddPlanetNews(\"Сегодня, благодаря слаженным действиям пилотов в системе <Name(ScriptStar)>, а также личному героизму рейнджера с позывным <Player>, была предотвращена, возможно, самая крупная катастрофа за всю историю Коалиции. Астероид рекордных размеров чуть было не уничтожил всю жизнь на планете <Name(TargetPlanet)>, но трагедии удалось избежать. Власти спасенной планеты уже изъявили желание по-королевски наградить рейнджера.\");",
              "                                NewsAdd(\"Рейнджер, <Player>, от лица всего спасённого вами населения планеты <Name(TargetPlanet)>, позвольте пригласить вас на торжественную церемонию награждения. Мы все вас очень ждём.\");",
              "                                Sound('Sound.LiberationSystem');",
              "                            }",
              "",
              "                            FreeItem(GetItemFromShip(Player(), cur_item));",
              "                        }",
              "                    }",
              "",
              "                    //Включаем диалоги, если не отказался от задания на ТЦ (questState = 5)",
              "                    if(questState == 5 && QuestTC_Id == -3) dialogVar = -3;",
              "                    else dialogVar = 3;",
              "                    questVar = 0; //Обнуляется на всякий случай",
              "",
              "                    //60 ходов на завершение скрипта или 3, если отказался от задания на ТЦ (questState = 5)",
              "                    if(questState == 5 && QuestTC_Id == -3)",
              "                    {",
              "                        //Завершаем скрипт",
              "                        questState = 10;",
              "                        endDate = CurTurn() + 3;",
              "                    }",
              "                    else endDate = CurTurn() + 60;",
              "",
              "                    //Тернкод астероида отключается",
              "                    moveState = -1;",
              "                }",
              "            }",
              "        }",
              "",
              "        if(questState > 6)",
              "        {",
              "            //Игрок спас всех без потери \"эвакуаторов\" и ждёт переименования планеты",
              "            if(dialogVar == 4)",
              "            {",
              "                //Переименование планеты",
              "                if(CurTurn() > questVar)",
              "                {",
              "                    AddPlanetNews(\"История с астероидом получила неожиданное продолжение. Правительство планеты <Name(TargetPlanet)>, в качестве особой награды, разрешило своему спасителю (рейнджер <Player>) переименовать планету. Галактический Совет, в последний момент, наложил запрет на смену названия, но абсолютная поддержка жителей спасённой планеты не оставила им выбора. Теперь планета <Name(TargetPlanet)> называется <addRew>! Данные всех галактических карт уже изменены.\");",
              "                    SetName(TargetPlanet, addRew);",
              "",
              "                    //Не обновляем здесь endDate, т.к. ранее она была заранее выставлена на нужное значение из победного диалога на планете",
              "                    dialogVar = -3;",
              "                }",
              "            }",
              "            else if(dialogVar == -3)",
              "            {",
              "                //Полное завершение квеста (игрок победил, либо проиграл)",
              "                if(CurTurn() > endDate)",
              "                {",
              "                    asteroid = GroupToShip(Asteroid);",
              "                    if(asteroid)",
              "                    {",
              "                        TransferShip(asteroid, PlanetNone);",
              "                        ShipDestroy(asteroid, 1);",
              "                    }",
              "",
              "                    //При попадании астероида в планету сюда может быть заранее выставлено значение -4",
              "                    if(GExpPhysGunGlobalState > -3) GExpPhysGunGlobalState = -3;",
              "                    questState = -3;",
              "                    moveState = -3;",
              "                    QuestTC_Id = -3;",
              "",
              "                    //Выставляем маркер завершения эвакуации (прирост населения планеты вновь продолжится)",
              "                    EvacInProcess = 0;",
              "",
              "                    //Снимаем защиту системы",
              "                    NoComeKlingToStar(ScriptStar, 0);",
              "                    AllShipOut();",
              "                }",
              "            }",
              "        }",
              "    }",
              "}",
              "",
              "//Код для направления в планету астероида",
              "if(moveState > 0)",
              "{",
              "    asteroid = GroupToShip(Asteroid);",
              "    if(asteroid)",
              "    {",
              "        if(moveState < 6)",
              "        {",
              "            //Если до столкновения с астероидом остался день",
              "            if(turnCrash - CurTurn() <= 1)",
              "            {",
              "                if(ShipStar(Player()) == ScriptStar)",
              "                {",
              "                    Sound('Sound.NewMsg');",
              "                    CustomEther('GalaxyAlert', 7, 'ExpPhysGun_AsteroidComing', \"Столкновение с Астероидом -<AsteroidNumber>- произойдёт в течении дня. Паника на планете <Name(TargetPlanet)> достигла пика!\");",
              "                }",
              "                moveState = 6;",
              "            }",
              "        }",
              "    }",
              "    //Если астероид по каким-либо причинам уничтожен",
              "    //else {}",
              "}"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  80,
          "Pos.y":  170,
          "Parent":  -1,
          "#":  37,
          "Total.Lines":  32,
          "Code.Type":  "Turn",
          "Code":          
          [
              "if(questState == 1)",
              "{",
              "    if(ShipInNormalSpace(Player()))",
              "    {",
              "        //Стартует начальный диалог квеста (типа игрок общается со своими мыслями)",
              "        questVar = 99;",
              "        Sound('Sound.Scan'); //По умолчанию диалог игрока с самим собой вызывается беззвучно",
              "        Dialog(QuestBeginDialog, Player());",
              "        questVar = 0;",
              "    }",
              "}",
              "else if(questState == 4)",
              "{",
              "    if(ShipStar(Player()) == ScriptStar)",
              "    {",
              "        if(ShipInNormalSpace(Player()))",
              "        {",
              "            cur_ruin = IdToShip(QuestTC_Id);",
              "            if(cur_ruin)",
              "            {",
              "                if(ShipStar(cur_ruin) == ScriptStar)",
              "                {",
              "                    if(ShipInNormalSpace(cur_ruin))",
              "                    {",
              "                        //Запускаем диалог с ТЦ в космосе",
              "                        Dialog(TCSpaceDialog, cur_ruin);",
              "                    }",
              "                }",
              "            }",
              "        }",
              "    }",
              "}"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  -290,
          "Pos.y":  510,
          "Parent":  -1,
          "#":  41,
          "Total.Lines":  5,
          "Code.Type":  "Turn",
          "Code":          
          [
              "questState = 5;",
              "OrderLanding(Player(), IdToShip(QuestTC_Id));",
              "",
              "//Меняем уведомление задания, добавляем текст о получении сообщения с ТЦ",
              "Ether(3, 'ExpPhysGun_QuestEther', \"Похоже, обычные пушки его не берут. Мне прислали сообщение с технологического центра <QuestTC_Name>, возможно, они чем-то смогут помочь.\");"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  -110,
          "Pos.y":  770,
          "Parent":  -1,
          "#":  52,
          "Total.Lines":  37,
          "Code.Type":  "Turn",
          "Code":          
          [
              "//Добавляем в игру новое кастомное ракетное оружие - физган",
              "tstr1 = 'PhysGun';",
              "tstr2 = 'Items.Weapon.CustomWeapon.';",
              "//Прописываем пушку/сбрасываем уже прописанную пушку до уровня базовой из оригинальной игры",
              "cur_item = InventNewCustomWeapon(tstr1, t_Weapon1 - 1 + CT('Items.Weapon.OriginalWeaponType.' + CT(tstr2 + tstr1 + '.BaseGun')));",
              "//Задаём характеристики оружия",
              "SetCustomWeaponShotData(cur_item, CT(tstr2 + tstr1 + '.ShotType'), CT(tstr2 + tstr1 + '.Speed'), CT(tstr2 + tstr1 + '.AverageRadius'), CT(tstr2 + tstr1 + '.SecondaryDamageRadius'), CT(tstr2 + tstr1 + '.MiningFactor'), CT(tstr2 + tstr1 + '.ShotsPerTurn'));",
              "SetCustomWeaponDamageData(cur_item, CT(tstr2 + tstr1 + '.MinDamage'), CT(tstr2 + tstr1 + '.MaxDamage'), CT(tstr2 + tstr1 + '.DamageSet'), CT(tstr2 + tstr1 + '.mWeaponDamage'));",
              "SetCustomMissileWeaponStats(cur_item, CT(tstr2 + tstr1 + '.MissileRadius'), CT(tstr2 + tstr1 + '.MissileMaxSpeed'), CT(tstr2 + tstr1 + '.MissileMinSpeed'), CT(tstr2 + tstr1 + '.MissileChanceToBeHit'));",
              "SetCustomWeaponPrimaryData(cur_item, CT(tstr2 + tstr1 + '.TechLevel'), t_Weapon1 - 1 + CT('Items.Weapon.OriginalWeaponType.' + CT(tstr2 + tstr1 + '.InventTechLevel')), t_Weapon1 - 1 + CT('Items.Weapon.OriginalWeaponType.' + CT(tstr2 + tstr1 + '.ArcadeType')));",
              "SetCustomWeaponSizeAndCost(cur_item, CT(tstr2 + tstr1 + '.kCost'), CT(tstr2 + tstr1 + '.AverageSize'));",
              "SetCustomWeaponAvailability(cur_item, CT(tstr2 + tstr1 + '.StoreAvailability'));",
              "SetCustomWeaponSE(cur_item, CT(tstr2 + tstr1 + '.ShotEffectPath'), CT(tstr2 + tstr1 + '.SplashEffectPath'), CT(tstr2 + tstr1 + '.MissileExplosionEffectPath'), CT(tstr2 + tstr1 + '.ShotEffectPalette'));",
              "",
              "//Создаём и настраиваем физган как предмет",
              "dwd0 = CreateCustomWeapon('PhysGun', 1, 1, 0);",
              "ItemOwner(dwd0, 0);",
              "ItemSize(dwd0, 84 - Rnd(5, 8) * GalaxyTechLevel());",
              "ItemLevel(dwd0, GalaxyTechLevel());",
              "ItemCost(dwd0, Rnd(50, 100));",
              "SpecialToEquipment(FindBonusByNameInCfg('ExpPhysGun_PhysGunEmpty'), dwd0);",
              "SetName(dwd0, CT('Script.Mod_ExpPhysGun.PhysGunPrototypeName'));",
              "WeaponMaxAmmunition(dwd0, 0);",
              "WeaponAmmunition(dwd0, 0);",
              "SetEquipmentStats(dwd0, 0, 0);",
              "SetEquipmentStats(dwd0, 0, 1);",
              "LinkItemToScript(dwd0, PhysGunPrototype);",
              "ItemOnActCode(dwd0, GenerateCodeStringFromBlock('ActCodeBlocksList.PhysGunActCodeQuest'));",
              "ItemOnUseCode(dwd0, GenerateCodeStringFromBlock('UseCodeBlocksList.PhysGunUseCodeEmpty'));",
              "ScriptItemData(dwd0, 1, 0);",
              "ScriptItemData(dwd0, 2, 0);",
              "AddItemToShip(Player(), dwd0);",
              "",
              "//Выставляем маркер о получении физгана (начинается этап атаки астероида)",
              "questState = 6;",
              "//Меняем уведомление задания, добавляем текст о получении экспериментального физгана",
              "Ether(3, 'ExpPhysGun_QuestEther', \"Мне предоставили какую-то экспериментальную пушку, говорят, с помощью неё астероид можно будет уничтожить. Ну попробуем. Все что от меня требуется - это ловить маленькие астероиды и запускать их в большой. Даже ребёнок справиться.\", GroupToShip(Asteroid));"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  -160,
          "Pos.y":  710,
          "Parent":  -1,
          "#":  53,
          "Total.Lines":  5,
          "Code.Type":  "Turn",
          "Code":          
          [
              "//Игрок отказался помогать, на ТЦ больше диалога не будет, астероид долетит безнаказанно и уничтожит планету",
              "QuestTC_Id = -3;",
              "",
              "//Меняем уведомление задания, добавляем текст об отказе пользоваться экспериментальным физганом (задание провалено)",
              "Ether(5, 'ExpPhysGun_QuestEther', \"Они хотели всучить мне какую-то непонятную экспериментальную пушку. На вид доверия она не вызывает, так что я отказался. Меньше всего мне нужно, чтобы она взорвала мой корабль в самый ответственный момент, придётся справляться самому.\");"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  200,
          "Pos.y":  630,
          "Parent":  -1,
          "#":  73,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "dialogVar = 2;"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  180,
          "Pos.y":  540,
          "Parent":  -1,
          "#":  74,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "dialogVar = 1;"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  130,
          "Pos.y":  410,
          "Parent":  -1,
          "#":  82,
          "Total.Lines":  6,
          "Code.Type":  "Turn",
          "Code":          
          [
              "//Астероид уничтожен, либо достиг планеты, все эвакуационные лайнеры выводятся из скрипта",
              "if(ShipType(CurShip) == 'Liner')",
              "{",
              "    if(dialogVar != 4) questVar = questVar + 1;",
              "}",
              "ShipOut(CurShip);"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  270,
          "Pos.y":  540,
          "Parent":  -1,
          "#":  89,
          "Total.Lines":  9,
          "Code.Type":  "Turn",
          "Code":          
          [
              "if(questState == 3) Ether(4, 'ExpPhysGun_QuestEther', \"Планета <Name(TargetPlanet)> находится в большой опасности. Мне необходимо найти способ уничтожить Астероид -<AsteroidNumber>-, который угрожает с ней столкнуться.\");",
              "if(questState == 5 && QuestTC_Id != -3) Ether(4, 'ExpPhysGun_QuestEther', \"Похоже, обычные пушки его не берут. Мне прислали сообщение с технологического центра <QuestTC_Name>, возможно, они чем-то смогут помочь.\");",
              "if(questState == 8) Ether(4, 'ExpPhysGun_QuestEther', \"Мне предоставили какую-то экспериментальную пушку, говорят, с помощью неё астероид можно будет уничтожить. Ну попробуем. Все что от меня требуется - это ловить маленькие астероиды и запускать их в большой. Даже ребенок справиться.\");",
              "//игрок уничтожил астероид не физганом, завершаем скрипт",
              "dialogVar = -3;",
              "//3 хода на завершение скрипта",
              "endDate = CurTurn() + 3;",
              "//стейт завершения скрипта",
              "questState = 10;"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  330,
          "Pos.y":  520,
          "Parent":  -1,
          "#":  93,
          "Total.Lines":  24,
          "Code.Type":  "Turn",
          "Code":          
          [
              "int0 = questVar + GroupCount(EvacShips);",
              "int1 = round(min(RangersCapital() / 100, ShipWealth(Player()) / 100) * 7) + 1200;",
              "int1 = round(int1 * 12 / 10);",
              "int1 = int1 + round(int1 / 10 * ShipSkill(Player(), 4));",
              "int1 = int1 * 3 + (int1 * 5 * int0) / 100;",
              "ShipMoney(Player(), ShipMoney(Player()) + int1);",
              "ChangeGlobalRelationsPlanets(Player(), StarToCon(ScriptStar), 2, 100, 31);",
              "",
              "if(!int0) tstr1 = '</color>' + \"К сожалению, наше торжество омрачается тем, что все лайнеры, которые мы снарядили эвакуировать мирных жителей, были уничтожены, но я уверен, что это не ваша вина, в конце концов, вашей первостепенной задачей было остановить астероид. А теперь, если вы не против, предлагаю проследовать на банкет.\";",
              "else if(int0 > 0 && int0 < 10) tstr1 = '</color>' + \"Кроме того, пусть и не всем, но хотя бы некоторым лайнерам удалось успешно эвакуировать часть жителей с нашей планеты. По нашим данным, места назначения достигли <int0> лайнеров из <10>. А теперь, если вы не против, предлагаю проследовать на банкет.\";",
              "else if(int0 >= 10) tstr1 = '</color>' + \"Кроме того, абсолютно все лайнеры, которых мы послали, успешно достигли пункта назначения. Это самая настоящая победа! Деньги не могут служить в данном случае адекватной оценкой вашего труда, <Player>. Мы долго думали чем бы достойно отблагодарить вас и после долгих споров в Галактическом Совете нам всё таки разрешили дать вам уникальную возможность переименовать нашу планету!\";",
              "dialogVar = -3;",
              "",
              "//60 ходов на завершение скрипта или 3, если сдал сломаный физган на ТЦ",
              "if(!QuestTC_Id)",
              "{",
              "    //стейт завершения скрипта",
              "    questState = 10;",
              "    endDate = CurTurn() + 3;",
              "}",
              "else endDate = CurTurn() + 60;",
              "",
              "//Меняем уведомление задания, задание с физганом успешно выполнено",
              "Ether(4, 'ExpPhysGun_QuestEther', \"День прожит не зря! Планета <Name(TargetPlanet)> спасена от неминуемой гибели, меня публично объявили героем, а самое главное - мой банковский счет изрядно потолстел. Кто бы мог подумать, что предотвращение катастрофы планетарного масштаба может принести столько положительных эмоций.\");"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  95,
          "#":  99,
          "Total.Lines":  30,
          "Code.Type":  "Turn",
          "Code":          
          [
              "int0 = 1;",
              "while(int0)",
              "{",
              "    int0 = 0;",
              "    addRew = TextBox(\"Новое имя планеты:\", Name(GetShipPlanet(Player())), 17);",
              "    while(count(addRew) > 17)",
              "    {",
              "        MessageBox(\"Новое имя планеты слишком длинное, повторите ввод.\");",
              "        addRew = TextBox(\"Новое имя планеты:\", Name(GetShipPlanet(Player())), 17);",
              "    }",
              "    for(i = 0; i < GalaxyStars(); i = i + 1)",
              "    {",
              "        dwd0 = GalaxyStar(i);",
              "        for(int1 = 0; int1 < StarPlanets(dwd0); int1 = int1 + 1)",
              "        {",
              "            dwd1 = StarPlanets(dwd0, int1);",
              "            if(Name(dwd1) == addRew) int0 = 1;",
              "            if(lowercase(Name(dwd1)) == lowercase(addRew)) int0 = 1;",
              "            if(int0) break;",
              "        }",
              "        if(int0) break;",
              "    }",
              "    if(int0) MessageBox(\"Планета с таким именем уже существует, повторите ввод.\");",
              "}",
              "",
              "//7 дней до уведомления о переименовании планеты",
              "questVar = CurTurn() + 7;",
              "dialogVar = 4;",
              "//9 ходов до завершения скрипта, если игрок сдал сломанный физган на ТЦ",
              "if(!QuestTC_Id) endDate = CurTurn() + 10;"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  -290,
          "Pos.y":  710,
          "Parent":  -1,
          "#":  104,
          "Total.Lines":  3,
          "Code.Type":  "Turn",
          "Code":          
          [
              "//Запускается \"сервисный\" скрипт, в который перезаписывается предмет физгана",
              "//Для нормальной работы физгана необходим скрипт, а гонять всю оставшуюся игру основной неоптимально",
              "ScriptRun(ScriptStar, TargetPlanet, 'Mod_ExpPhysGun_AfterQuestDone');"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  20,
          "Pos.y":  0,
          "Parent":  6,
          "#":  111,
          "Total.Lines":  81,
          "Code.Type":  "DialogBegin",
          "Code":          
          [
              "cur_planet = GetShipPlanet(Player());",
              "if(cur_planet)",
              "{",
              "    //Игрок сел на планету, которой угрожает/угрожал астероид, запускаем диалог",
              "    if(dialogVar < 4 && dialogVar != -3)",
              "    {",
              "        if(cur_planet == TargetPlanet) AddDialogOverride('TargetPlanetDialog', 1);",
              "    }",
              "}",
              "else",
              "{",
              "    cur_ruin = GetShipRuins(Player());",
              "    if(cur_ruin)",
              "    {",
              "        //Диалоги игрока на ТЦ",
              "        if(ShipType(cur_ruin) == 'TC')",
              "        {",
              "            //Прилетел на тот самый квестовый ТЦ",
              "            if(Id(cur_ruin) == QuestTC_Id)",
              "            {",
              "                //Если квестовый ТЦ всё ещё находится в квестовой системе",
              "                if(ShipStar(cur_ruin) == ScriptStar)",
              "                {",
              "                    //Игрок уже поговорил с ТЦ в космосе и теперь прилетел за физганом",
              "                    if(questState == 5)",
              "                    {",
              "                        //Спавним 3 пиратов и отправляем их в систему ScriptStar, ну чтобы задача с лайнерами халявой не казалась",
              "                        if(!pirateAttack)",
              "                        {",
              "                            pirateAttack = 1;",
              "                            dwd1 = StarNearbyStars(ScriptStar, 1);",
              "                            for(i = 1; i <= 3; i = i + 1)",
              "                            {",
              "                                dwd0 = BuyPirate(PlanetPirateClan(), 200);",
              "                                ShipSubType(dwd0, 0);",
              "                                ShipRefit(dwd0);",
              "                                ShipRefit(dwd0);",
              "                                MakeShipEnterStar(dwd0, ScriptStar, dwd1, 0);",
              "                            }",
              "                        }",
              "                        AddDialogOverride('TCPhysGunDialog', 21);",
              "                    }",
              "                    //Астероид уничтожен физганом, игрок прилетел жаловаться, что физган ёбнул",
              "                    else if(questState == 7)",
              "                    {",
              "                        if(ItemIn(PhysGunPrototype, Player()))",
              "                        {",
              "                            //Игрок сдал сломанный физган",
              "                            QuestTC_Id = 0;",
              "                            //60 ходов на завершение скрипта или 3, если уже завершил диалоги с планетой",
              "                            if(dialogVar == -3) endDate = CurTurn() + 3;",
              "                            else endDate = CurTurn() + 60;",
              "                            FreeItem(GetItemFromShip(Player(), FindItemInShip(Player(), PhysGunPrototype)));",
              "                            AddDialogOverride('TCFinalDialog', 21);",
              "                        }",
              "                    }",
              "                }",
              "            }",
              "        }",
              "    }",
              "    else",
              "    {",
              "        cur_ruin = GetTalkShip();",
              "        if(cur_ruin)",
              "        {",
              "            //Вступительный диалог, стартующий задание",
              "            if(questState == 1)",
              "            {",
              "                if(IsPlayer(cur_ruin))",
              "                {",
              "                    if(questVar == 99) AddDialogOverride('QuestBeginDialog', 1);",
              "                }",
              "            }",
              "            //С игроком в космосе связывается квестовый ТЦ",
              "            else if(questState == 4)",
              "            {",
              "                if(Id(cur_ruin) == QuestTC_Id) AddDialogOverride('TCSpaceDialog', 1);",
              "            }",
              "        }",
              "    }",
              "}"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  180,
          "Pos.y":  360,
          "Parent":  -1,
          "#":  118,
          "Total.Lines":  15,
          "Code.Type":  "Turn",
          "Code":          
          [
              "//\"Загружаем\" население для эвакуации на другую планету",
              "//1000 единиц популяции соответствует в игре миллиону человек, а не тысяче",
              "if(EvacInProcess)",
              "{",
              "    if(EvacInProcess > 10000)",
              "    {",
              "        EvacInProcess = EvacInProcess - 500;",
              "        ShipData(500);",
              "    }",
              "    else",
              "    {",
              "        EvacInProcess = EvacInProcess - 50;",
              "        ShipData(50);",
              "    }",
              "}"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  90,
          "Pos.y":  380,
          "Parent":  -1,
          "#":  120,
          "Total.Lines":  4,
          "Code.Type":  "Turn",
          "Code":          
          [
              "//\"Выгружаем\" население на планету для эвакуации",
              "//1000 единиц популяции соответствует в игре миллиону человек, а не тысяче",
              "PlanetPopulation(EvacPlanet, PlanetPopulation(EvacPlanet) + ShipData());",
              "ShipData(0);"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  180,
          "Pos.y":  290,
          "Parent":  -1,
          "#":  124,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "ShipOut(CurShip);"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  -130,
          "Pos.y":  450,
          "Parent":  -1,
          "#":  132,
          "Total.Lines":  4,
          "Code.Type":  "Turn",
          "Code":          
          [
              "tstr1 = '</color>' + Format(CT('Script.Mod_ExpPhysGun.AtBeginning'),",
              "        '<StarName'+'>', Name(ScriptStar));",
              "tstr2 = '</color>' + CT('Script.Mod_ExpPhysGun.PlayerStartQuest');",
              "tstr3 = '</color>' + CT('Script.Mod_ExpPhysGun.PlayerSkipQuest');"          
          ]        
        }      
      ],
      "Places":      
      [
        {
          "Type":  "TPlace",
          "Name":  "TargetRadius",
          "Pos.x":  240,
          "Pos.y":  120,
          "Parent":  -1,
          "#":  27,
          "Place.Type":  1,
          "Angle":  "0",
          "Dist":  "0,5",
          "Radius":  75,
          "Obj1":  2,
          "Obj2":  -1        
        }      
      ],
      "Planets":      
      [
        {
          "Type":  "TPlanet",
          "Name":  "TargetPlanet",
          "Pos.x":  100,
          "Pos.y":  220,
          "Parent":  -1,
          "#":  2,
          "Race":  63,
          "Owner":  63,
          "Economy":  14,
          "Goverment":  62,
          "RangeMin":  65,
          "RangeMax":  100,
          "Dialog":  -1        
        },
        {
          "Type":  "TPlanet",
          "Name":  "EvacPlanet",
          "Pos.x":  200,
          "Pos.y":  220,
          "Parent":  -1,
          "#":  7,
          "Race":  63,
          "Owner":  63,
          "Economy":  14,
          "Goverment":  62,
          "RangeMin":  0,
          "RangeMax":  100,
          "Dialog":  -1        
        },
        {
          "Type":  "TPlanet",
          "Name":  "PlanetNone",
          "Pos.x":  240,
          "Pos.y":  140,
          "Parent":  -1,
          "#":  8,
          "Race":  62,
          "Owner":  129,
          "Economy":  14,
          "Goverment":  62,
          "RangeMin":  0,
          "RangeMax":  100,
          "Dialog":  -1        
        }      
      ],
      "Ships":      
      [
        {
          "Type":  "TStarShip",
          "Name":  "",
          "Pos.x":  160,
          "Pos.y":  110,
          "Parent":  -1,
          "#":  0,
          "Count":  1,
          "Owner":  62,
          "Ship.Type":  126,
          "Player":  true,
          "SpeedMin":  0,
          "SpeedMax":  10000,
          "Weapon":  0,
          "CargoHook":  0,
          "EmptySpace":  0,
          "StatusTraderMin":  0,
          "StatusTraderMax":  100,
          "StatusWarriorMin":  0,
          "StatusWarriorMax":  100,
          "StatusPirateMin":  0,
          "StatusPirateMax":  100,
          "StrengthMin":  "0",
          "StrengthMax":  "0",
          "Ruins":  ""        
        }      
      ],
      "Stars":      
      [
        {
          "Type":  "TStar",
          "Name":  "ScriptStar",
          "Pos.x":  160,
          "Pos.y":  140,
          "Parent":  -1,
          "#":  1,
          "Constellation":  0,
          "Priority":  0,
          "NoKling":  true,
          "NoComeKling":  true        
        }      
      ],
      "Statements":      
      [
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  180,
          "Pos.y":  340,
          "Parent":  -1,
          "#":  60,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "EndState"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  130,
          "Pos.y":  380,
          "Parent":  -1,
          "#":  61,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "EndState"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  200,
          "Pos.y":  500,
          "Parent":  -1,
          "#":  66,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "dialogVar == 0"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  110,
          "Pos.y":  500,
          "Parent":  -1,
          "#":  77,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "dialogVar == 1"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  230,
          "Pos.y":  500,
          "Parent":  -1,
          "#":  79,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "dialogVar == 2"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  62,
          "#":  83,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "moveState > 0"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  200,
          "Pos.y":  340,
          "Parent":  -1,
          "#":  84,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "moveState >= 6 || moveState < 0"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  270,
          "Pos.y":  500,
          "Parent":  -1,
          "#":  85,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "dialogVar == 3"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  270,
          "Pos.y":  520,
          "Parent":  -1,
          "#":  86,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "questState == 8"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  330,
          "Pos.y":  500,
          "Parent":  -1,
          "#":  90,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "questState == 7"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  360,
          "Pos.y":  570,
          "Parent":  -1,
          "#":  94,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "int0 >= 10"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  330,
          "Pos.y":  570,
          "Parent":  -1,
          "#":  97,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "int0 < 10"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  90,
          "Pos.y":  310,
          "Parent":  -1,
          "#":  121,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "moveState < 6 && moveState > 0"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  50,
          "Pos.y":  380,
          "Parent":  -1,
          "#":  122,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "moveState >= 6 || moveState < 0"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  160,
          "Pos.y":  290,
          "Parent":  -1,
          "#":  123,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "EndState"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  20,
          "Pos.y":  -20,
          "Parent":  111,
          "#":  125,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "!ShipIsTakeoff(Player())"          
          ]        
        }      
      ],
      "States":      
      [
        {
          "Type":  "TState",
          "Name":  "PlayerState",
          "Pos.x":  100,
          "Pos.y":  170,
          "Parent":  -1,
          "#":  4,
          "Move":  0,
          "MoveObj":  -1,
          "Attack.Count":  0,
          "TakeItem":  -1,
          "TakeAllItem":  false,
          "OnTalk":  "",
          "OnActCode":  "",
          "EType":  1,
          "EUnique":  "",
          "EMsg":  ""        
        },
        {
          "Type":  "TState",
          "Name":  "LockStop",
          "Pos.x":  240,
          "Pos.y":  190,
          "Parent":  -1,
          "#":  15,
          "Move":  0,
          "MoveObj":  -1,
          "Attack.Count":  0,
          "TakeItem":  -1,
          "TakeAllItem":  false,
          "OnTalk":  "",
          "OnActCode":  "[t_OnStep|]\r\nAsteroidActCode();",
          "EType":  1,
          "EUnique":  "",
          "EMsg":  ""        
        },
        {
          "Type":  "TState",
          "Name":  "GoToAsteroid",
          "Pos.x":  50,
          "Pos.y":  290,
          "Parent":  -1,
          "#":  57,
          "Move":  2,
          "MoveObj":  14,
          "Attack.Count":  0,
          "TakeItem":  -1,
          "TakeAllItem":  false,
          "OnTalk":  "",
          "OnActCode":  "",
          "EType":  1,
          "EUnique":  "",
          "EMsg":  ""        
        },
        {
          "Type":  "TState",
          "Name":  "GoToTarget",
          "Pos.x":  200,
          "Pos.y":  310,
          "Parent":  -1,
          "#":  58,
          "Move":  4,
          "MoveObj":  2,
          "Attack.Count":  0,
          "TakeItem":  -1,
          "TakeAllItem":  false,
          "OnTalk":  "EvacTalk",
          "OnActCode":  "EvacTalk",
          "EType":  1,
          "EUnique":  "",
          "EMsg":  ""        
        },
        {
          "Type":  "TState",
          "Name":  "GoToEvac",
          "Pos.x":  200,
          "Pos.y":  380,
          "Parent":  -1,
          "#":  59,
          "Move":  4,
          "MoveObj":  7,
          "Attack.Count":  0,
          "TakeItem":  -1,
          "TakeAllItem":  false,
          "OnTalk":  "EvacTalk",
          "OnActCode":  "EvacTalk",
          "EType":  1,
          "EUnique":  "",
          "EMsg":  ""        
        },
        {
          "Type":  "TState",
          "Name":  "OutState",
          "Pos.x":  50,
          "Pos.y":  410,
          "Parent":  -1,
          "#":  81,
          "Move":  5,
          "MoveObj":  -1,
          "Attack.Count":  0,
          "TakeItem":  -1,
          "TakeAllItem":  false,
          "OnTalk":  "",
          "OnActCode":  "",
          "EType":  1,
          "EUnique":  "",
          "EMsg":  ""        
        }      
      ],
      "Variables":      
      [
        {
          "Type":  "TVar",
          "Name":  "questState",
          "Pos.x":  -240,
          "Pos.y":  -80,
          "Parent":  -1,
          "#":  9,
          "Var.Type":  "Int",
          "Init":  "0",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "dwd0",
          "Pos.x":  360,
          "Pos.y":  30,
          "Parent":  -1,
          "#":  10,
          "Var.Type":  "Dword",
          "Init":  "0",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "i",
          "Pos.x":  220,
          "Pos.y":  50,
          "Parent":  -1,
          "#":  11,
          "Var.Type":  "Int",
          "Init":  "0",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "dwd1",
          "Pos.x":  360,
          "Pos.y":  50,
          "Parent":  -1,
          "#":  12,
          "Var.Type":  "Dword",
          "Init":  "0",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "int0",
          "Pos.x":  220,
          "Pos.y":  -30,
          "Parent":  -1,
          "#":  13,
          "Var.Type":  "Int",
          "Init":  "0",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "turnPlanet",
          "Pos.x":  280,
          "Pos.y":  -10,
          "Parent":  -1,
          "#":  16,
          "Var.Type":  "Int",
          "Init":  "0",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "moveState",
          "Pos.x":  -150,
          "Pos.y":  -100,
          "Parent":  -1,
          "#":  17,
          "Var.Type":  "Int",
          "Init":  "0",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "flt0",
          "Pos.x":  220,
          "Pos.y":  10,
          "Parent":  -1,
          "#":  18,
          "Var.Type":  "Float",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "flt1",
          "Pos.x":  220,
          "Pos.y":  30,
          "Parent":  -1,
          "#":  19,
          "Var.Type":  "Float",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "int1",
          "Pos.x":  220,
          "Pos.y":  -10,
          "Parent":  -1,
          "#":  20,
          "Var.Type":  "Int",
          "Init":  "0",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "turnAsteroid",
          "Pos.x":  280,
          "Pos.y":  10,
          "Parent":  -1,
          "#":  21,
          "Var.Type":  "Int",
          "Init":  "0",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "turnCrash",
          "Pos.x":  -320,
          "Pos.y":  -40,
          "Parent":  -1,
          "#":  26,
          "Var.Type":  "Int",
          "Init":  "0",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "GExpPhysGunGlobalState",
          "Pos.x":  40,
          "Pos.y":  -80,
          "Parent":  -1,
          "#":  34,
          "Var.Type":  "Int",
          "Init":  "0",
          "Global":  true        
        },
        {
          "Type":  "TVar",
          "Name":  "questVar",
          "Pos.x":  -240,
          "Pos.y":  -100,
          "Parent":  -1,
          "#":  35,
          "Var.Type":  "Int",
          "Init":  "0",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "QuestTC_Id",
          "Pos.x":  -150,
          "Pos.y":  -80,
          "Parent":  -1,
          "#":  36,
          "Var.Type":  "Int",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "dialogVar",
          "Pos.x":  360,
          "Pos.y":  -30,
          "Parent":  -1,
          "#":  68,
          "Var.Type":  "Int",
          "Init":  "0",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "addRew",
          "Pos.x":  360,
          "Pos.y":  -10,
          "Parent":  -1,
          "#":  92,
          "Var.Type":  "Str",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "dwd3",
          "Pos.x":  360,
          "Pos.y":  70,
          "Parent":  -1,
          "#":  105,
          "Var.Type":  "Dword",
          "Init":  "0",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "endDate",
          "Pos.x":  -240,
          "Pos.y":  -60,
          "Parent":  -1,
          "#":  106,
          "Var.Type":  "Int",
          "Init":  "0",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "QuestTC_Name",
          "Pos.x":  -150,
          "Pos.y":  -60,
          "Parent":  -1,
          "#":  107,
          "Var.Type":  "Str",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "pirateAttack",
          "Pos.x":  -60,
          "Pos.y":  -80,
          "Parent":  -1,
          "#":  108,
          "Var.Type":  "Int",
          "Init":  "0",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "cur_ruin",
          "Pos.x":  30,
          "Pos.y":  30,
          "Parent":  -1,
          "#":  109,
          "Var.Type":  "Dword",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "cur_planet",
          "Pos.x":  30,
          "Pos.y":  10,
          "Parent":  -1,
          "#":  110,
          "Var.Type":  "Dword",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "cur_item",
          "Pos.x":  30,
          "Pos.y":  70,
          "Parent":  -1,
          "#":  112,
          "Var.Type":  "Dword",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "tstr1",
          "Pos.x":  100,
          "Pos.y":  30,
          "Parent":  -1,
          "#":  113,
          "Var.Type":  "Str",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "tstr2",
          "Pos.x":  100,
          "Pos.y":  50,
          "Parent":  -1,
          "#":  114,
          "Var.Type":  "Str",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "cur_ship",
          "Pos.x":  30,
          "Pos.y":  50,
          "Parent":  -1,
          "#":  115,
          "Var.Type":  "Dword",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "tempActCodeData",
          "Pos.x":  220,
          "Pos.y":  -120,
          "Parent":  -1,
          "#":  116,
          "Var.Type":  "Int",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "tempActCodeData2",
          "Pos.x":  220,
          "Pos.y":  -100,
          "Parent":  -1,
          "#":  117,
          "Var.Type":  "Int",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "EvacInProcess",
          "Pos.x":  -130,
          "Pos.y":  -40,
          "Parent":  -1,
          "#":  119,
          "Var.Type":  "Int",
          "Init":  "0",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "asteroid",
          "Pos.x":  360,
          "Pos.y":  -50,
          "Parent":  -1,
          "#":  128,
          "Var.Type":  "Dword",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "tempActCodeData3",
          "Pos.x":  220,
          "Pos.y":  -80,
          "Parent":  -1,
          "#":  129,
          "Var.Type":  "Int",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "turnStart",
          "Pos.x":  -320,
          "Pos.y":  -60,
          "Parent":  -1,
          "#":  130,
          "Var.Type":  "Int",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "AsteroidNumber",
          "Pos.x":  -240,
          "Pos.y":  -40,
          "Parent":  -1,
          "#":  131,
          "Var.Type":  "Int",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "tstr3",
          "Pos.x":  100,
          "Pos.y":  70,
          "Parent":  -1,
          "#":  133,
          "Var.Type":  "Str",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "tint1",
          "Pos.x":  220,
          "Pos.y":  70,
          "Parent":  -1,
          "#":  134,
          "Var.Type":  "Int",
          "Init":  "",
          "Global":  false        
        }      
      ]    
    }  
  ],
  "Visual.Links":  
  [
    {
      "Type":  "TGraphLink",
      "Begin":  3,
      "End":  4,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  3,
      "End":  2,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  2,
      "End":  1,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  0,
      "End":  1,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  7,
      "End":  1,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  8,
      "End":  1,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  14,
      "End":  8,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  14,
      "End":  15,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  23,
      "End":  24,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  23,
      "End":  25,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  27,
      "End":  1,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  25,
      "End":  28,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  29,
      "End":  30,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  30,
      "End":  31,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  38,
      "End":  39,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  42,
      "End":  43,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  43,
      "End":  44,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  44,
      "End":  45,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  45,
      "End":  46,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  45,
      "End":  47,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  46,
      "End":  48,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  48,
      "End":  49,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  50,
      "End":  51,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  49,
      "End":  52,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  47,
      "End":  53,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  56,
      "End":  2,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  56,
      "End":  57,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  55,
      "End":  7,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  55,
      "End":  58,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  58,
      "End":  60,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  59,
      "End":  61,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  63,
      "End":  64,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  65,
      "End":  66,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  66,
      "End":  67,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  67,
      "End":  69,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  67,
      "End":  70,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  69,
      "End":  71,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  71,
      "End":  72,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  69,
      "End":  73,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  75,
      "End":  76,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  65,
      "End":  77,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  77,
      "End":  78,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  65,
      "End":  79,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  79,
      "End":  80,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  80,
      "End":  72,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  62,
      "End":  83,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  83,
      "End":  63,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  58,
      "End":  84,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  81,
      "End":  82,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  65,
      "End":  85,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  85,
      "End":  86,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  87,
      "End":  88,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  86,
      "End":  89,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  85,
      "End":  90,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  90,
      "End":  93,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  93,
      "End":  91,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  94,
      "End":  95,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  91,
      "End":  94,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  91,
      "End":  97,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  97,
      "End":  96,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  94,
      "End":  98,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  95,
      "End":  99,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  100,
      "End":  101,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  101,
      "End":  102,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  101,
      "End":  103,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  102,
      "End":  104,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  39,
      "End":  41,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  41,
      "End":  40,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  61,
      "End":  120,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  84,
      "End":  59,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  60,
      "End":  118,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  120,
      "End":  121,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  121,
      "End":  58,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  120,
      "End":  122,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  122,
      "End":  81,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  118,
      "End":  59,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  57,
      "End":  123,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  123,
      "End":  124,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  125,
      "End":  33,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  99,
      "End":  126,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  126,
      "End":  127,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  24,
      "End":  32,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  32,
      "End":  29,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  89,
      "End":  87,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  53,
      "End":  50,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  4,
      "End":  37,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  22,
      "End":  132,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  132,
      "End":  23,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  78,
      "End":  76,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  70,
      "End":  74,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  74,
      "End":  75,
      "Nom":  0,
      "Arrow":  true    
    }  
  ],
  "Rect.Text":  
  [
    {
      "Type":  "TGraphRectText",
      "Rect.Left":  -745,
      "Rect.Top":  242,
      "Rect.Right":  16,
      "Rect.Bottom":  389,
      "FStyle":  1,
      "FColor":  0,
      "BStyle":  0,
      "BColor":  0,
      "BSize":  1,
      "BCoef":  "0",
      "AlignX":  -1,
      "AlignY":  0,
      "AlignRect":  false,
      "Text":  "moveState == -1, столкновение или учнитожение астероида\r\nmoveState == 0, астероид ещё не движется\r\nmoveState == 1, астероид летит к точке крюка (первое ускорение)\r\nmoveState == 2, второе ускорение\r\nmoveState == 3, первое замедление\r\nmoveState == 4, второе замедление (приказ на столкновение)\r\nmoveState == 5, за 1 ход до столкновения\r\nmoveState == 6, врезаемся в планету (уничтожение астероида)\r\nmoveState == 7, астероид врезался в планету (AsteroidCrashActCode)",
      "Color":  0,
      "Font":  "Arial",
      "FontSize":  10,
      "fsBold":  false,
      "fsItalic":  false,
      "fsUnderline":  false    
    },
    {
      "Type":  "TGraphRectText",
      "Rect.Left":  -745,
      "Rect.Top":  46,
      "Rect.Right":  16,
      "Rect.Bottom":  244,
      "FStyle":  1,
      "FColor":  10710818,
      "BStyle":  0,
      "BColor":  0,
      "BSize":  1,
      "BCoef":  "0",
      "AlignX":  -1,
      "AlignY":  0,
      "AlignRect":  false,
      "Text":  "questState == -2, задание отменяется из-за условий (или игрок отказался)\r\nquestState == 0, высчитываем координаты всего и вся\r\nquestState == 1, диалог для начала задания\r\nquestState == 2, игрок принял задание (запускаем лайнеры и эзеры)\r\nquestState == 3, ждём выстрел от игрока\r\nquestState == 4, начинаем диалог с \"ТЦ\"\r\nquestState == 5, завершаем диалог с \"ТЦ\", можно лететь за физганом\r\nquestState == 6, взяли физган, бьём астероид\r\nquestState == 7, астероид уничтожен физганом\r\nquestState == 8, астероид уничтожен не физганом\r\nquestState == 10, завершение скрипта/отказался выполнять задание\r\nQuestTC_Id == 0, сдал сломаный физган на ТЦ",
      "Color":  0,
      "Font":  "Arial",
      "FontSize":  10,
      "fsBold":  false,
      "fsItalic":  false,
      "fsUnderline":  false    
    },
    {
      "Type":  "TGraphRectText",
      "Rect.Left":  14,
      "Rect.Top":  667,
      "Rect.Right":  428,
      "Rect.Bottom":  772,
      "FStyle":  1,
      "FColor":  10710818,
      "BStyle":  0,
      "BColor":  0,
      "BSize":  1,
      "BCoef":  "0",
      "AlignX":  -1,
      "AlignY":  0,
      "AlignRect":  false,
      "Text":  " dialogVar == 0, игрок ещё не заходил в правительство планеты Target\r\n dialogVar == 1, игрок запаниковал, выгоняют\r\n dialogVar == 2, игрок согласился уничтожить астероид\r\n dialogVar == 3, игрок как-то уничтожил астероид\r\n dialogVar == 4, выставляется новое имя планеты (для тернкода)\r\n dialogVar == -3, все необходимые диалоги были завершены",
      "Color":  0,
      "Font":  "Arial",
      "FontSize":  10,
      "fsBold":  false,
      "fsItalic":  false,
      "fsUnderline":  false    
    },
    {
      "Type":  "TGraphRectText",
      "Rect.Left":  14,
      "Rect.Top":  85,
      "Rect.Right":  428,
      "Rect.Bottom":  428,
      "FStyle":  1,
      "FColor":  10710818,
      "BStyle":  0,
      "BColor":  0,
      "BSize":  1,
      "BCoef":  "0",
      "AlignX":  1,
      "AlignY":  -1,
      "AlignRect":  false,
      "Text":  "",
      "Color":  0,
      "Font":  "Arial",
      "FontSize":  10,
      "fsBold":  false,
      "fsItalic":  false,
      "fsUnderline":  false    
    },
    {
      "Type":  "TGraphRectText",
      "Rect.Left":  14,
      "Rect.Top":  426,
      "Rect.Right":  428,
      "Rect.Bottom":  669,
      "FStyle":  1,
      "FColor":  10710818,
      "BStyle":  0,
      "BColor":  0,
      "BSize":  1,
      "BCoef":  "0",
      "AlignX":  0,
      "AlignY":  1,
      "AlignRect":  false,
      "Text":  "Диалоги с планетой, на которую летит астероид",
      "Color":  0,
      "Font":  "Arial",
      "FontSize":  10,
      "fsBold":  false,
      "fsItalic":  false,
      "fsUnderline":  false    
    },
    {
      "Type":  "TGraphRectText",
      "Rect.Left":  -184,
      "Rect.Top":  606,
      "Rect.Right":  16,
      "Rect.Bottom":  792,
      "FStyle":  1,
      "FColor":  10710818,
      "BStyle":  0,
      "BColor":  0,
      "BSize":  1,
      "BCoef":  "0",
      "AlignX":  0,
      "AlignY":  -1,
      "AlignRect":  false,
      "Text":  "Тестовый физган",
      "Color":  0,
      "Font":  "Arial",
      "FontSize":  10,
      "fsBold":  false,
      "fsItalic":  false,
      "fsUnderline":  false    
    },
    {
      "Type":  "TGraphRectText",
      "Rect.Left":  -314,
      "Rect.Top":  606,
      "Rect.Right":  -182,
      "Rect.Bottom":  755,
      "FStyle":  1,
      "FColor":  10710818,
      "BStyle":  0,
      "BColor":  0,
      "BSize":  1,
      "BCoef":  "0",
      "AlignX":  0,
      "AlignY":  -1,
      "AlignRect":  false,
      "Text":  "Улучшенный физган",
      "Color":  0,
      "Font":  "Arial",
      "FontSize":  10,
      "fsBold":  false,
      "fsItalic":  false,
      "fsUnderline":  false    
    },
    {
      "Type":  "TGraphRectText",
      "Rect.Left":  -314,
      "Rect.Top":  387,
      "Rect.Right":  -181,
      "Rect.Bottom":  577,
      "FStyle":  1,
      "FColor":  10710818,
      "BStyle":  0,
      "BColor":  0,
      "BSize":  1,
      "BCoef":  "0",
      "AlignX":  0,
      "AlignY":  -1,
      "AlignRect":  false,
      "Text":  "Диалог с ТЦ\r\nв космосе",
      "Color":  0,
      "Font":  "Arial",
      "FontSize":  10,
      "fsBold":  false,
      "fsItalic":  false,
      "fsUnderline":  false    
    },
    {
      "Type":  "TGraphRectText",
      "Rect.Left":  -183,
      "Rect.Top":  387,
      "Rect.Right":  16,
      "Rect.Bottom":  577,
      "FStyle":  1,
      "FColor":  10710818,
      "BStyle":  0,
      "BColor":  0,
      "BSize":  1,
      "BCoef":  "0",
      "AlignX":  0,
      "AlignY":  -1,
      "AlignRect":  false,
      "Text":  "Стартовый диалог скрипта",
      "Color":  0,
      "Font":  "Arial",
      "FontSize":  10,
      "fsBold":  false,
      "fsItalic":  false,
      "fsUnderline":  false    
    },
    {
      "Type":  "TGraphRectText",
      "Rect.Left":  14,
      "Rect.Top":  -60,
      "Rect.Right":  428,
      "Rect.Bottom":  87,
      "FStyle":  1,
      "FColor":  10710818,
      "BStyle":  0,
      "BColor":  0,
      "BSize":  1,
      "BCoef":  "0,300000011920929",
      "AlignX":  0,
      "AlignY":  -1,
      "AlignRect":  false,
      "Text":  "Старт скрипта и его условия",
      "Color":  0,
      "Font":  "Arial",
      "FontSize":  10,
      "fsBold":  false,
      "fsItalic":  false,
      "fsUnderline":  false    
    },
    {
      "Type":  "TGraphRectText",
      "Rect.Left":  -314,
      "Rect.Top":  -5,
      "Rect.Right":  16,
      "Rect.Bottom":  48,
      "FStyle":  1,
      "FColor":  10710818,
      "BStyle":  0,
      "BColor":  0,
      "BSize":  1,
      "BCoef":  "0",
      "AlignX":  0,
      "AlignY":  -1,
      "AlignRect":  false,
      "Text":  "Непротесированный физган",
      "Color":  0,
      "Font":  "Arial",
      "FontSize":  10,
      "fsBold":  false,
      "fsItalic":  false,
      "fsUnderline":  false    
    },
    {
      "Type":  "TGraphRectText",
      "Rect.Left":  19,
      "Rect.Top":  -55,
      "Rect.Right":  125,
      "Rect.Bottom":  -19,
      "FStyle":  1,
      "FColor":  10710818,
      "BStyle":  0,
      "BColor":  0,
      "BSize":  1,
      "BCoef":  "0",
      "AlignX":  0,
      "AlignY":  0,
      "AlignRect":  false,
      "Text":  "",
      "Color":  16777215,
      "Font":  "Arial",
      "FontSize":  10,
      "fsBold":  false,
      "fsItalic":  false,
      "fsUnderline":  false    
    },
    {
      "Type":  "TGraphRectText",
      "Rect.Left":  426,
      "Rect.Top":  -60,
      "Rect.Right":  1093,
      "Rect.Bottom":  478,
      "FStyle":  1,
      "FColor":  10710818,
      "BStyle":  0,
      "BColor":  0,
      "BSize":  1,
      "BCoef":  "0",
      "AlignX":  -1,
      "AlignY":  -1,
      "AlignRect":  false,
      "Text":  "1. скрипт стартует когда игрок прилетает в систему(ScriptStar), если есть нужные планеты - запуск скрипта.\r\n2. дополнительные условия старта задания (*): наличие ТЦ (база типа 'TC'), скорость игрока больше 800 \r\nи радиус вращения планеты (Target, к которой полетит астероид) больше 2200. Такой радиус нужен \r\nчтобы астероид не спавнился неприлично далеко за пределами системы.\r\n*- если условия не выполняются, то questState = -2 и скрипт завершается на следующий ход.\r\n3. если все условия выполнимы, начинается создание транков и расчёт координат (блок if(questState == 0)->).\r\n4. через стейт Stop (группа NavigationPoint) начинается диалог в космосе \"стартовый даилог скрипта\", \r\nусловие if(questState == 1).\r\n5. в этом диалоге игрок может отказаться от старта задания, например, если невовремя начался или \r\nесть другие дела. В этом случае все скриптовые корабли выбрасываются и скрипт завершается\r\nна следующем ходу. Глобалка GExpPhysGunGlobalState + 1.\r\n6. если согласился, то выдаём некоторую инфу и центрируем камеру на астероиде, выставляем астероиду\r\nприказ двигаться к точке \"крюка\" (*), а игроку приближаться к астероиду. На следующем ходу создаём и\r\nзапускаем 10 лайнеров и 3 военных.\r\n*- точка \"крюка\", это такая точка которая поменяет траекторию движения астероида на \r\n\"огибающую звезду\", эта траектория будет рассчитываться хардкодом, по 2 координатам: точка крюка и\r\nточка столкновения.\r\n7. ждём пока игрок выстрелит.\r\n8. через стейт Stop (группа NavigationPoint) начинается диалог в космосе \"диалог с \"ТЦ\" в космосе\", \r\nусловие if(questState == 4).\r\n9. игроку можно лететь за физганом на ТЦ.\r\n10. игрок может взять физган(продолжаем выполнять задание) или отказаться (провал задания).\r\n11. летим искать малые астероиды и бить ими большой. Непротестированный физган может стрелять только\r\nастероидами и захватывать их. Акткод от нормального физгана отличается.\r\n12. если не успели уничтожить, то квест провален, физган взрывается (если был у игрока), планета\r\nстановится незаселённой. Если физгана небыло у игрока, то и пофиг на это, как уже писал, там АктКод\r\nисключительно по астероиду с нашим типом, по остальным кораблям будет бить на 1-3.\r\n13. если успел уничтожить (*), то можно лететь на ТЦ за нормальным физганом (нормальный акткод) или \r\nна планету к которой летел астероид, очерёдность неважна.\r\n*- если уничтожил астероид физганом (считается в акткоде), то будет нормальный диалог if(questState==7),\r\nесли уничтожил как-то ещё(например читом BOOM), то будет диалог if(questState == 8), без награды.\r\n14. если уничтожил астероид и ни один из 10 лайнеров не погиб, то можно переименовать планету. Турнкод\r\n в условиях \"турнкод выполнения задания\", if(questState == 7).",
      "Color":  0,
      "Font":  "Arial",
      "FontSize":  10,
      "fsBold":  false,
      "fsItalic":  false,
      "fsUnderline":  false    
    },
    {
      "Type":  "TGraphRectText",
      "Rect.Left":  1091,
      "Rect.Top":  -60,
      "Rect.Right":  1559,
      "Rect.Bottom":  301,
      "FStyle":  1,
      "FColor":  10710818,
      "BStyle":  0,
      "BColor":  0,
      "BSize":  1,
      "BCoef":  "0",
      "AlignX":  -1,
      "AlignY":  -1,
      "AlignRect":  false,
      "Text":  "Основные условия для старта скрипта:\r\n1. с последней попытки запустить скрипт прошло 10 ходов.\r\n2. игрок влетает в систему ScriptStar.\r\n3. игрок ещё не завершал квест на физган (GExpPhysGunGlobalState != -3).\r\n4. у игрока есть радар в слоте.\r\nДополнительные условия для старта скрипта:\r\n1. радиус орбиты планеты к которой летит астероид (Target)\r\nдолжен быть больше 2200 (см. коммент в иниткоде).\r\n2. в системе должен быть ТЦ (база с TC типом).\r\n\r\nПояснения к объектам:\r\nВсе группы заполняются вручную через функции Buy*.\r\nPlanetNone - незаселёнка, там сидит транк из NavigationPoint.\r\nTarget - сюда летит астероид.\r\nEvacPlanet - сюда будут летать лайнеры с TargetPlanet.\r\nГруппа Asteroid - тут будет сидеть транк-астероид.\r\nNavigationPoint - по этому транку выставляются некоторые\r\nкоординаты и углы, запускает диалоги.\r\nГруппа PlanetDefenders - 3 вояки, будут безуспешно стрелять\r\nв астероид.\r\nГруппа EvacShips - 10 лайнеров, будут курсировать между \r\nпланетами, типа эвакуация.",
      "Color":  0,
      "Font":  "Arial",
      "FontSize":  10,
      "fsBold":  false,
      "fsItalic":  false,
      "fsUnderline":  false    
    },
    {
      "Type":  "TGraphRectText",
      "Rect.Left":  426,
      "Rect.Top":  476,
      "Rect.Right":  1093,
      "Rect.Bottom":  661,
      "FStyle":  1,
      "FColor":  10710818,
      "BStyle":  0,
      "BColor":  0,
      "BSize":  1,
      "BCoef":  "0",
      "AlignX":  -1,
      "AlignY":  -1,
      "AlignRect":  false,
      "Text":  "Заскриптованные варианты развития сюжета:\r\n1. не выстрелил по астероиду, астероид уничтожен\r\n2. не выстрелил по астероиду, астероид уничтожил планету\r\n3. не сел на ТЦ, астероид уничтожен\r\n4. не сел на ТЦ, астероид уничтожил планету\r\n5. согласился на задание ТЦ, уничтожил астероид физганом\r\n6. согласился на задание ТЦ, уничтожил астероид не физганом\r\n7. согласился на задание ТЦ, астероид уничтожил планету\r\n8. отказался от задания на ТЦ, астероид уничтожен\r\n9. отказался от задания на ТЦ, астероид уничтожил планету\r\n10. читанул ZAWARUDO, квест автоматически провален",
      "Color":  0,
      "Font":  "Arial",
      "FontSize":  10,
      "fsBold":  false,
      "fsItalic":  false,
      "fsUnderline":  false    
    },
    {
      "Type":  "TGraphRectText",
      "Rect.Left":  1091,
      "Rect.Top":  299,
      "Rect.Right":  1559,
      "Rect.Bottom":  502,
      "FStyle":  1,
      "FColor":  10710818,
      "BStyle":  0,
      "BColor":  0,
      "BSize":  1,
      "BCoef":  "0",
      "AlignX":  -1,
      "AlignY":  -1,
      "AlignRect":  false,
      "Text":  "Если будут писать что физган не работает:\r\n1. Непротестированный физган - исключительно для квеста.\r\nМожет стрелять только астероидами, по остальным \r\nкораблям наносит что-то около 1-10 урона.\r\n2. Бортовой физган - должен стрелять оборудкой, кваркой\r\nи астероидами. АктКод снимается только если вставили ММ.\r\n3. Сломанный физган (предмет, не оружие) - квестовый\r\nпредмет, надо сдать на квестовый ТЦ",
      "Color":  0,
      "Font":  "Arial",
      "FontSize":  10,
      "fsBold":  false,
      "fsItalic":  false,
      "fsUnderline":  false    
    }  
  ],
  "BlockPar.EC.Total.Strings":  58,
  "BlockPar.EC":  
  [
    {
      "#":  "101",
      "String":  "<0>"    
    },
    {
      "#":  "103",
      "String":  "Планета <0> находится в большой опасности. Мне необходимо найти способ уничтожить Астероид -<1>-, который угрожает с ней столкнуться."    
    },
    {
      "#":  "108",
      "String":  "Отлично, мы уже перенесли физган в ваш трюм. Как только взлетите, ищите ближайший астероид, подлетите к нему и используйте встроенный в физган захват, чтобы поймать его. После чего запустите импровизированный снаряд в Разрушителя, вот собственно и все. Ничего сложного, но время поджимает, так что поторопитесь!"    
    },
    {
      "#":  "109",
      "String":  "Ну что же... Это ваше право. К сожалению, мы вряд ли теперь успеем найти кого-нибудь еще... Боюсь, жителям планеты <0> теперь остается рассчитывать только на скорейшую эвакуацию... Если честно - я разочарован в вас <Player>."    
    },
    {
      "#":  "110",
      "String":  "Отлично! Покажите там этой каменюке! Вдарьте всей мощью, что у вас есть! Да и еще кое-что: как я уже говорил мы проводим эвакуацию, однако она и гроша ломанного не будет стоить, если на наши лайнеры нападут пираты, а ведь они могут. Очень вас прошу, если у вас будет возможность, постарайтесь защитить наши эвакуационные лайнеры, в случае чего. А теперь идите... Скорее, <Player>, наша жизнь сейчас в ваших руках... Еще в руках других пилотов, что сейчас пытаются сбить астероид, но это не повод расслабляться! Вперед!"    
    },
    {
      "#":  "111",
      "String":  "Вы что все еще здесь? На нас все еще летит самый большой астероид в истории коалиции, у нас действительно нет времени на праздные разговоры. Отправляйтесь в космос и уничтожьте уже эту чертову каменюгу!"    
    },
    {
      "#":  "113",
      "String":  "Ну, давайте сюда свою пукалку. Только учтите, если и она попытается меня взорвать, то я сюда вернусь!"    
    },
    {
      "#":  "114",
      "String":  "Что вы, разумеется нет... Позвольте, я вам объясню: дело в том, что внутренняя структура данного космического тела представляет собой огромный кристалл. Плотность этого кристалла невероятно высока и все, что сможет ему сделать наше стандартное вооружение - уничтожить верхний слой, состоящий из мягких горных пород и водяного льда, и слегка поцарапать сердцевину. Однако путь есть и он состоит в том, чтобы разбить кристалл. Достаточно всего нескольких точных ударов большой мощности. Приложить, так сказать, достаточно кинетической энергии, на достаточно малой площади и к счастью мы уже придумали, как это сделать. Нужно запустить в нашего Разрушителя, именно так мы его тут называем, другой астероид, точнее несколько...<br>Не надо смотреть на меня как на умалишенного, это действительно можно сделать. Слышали когда-нибудь о физических устройствах направленной антигравитации? В просторечье физганах? Эти устройства были изобретены знаменитым гаальским инженером Рее-Кляйном и используются сейчас для погрузочных работ. Мы же увеличили энергетическое ядро физгана и добавили ему стазисный генератор нулевой энергии, естественно это привело к увеличению устройства и невозможности его ручного использования, зато резко увеличили максимальную массу объектов, которые он может перемещать, а создание вокруг перемещаемого объекта энергетического стазиса защищает его от любых повреждений. Короче говоря - представляем вам первую экспериментальную модель <clr>Бортового физгана<clrEnd>. Он способен захватывать объекты размером со стандартный астероид и помещать их в стазис под днищем корабля, а когда вам понадобиться, достаточно направить физган в нужную сторону и отключить стазис - большое количество энергии, до тех пор изолируемое от объекта с помощью стазиса, войдет в свои права и придаст объекту огромное ускорение. К сожалению это делает бортовой физган совершенно несостоятельным как устройство для перемещения грузов, зато делает его полезным в качестве оружия, чем вам и необходимо воспользоваться, если вы конечно согласитесь. Как я уже сказал - это первая экспериментальная модель. Возможны... форс-мажоры... Но учтите, если вы откажетесь - это может стать причиной гибели целой планеты."    
    },
    {
      "#":  "116",
      "String":  "Всегда хотел оставить свой след в истории! Новое имя планеты... дайте-ка подумать..."    
    },
    {
      "#":  "119",
      "String":  "Кроме того, пусть и не всем, но хотя бы некоторым лайнерам удалось успешно эвакуировать часть жителей с нашей планеты. По нашим данным, места назначения достигли <0> лайнеров из <1>. А теперь, если вы не против, предлагаю проследовать на банкет."    
    },
    {
      "#":  "120",
      "String":  "К сожалению, наше торжество омрачается тем, что все лайнеры, которые мы снарядили эвакуировать мирных жителей, были уничтожены, но я уверен, что это не ваша вина, в конце концов, вашей первостепенной задачей было остановить астероид. А теперь, если вы не против, предлагаю проследовать на банкет."    
    },
    {
      "#":  "121",
      "String":  "Сматываемся отсюда!"    
    },
    {
      "#":  "125",
      "String":  "Они хотели всучить мне какую-то непонятную экспериментальную пушку. На вид доверия она не вызывает, так что я отказался. Меньше всего мне нужно, чтобы она взорвала мой корабль в самый ответственный момент, придётся справляться самому."    
    },
    {
      "#":  "126",
      "String":  "Мне предоставили какую-то экспериментальную пушку, говорят, с помощью неё астероид можно будет уничтожить. Ну попробуем. Все что от меня требуется - это ловить маленькие астероиды и запускать их в большой. Даже ребёнок справиться."    
    },
    {
      "#":  "129",
      "String":  "Вот вы где! Наш герой и спаситель рейнджер <Player>! Я бы расцеловал вас, но боюсь меня могут не правильно понять. Мы вас уже тут заждались! Банкет в вашу честь уже подготовлен, но это не самое главное... Что? А награда! Конечно, как я мог забыть! Сумма в <0> cr. уже переведена на ваш счет, точно также как и наша бесконечная благодарность!<br><1>"    
    },
    {
      "#":  "131",
      "String":  "Вы спасли целую планету! Мы видели, как это произошло. Было так круто! Вы запускаете свой астероид прямо по Разрушителю, и он раскалывается на мелкие кусочки! У нас тут столько народу хотят взять у вас автограф! Что говорите? Физган взорвался от перегрузки? Ну, бывает, это ведь первая экспериментальная модель была. Так вы дадите мне автограф? Ну ладно, ладно, не надо на меня так смотреть...<br>В качестве извинения за инцидент с поломкой мы хотим предложить вам обновленную версию физгана. Защитные механизмы были значительно усовершенствованы, так что теперь мы можем гарантировать, что никаких взрывов от перегрузки не будет… Ну по крайней мере в <clr>99%<clrEnd> случаев... В <clr>98%<clrEnd> так точно... Ну может быть в <clr>97%<clrEnd>...<br>Кроме того, мы оборудовали новую модель удобным приемником, позволяющим заряжать её прямо <clr>изнутри корабля<clrEnd>. Собственно, вы и раньше могли это делать, просто это было бы не так удобно... А я что, не говорил вам? Ну значит забыл. Так вот, заряжать вы его можете практически чем угодно. Абсолютно все, что есть у вас в трюме, может быть использовано в качестве снаряда для физгана. Разумеется, возможность захватывать астероиды тоже никуда не делась. Единственное, что нам так и не удалось - это добавить совместимость с микромодулями. Уж слишком нетипичное в плане применения устройство, так сказать.<br>Ну, что скажете?"    
    },
    {
      "#":  "135",
      "String":  "Мощный взрыв сотряс корабль и выбил вас из кресла пилота. Физган взорвался и чуть было не уничтожил ваш корабль. Не совсем, правда, понятно, что стало тому причиной... Может быть, пыль попала? Или он не выдержал полётных нагрузок? Так или иначе, теперь от этой игрушки пользы нет."    
    },
    {
      "#":  "136",
      "String":  "Планета <0> находится в большой опасности. Мне необходимо найти способ уничтожить Астероид -<1>-, который может вскоре с ней столкнуться."    
    },
    {
      "#":  "137",
      "String":  "Столкновение подтверждено. Практически всё население и вся инфраструктура планеты <0> были уничтожены. Повторяю. Столкновение подтверждено..."    
    },
    {
      "#":  "139",
      "String":  "Требуется помощь всех свободных пилотов! СРОЧНО! ВСЕМ КОРАБЛЯМ!<br>Чрезвычайная ситуация в системе <0>! Планета <1> в большой опасности!<br>Повторяю: Требуется помощь всех свободных пилотов! СРОЧНО! ВСЕМ КОРАБЛЯМ! Чрезвычайная ситуация в системе..."    
    },
    {
      "#":  "140",
      "String":  "Рейнджер, <Player>, от лица всего спасённого вами населения планеты <0>, позвольте пригласить вас на торжественную церемонию награждения. Мы все вас очень ждём."    
    },
    {
      "#":  "141",
      "String":  "Кроме того, абсолютно все лайнеры, которых мы послали, успешно достигли пункта назначения. Это самая настоящая победа! Деньги не могут служить в данном случае адекватной оценкой вашего труда, <Player>. Мы долго думали чем бы достойно отблагодарить вас и после долгих споров в Галактическом Совете нам всё таки разрешили дать вам уникальную возможность переименовать нашу планету!"    
    },
    {
      "#":  "142",
      "String":  "Ого! А вы затейник, <Player>. Замечательное название подобрали нашей планете.<br>Чтобы утрясти все бюрократические формальности нам потребуется где-то ещё неделька. Но не сомневайтесь, жители планеты <0> уже приняли своё твёрдое решение!"    
    },
    {
      "#":  "143",
      "String":  "Рад, что вам тоже понравилось :-)"    
    },
    {
      "#":  "144",
      "String":  "История с астероидом получила неожиданное продолжение. Правительство планеты <0>, в качестве особой награды, разрешило своему спасителю (рейнджер <Player>) переименовать планету. Галактический Совет, в последний момент, наложил запрет на смену названия, но абсолютная поддержка жителей спасённой планеты не оставила им выбора. Теперь планета <1> называется <2>! Данные всех галактических карт уже изменены."    
    },
    {
      "#":  "22",
      "String":  "Похоже, обычные пушки его не берут. Мне прислали сообщение с технологического центра <0>, возможно, они чем-то смогут помочь."    
    },
    {
      "#":  "27",
      "String":  "Поступила информация, что в системе <0> обнаружен астероид рекордных размеров. К несчастью, траектория полета астероида с большой вероятностью пересечется с планетой <1>, на которой сейчас объявлен режим чрезвычайного положения. В случае столкновения ни системы планетарной защиты, ни подземные убежища не смогут уберечь жителей планеты. Галактический Совет обратился с убедительной просьбой к каждому пилоту прибыть в систему и помочь с эвакуацией, либо с уничтожением астероида."    
    },
    {
      "#":  "31",
      "String":  "Понял, конец связи"    
    },
    {
      "#":  "33",
      "String":  "Внимание, рейнджер <Player>! Немедленно прекратите атаку на планетоид и как можно скорее прибудьте на технологический центр <0>! Это дело первостепенной важности!"    
    },
    {
      "#":  "34",
      "String":  "Рейнджер <Player>, наконец-то вы прибыли! Мы боялись, что вы пропустите наше сообщение или не предадите ему значения, особенно учитывая насколько важным делом вы были заняты. Но все дело в том, что ваши попытки сбить данный планетоид ни к чему не приведут, он обладает слишком необычной структурой, стандартное бортовое вооружение просто не в состоянии нанести ему хоть сколько-нибудь существенный урон."    
    },
    {
      "#":  "40",
      "String":  "И что же теперь делать? Неужели опускать руки и дать планете погибнуть?"    
    },
    {
      "#":  "41",
      "String":  "Ладно, уговорили. Ставьте свой агрегат"    
    },
    {
      "#":  "42",
      "String":  "Ну уж нет, не надо мне такой радости. Еще взорвется у меня на корабле, знаю я вас"    
    },
    {
      "#":  "44",
      "String":  "Уже вылетаю!"    
    },
    {
      "#":  "45",
      "String":  "Мне предоставили какую-то экспериментальную пушку, говорят, с помощью неё астероид можно будет уничтожить. Ну попробуем. Все что от меня требуется - это ловить маленькие астероиды и запускать их в большой. Даже ребенок справиться."    
    },
    {
      "#":  "47",
      "String":  "Ничем не могу вам с этим помочь"    
    },
    {
      "#":  "49",
      "String":  "Мне сейчас некогда общаться, <Player>. Я провожу эвакуацию населения с планеты <0>, которая находиться под угрозой столкновения с астероидом. Нужно вывести от туда как можно больше жителей, ни секунды нет, чтобы передохнуть."    
    },
    {
      "#":  "50",
      "String":  "Конец связи"    
    },
    {
      "#":  "51",
      "String":  "Рейнджер <Player>! Наконец-то адекватное лицо. Вы просто представить себе не можете, что тут творится. Все наши попытки не допустить паники потерпели сокрушительное фиаско! В космопорте гигантские толпы беженцев, все наши транспортники работают на пределе, но всех вывезти мы все равно не успеем.<br>Народ уже дошел до предела, бегают повсюду с плакатами на тему нашего незавидного будущего, а точнее его отсутствия. Из всех щелей повылезали фанатики, зачитывающие такие места из религиозных текстов, что мне самому становится не по себе, и я уже не говорю про мародеров... Словом - ад, такое впечатление, что астероид уже в нас врезался. Не помню такого бардака с тех времен, когда широкая общественность впервые услышала о доминаторах.<br>Так или иначе, у нас тут объявлено чрезвычайное положение и нам бы очень пригодилась ваша помощь. Астероид необходимо уничтожить и за это мы уже назначили крупную награду, вы готовы нам помочь?"    
    },
    {
      "#":  "53",
      "String":  "И вы туда же? Проклятье, скоро с этим астероидом вообще нормальных гуманоидов не останется. Ну тогда проваливайте, хватит отнимать мое время! Единственная просьба: когда будете убегать, словно крыса с тонущего корабля, хотя бы захватите с собой кого-нибудь из местных. Хотя бы чуть-чуть облегчите мою задачу."    
    },
    {
      "#":  "54",
      "String":  "Опять вы?! У меня нет времени слушать ваши апокалиптические бредни! Я пытаюсь как-то организовать то недоразумение, что у нас называют эвакуацией, и вы мне тут совсем не помогаете. Проваливайте."    
    },
    {
      "#":  "56",
      "String":  "Разумеется готов!"    
    },
    {
      "#":  "57",
      "String":  "Мы все погибнем! Надо бежать! КОНЕЦ БЛИЗОК!"    
    },
    {
      "#":  "58",
      "String":  "Уже бегу!"    
    },
    {
      "#":  "61",
      "String":  "Мощный взрыв сотряс корабль и выбил вас из кресла пилота. Физган взорвался и чуть было не уничтожил ваш корабль. Не совсем, правда, понятно, что стало тому причиной... Может быть, пыль попала? Или он не выдержал полетных нагрузок? Так или иначе, теперь от этой игрушки пользы нет."    
    },
    {
      "#":  "62",
      "String":  "Сегодня, благодаря слаженным действиям пилотов в системе <0>, а также личному героизму рейнджера с позывным <Player>, была предотвращена, возможно, самая крупная катастрофа за всю историю Коалиции. Астероид рекордных размеров чуть было не уничтожил всю жизнь на планете <1>, но трагедии удалось избежать. Власти спасенной планеты уже изъявили желание по-королевски наградить рейнджера."    
    },
    {
      "#":  "63",
      "String":  "Уничтожение цели - Астероид -<0>- подтверждено. Планета <1> вне опасности. Повторяю. Уничтожение цели..."    
    },
    {
      "#":  "64",
      "String":  "Сегодняшний день <0> объявлен датой траура. Сегодня произошла одна из самых ужасных катастроф за все историю Коалиции. Миллионы жителей планеты <1> (система <2>) погибли в результате её столкновения с Астероидом -<3>-. Поиски выживших уже ведутся, но спасатели утверждают, что надежды очень призрачны - столкновение было безумно мощным. Почтим погибших минутой молчания."    
    },
    {
      "#":  "68",
      "String":  "Столкновение с Астероидом -<0>- произойдёт в течении дня. Паника на планете <1> достигла пика!"    
    },
    {
      "#":  "71",
      "String":  "Нет, я уже ухожу"    
    },
    {
      "#":  "72",
      "String":  "А, это вы, <Player>... а вы чего хотите? Награду за уничтожение астероида? Ну ладно, так уж и быть. Спасибо! Похоже вы чем-то недовольны, придётся добавить лично от себя... БОЛЬШОЕ СПАСИБО!!!<br>Мы всё видели, астероид развалился сам по себе так и не долетев до нашей планеты. А паники то сколько было! Вам ещё что-то надо?"    
    },
    {
      "#":  "73",
      "String":  "День прожит не зря! Планета <0> спасена от неминуемой гибели, меня публично объявили героем, а самое главное - мой банковский счет изрядно потолстел. Кто бы мог подумать, что предотвращение катастрофы планетарного масштаба может принести столько положительных эмоций."    
    },
    {
      "#":  "79",
      "String":  "Проследовать на банкет"    
    },
    {
      "#":  "88",
      "String":  "Новое имя планеты:"    
    },
    {
      "#":  "89",
      "String":  "Благодарю за оказаную честь, но я не могу себе такого позволить... А от банкета не откажусь!"    
    },
    {
      "#":  "90",
      "String":  "Планета с таким именем уже существует, повторите ввод."    
    },
    {
      "#":  "91",
      "String":  "Новое имя планеты слишком длинное, повторите ввод."    
    },
    {
      "#":  "97",
      "String":  "Нет уж, спасибо. Не надо мне такого счастья. Не доверяю я теперь этим вашим экспериментальным технологиям"    
    }  
  ]
}