MicroModuls ^{
    ShuBK_Discount25 ^{
        Cost=75
        KindGraph=DiscountMM_25
        LockedAcryn=3
        Name=<"><">
        NonSearchable=1
        Priority=80
        Special=1
    }
    ShuBK_Discount50 ^{
        Cost=50
        KindGraph=DiscountMM_50
        LockedAcryn=3
        Name=<"><">
        NonSearchable=1
        Priority=50
        Special=1
    }
    ShuBK_Discount75 ^{
        Cost=25
        KindGraph=DiscountMM_75
        LockedAcryn=3
        Name=<"><">
        NonSearchable=1
        Priority=20
        Special=1
    }
}
Script ^{
    Mod_ShuBK ^{
		GrandBKSale1=Сегодня бизнес-центр #0# устроил крупную распродажу, сделав скидки от двадцати до пятидесяти процентов на большую часть ассортимента. Спешите купить новое оборудование по низким ценам!
        GrandBKSale2=Недавно бизнес-центр #0# сделал скидки на большую часть ассортимента своего магазина оборудования. Наиболее экономные рейнджеры и предприниматели уже направились в систему #1#, чтобы приобрести двигатели, топливные баки, радары, сканеры и многое другое по выгодным ценам.
        GrandBKSale3=Все желающие основательно закупиться приглашаются в систему #0#, где бизнес-центр #1# в рамках программы поддержки малоимующих пилотов снизил цены на значительную часть товара.
        GrandBKSale4=Бизнес-центр #0#, находящийся в системе #1#, устроил очередную акцию по снижению цен на предлагаемый на станции ассортимент, нацеленную на привлечение пилотов низшего сословия. Магазины станции предлагают широкий спектр оборудования и оружия со скидками от двадцати до пятидесяти процентов.
        GrandBKSale5=Бизнес-центр #0# принял участие в регулярной акции, в ходе которой на станцию было завезено множество дешевого товара и бывшего в употреблении оборудования, а также сделаны крупные скидки на ранее представленный ассортимент. Поторопитесь в звездную систему #1#, если вы заинтересованы данным предложением.
    }
}
ShipInfo ^{
    AddInfo ^{
        CustomInfos ^{
            ShuBK_SellerBKMarkInfo ^{
                Description=Скрытая инфошка, отмечает собой бизнес-центр с идущей на нём распродажей
                Icon=0
                Name=
				OnActCodeTypes=t_OnStep
				OnActStepTypes=11
                OnActCode ^{
					//Если время распродажи подошло к концу
					01=if(CurTurn()>=ShipCustomShipInfoData(0,CurInfo(),1))
					02 ^{
						01=dword cur_ruin=ScriptItemActShip();
						02=int dis_25=FindBonusByNameInCfg('ShuBK_Discount25');
						03=int dis_50=FindBonusByNameInCfg('ShuBK_Discount50');
						04=int dis_75=FindBonusByNameInCfg('ShuBK_Discount75');
						05=for(int i=0;i<ShopItems(cur_ruin);i=i+1)
						06 ^{
							01=dword item=ShopItems(cur_ruin,i);
							02=int cur_MM=EqModule(item);
							03=if(cur_MM == dis_25)ModuleToEquipment(-1,item);
							04=else if(cur_MM == dis_50)ModuleToEquipment(-1,item);
							05=else if(cur_MM == dis_75)ModuleToEquipment(-1,item);
						}
						07=ShipDeleteCustomShipInfo(cur_ruin,'ShuBK_SellerBKMarkInfo');
					}
				}
			}
            ShuBK_SaleInfo ^{
                Description=Скрытая инфошка, снимает микромодули-скидки с предметов при их покупке
                Icon=0
                Name=
				OnActCodeTypes=t_OnStep,t_OnEnteringForm,t_OnReEnteringForm,t_OnLeavingForm
				OnActStepTypes=0
                OnActCode ^{
					01=dword cur_info=CurInfo();
					02=if(ScriptItemActionType(t_OnStep,0))
					03 ^{
						01=if(ShipOrder(Player()) == 5)ShipDeleteCustomShipInfo(Player(),'ShuBK_BKSaleInfo');
					}
					04=else if(ScriptItemActionType(t_OnEnteringForm) || ScriptItemActionType(t_OnReEnteringForm))
					05 ^{
						01=if(CurrentForm() == 'Ship')
						02 ^{
							01=int dis_25=FindBonusByNameInCfg('ShuBK_Discount25');
							02=int dis_50=FindBonusByNameInCfg('ShuBK_Discount50');
							03=int dis_75=FindBonusByNameInCfg('ShuBK_Discount75');
							//Перебираем галасобытия, ищем свежекупленные предметы
							04=for(int i=GalaxyEvents()-1; i>=0; i=i-1)
							05 ^{
								01=if(i <= ShipCustomShipInfoData(0,cur_info,2))break;
								02=if(GalaxyEventDate(i) < CurTurn())break;
								03=if(GalaxyEventType(i) == 'PlayerBuysEquipment')
								04 ^{
									01=if(GalaxyEventData(i,5) == ShipCustomShipInfoData(0,cur_info,1))
									02 ^{
										01=dword item=IdToItem(GalaxyEventData(i,3));
										02=int cur_MM=EqModule(item);
										//Снимаем скидку, если нашли таковую на купленном предмете
										03=if(cur_MM == dis_75)ModuleToEquipment(-1,item);
										04=else if(cur_MM == dis_50)ModuleToEquipment(-1,item);
										05=else if(cur_MM == dis_25)ModuleToEquipment(-1,item);
									}
								}
							}
							//Запоминаем просмотренные номера событий, чтобы не прогонять по ним предметы второй раз
							06=ShipCustomShipInfoData(0,cur_info,2,GalaxyEvents()-1);
						}
					}
					06=else if(ScriptItemActionType(t_OnLeavingForm))
					07 ^{
						01=if(CurrentForm() == 'EquipmentShop')
						02 ^{
							01=dis_25=FindBonusByNameInCfg('ShuBK_Discount25');
							02=dis_50=FindBonusByNameInCfg('ShuBK_Discount50');
							03=dis_75=FindBonusByNameInCfg('ShuBK_Discount75');
							//Перебираем галасобытия, ищем свежекупленные предметы
							04=for(i=GalaxyEvents()-1; i>=0; i=i-1)
							05 ^{
								01=if(i <= ShipCustomShipInfoData(0,cur_info,2))break;
								02=if(GalaxyEventDate(i) < CurTurn())break;
								03=if(GalaxyEventType(i) == 'PlayerBuysEquipment')
								04 ^{
									01=if(GalaxyEventData(i,5) == ShipCustomShipInfoData(0,cur_info,1))
									02 ^{
										01=item=IdToItem(GalaxyEventData(i,3));
										02=cur_MM=EqModule(item);
										//Снимаем скидку, если нашли таковую на купленном предмете
										03=if(cur_MM == dis_75)ModuleToEquipment(-1,item);
										04=else if(cur_MM == dis_50)ModuleToEquipment(-1,item);
										05=else if(cur_MM == dis_25)ModuleToEquipment(-1,item);
									}
								}
							}
							//Запоминаем просмотренные номера событий, чтобы не прогонять по ним предметы второй раз
							06=ShipCustomShipInfoData(0,cur_info,2,GalaxyEvents()-1);
						}
					}
                }
            }
        }
    }
}