{
  "FileID":  573785173,
  "FileVersion":  8,
  "ViewPos.x":  -240,
  "ViewPos.y":  -81,
  "ScriptName":  "Mod_ShuWarriors",
  "ScriptFileOut":  "H:\\Mod_ShuWarriors.scr",
  "ScriptTextOut":  "H:\\Mod_ShuWarriors.txt",
  "GraphPoint.Count":  166,
  "GraphLink.Count":  105,
  "GraphRectText.Count":  0,
  "Variables.Count":  53,
  "Stars.Count":  1,
  "Planets.Count":  1,
  "Ships.Count":  1,
  "States.Count":  6,
  "Groups.Count":  4,
  "Places.Count":  0,
  "Items.Count":  0,
  "Ethers.Count":  0,
  "Dialogs.Count":  6,
  "DialogMessages.Count":  15,
  "DialogAnswers.Count":  16,
  "Operations.Count":  33,
  "Statements.Count":  30,
  "Loops.Count":  0,
  "Visual.Objects":  
  [
    {
      "DialogAnswers":      
      [
        {
          "Type":  "TDialogAnswer",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  43,
          "#":  45,
          "Msg":  "<tstr3>",
          "AMsg.Num":  "0"        
        },
        {
          "Type":  "TDialogAnswer",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  44,
          "#":  46,
          "Msg":  "<tstr2>",
          "AMsg.Num":  "1"        
        },
        {
          "Type":  "TDialogAnswer",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  52,
          "#":  56,
          "Msg":  "<tstr2>",
          "AMsg.Num":  "2"        
        },
        {
          "Type":  "TDialogAnswer",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  53,
          "#":  57,
          "Msg":  "<tstr3>",
          "AMsg.Num":  "3"        
        },
        {
          "Type":  "TDialogAnswer",
          "Name":  "block",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  55,
          "#":  58,
          "Msg":  "<tstr3>",
          "AMsg.Num":  "4"        
        },
        {
          "Type":  "TDialogAnswer",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  54,
          "#":  59,
          "Msg":  "<tstr4>",
          "AMsg.Num":  "5"        
        },
        {
          "Type":  "TDialogAnswer",
          "Name":  "exit",
          "Pos.x":  -20,
          "Pos.y":  100,
          "Parent":  89,
          "#":  88,
          "Msg":  "<tstr2>",
          "AMsg.Num":  "6"        
        },
        {
          "Type":  "TDialogAnswer",
          "Name":  "restart",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  92,
          "#":  93,
          "Msg":  "<tstr2>",
          "AMsg.Num":  "7"        
        },
        {
          "Type":  "TDialogAnswer",
          "Name":  "restart",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  38,
          "#":  114,
          "Msg":  "<tstr2>",
          "AMsg.Num":  "8"        
        },
        {
          "Type":  "TDialogAnswer",
          "Name":  "fastexit",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  121,
          "#":  122,
          "Msg":  "<tstr3>",
          "AMsg.Num":  "9"        
        },
        {
          "Type":  "TDialogAnswer",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  120,
          "#":  123,
          "Msg":  "<tstr2>",
          "AMsg.Num":  "10"        
        },
        {
          "Type":  "TDialogAnswer",
          "Name":  "fastexit",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  128,
          "#":  129,
          "Msg":  "<tstr2>",
          "AMsg.Num":  "11"        
        },
        {
          "Type":  "TDialogAnswer",
          "Name":  "fastexit",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  135,
          "#":  134,
          "Msg":  "<tstr2>",
          "AMsg.Num":  "12"        
        },
        {
          "Type":  "TDialogAnswer",
          "Name":  "exit",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  136,
          "#":  137,
          "Msg":  "<tstr2>",
          "AMsg.Num":  "13"        
        },
        {
          "Type":  "TDialogAnswer",
          "Name":  "fastexit",
          "Pos.x":  0,
          "Pos.y":  -20,
          "Parent":  139,
          "#":  140,
          "Msg":  "<tstr2>",
          "AMsg.Num":  "14"        
        },
        {
          "Type":  "TDialogAnswer",
          "Name":  "exit",
          "Pos.x":  20,
          "Pos.y":  0,
          "Parent":  147,
          "#":  148,
          "Msg":  "",
          "AMsg.Num":  "15"        
        }      
      ],
      "DialogMessages":      
      [
        {
          "Type":  "TDialogMsg",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  40,
          "Parent":  72,
          "#":  37,
          "Msg":  "<tstr1>",
          "DMsg.Num":  "0"        
        },
        {
          "Type":  "TDialogMsg",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  36,
          "#":  38,
          "Msg":  "<tstr1>",
          "DMsg.Num":  "1"        
        },
        {
          "Type":  "TDialogMsg",
          "Name":  "",
          "Pos.x":  -20,
          "Pos.y":  40,
          "Parent":  51,
          "#":  47,
          "Msg":  "<tstr1>",
          "DMsg.Num":  "2"        
        },
        {
          "Type":  "TDialogMsg",
          "Name":  "",
          "Pos.x":  -10,
          "Pos.y":  40,
          "Parent":  49,
          "#":  50,
          "Msg":  "<tstr1>",
          "DMsg.Num":  "3"        
        },
        {
          "Type":  "TDialogMsg",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  60,
          "#":  61,
          "Msg":  "<tstr1>",
          "DMsg.Num":  "4"        
        },
        {
          "Type":  "TDialogMsg",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  62,
          "#":  63,
          "Msg":  "<tstr1>",
          "DMsg.Num":  "5"        
        },
        {
          "Type":  "TDialogMsg",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  64,
          "#":  65,
          "Msg":  "<tstr1>",
          "DMsg.Num":  "6"        
        },
        {
          "Type":  "TDialogMsg",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  116,
          "#":  92,
          "Msg":  "<tstr1>",
          "DMsg.Num":  "7"        
        },
        {
          "Type":  "TDialogMsg",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  118,
          "#":  119,
          "Msg":  "<tstr1>",
          "DMsg.Num":  "8"        
        },
        {
          "Type":  "TDialogMsg",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  127,
          "#":  128,
          "Msg":  "<tstr1>",
          "DMsg.Num":  "9"        
        },
        {
          "Type":  "TDialogMsg",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  132,
          "#":  133,
          "Msg":  "<tstr1>",
          "DMsg.Num":  "10"        
        },
        {
          "Type":  "TDialogMsg",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  -20,
          "Parent":  124,
          "#":  139,
          "Msg":  "<tstr1>",
          "DMsg.Num":  "11"        
        },
        {
          "Type":  "TDialogMsg",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  144,
          "#":  146,
          "Msg":  "",
          "DMsg.Num":  "12"        
        },
        {
          "Type":  "TDialogMsg",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  151,
          "#":  152,
          "Msg":  "<tstr1>",
          "DMsg.Num":  "13"        
        },
        {
          "Type":  "TDialogMsg",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  155,
          "#":  156,
          "Msg":  "<tstr1>",
          "DMsg.Num":  "14"        
        }      
      ],
      "Dialogs":      
      [
        {
          "Type":  "TDialog",
          "Name":  "MilitaryOperationWBDialog",
          "Pos.x":  550,
          "Pos.y":  -40,
          "Parent":  -1,
          "#":  25        
        },
        {
          "Type":  "TDialog",
          "Name":  "PlanScr",
          "Pos.x":  -20,
          "Pos.y":  -140,
          "Parent":  66,
          "#":  67        
        },
        {
          "Type":  "TDialog",
          "Name":  "PlanScrChoose",
          "Pos.x":  -40,
          "Pos.y":  20,
          "Parent":  67,
          "#":  85        
        },
        {
          "Type":  "TDialog",
          "Name":  "OperationFlagshipDialog",
          "Pos.x":  100,
          "Pos.y":  -20,
          "Parent":  -1,
          "#":  117        
        },
        {
          "Type":  "TDialog",
          "Name":  "OperationWarriorDialog",
          "Pos.x":  260,
          "Pos.y":  -10,
          "Parent":  -1,
          "#":  150        
        },
        {
          "Type":  "TDialog",
          "Name":  "OperationWarriorSetTargetDialog",
          "Pos.x":  20,
          "Pos.y":  30,
          "Parent":  150,
          "#":  154        
        }      
      ],
      "Groups":      
      [
        {
          "Type":  "TGroup",
          "Name":  "PlayerState",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  4,
          "#":  6,
          "Owner":  62,
          "Group.Type":  126,
          "CntShipMin":  1,
          "CntShipMax":  1,
          "SpeedMin":  100,
          "SpeedMax":  10000,
          "Weapon":  0,
          "CargoHook":  0,
          "EmptySpace":  0,
          "AddPlayer":  true,
          "StatusTraderMin":  0,
          "StatusTraderMax":  100,
          "StatusWarriorMin":  0,
          "StatusWarriorMax":  100,
          "StatusPirateMin":  0,
          "StatusPirateMax":  100,
          "DistSearch":  10000,
          "Dialog":  -1,
          "StrengthMin":  "0",
          "StrengthMax":  "0",
          "Ruins":  ""        
        },
        {
          "Type":  "TGroup",
          "Name":  "OperativeWB",
          "Pos.x":  0,
          "Pos.y":  -150,
          "Parent":  4,
          "#":  26,
          "Owner":  62,
          "Group.Type":  126,
          "CntShipMin":  0,
          "CntShipMax":  0,
          "SpeedMin":  100,
          "SpeedMax":  10000,
          "Weapon":  0,
          "CargoHook":  0,
          "EmptySpace":  0,
          "AddPlayer":  false,
          "StatusTraderMin":  0,
          "StatusTraderMax":  100,
          "StatusWarriorMin":  0,
          "StatusWarriorMax":  100,
          "StatusPirateMin":  0,
          "StatusPirateMax":  100,
          "DistSearch":  10000,
          "Dialog":  -1,
          "StrengthMin":  "0",
          "StrengthMax":  "0",
          "Ruins":  ""        
        },
        {
          "Type":  "TGroup",
          "Name":  "OperativeWarriors",
          "Pos.x":  0,
          "Pos.y":  -200,
          "Parent":  4,
          "#":  28,
          "Owner":  62,
          "Group.Type":  126,
          "CntShipMin":  0,
          "CntShipMax":  0,
          "SpeedMin":  100,
          "SpeedMax":  10000,
          "Weapon":  0,
          "CargoHook":  0,
          "EmptySpace":  0,
          "AddPlayer":  false,
          "StatusTraderMin":  0,
          "StatusTraderMax":  100,
          "StatusWarriorMin":  0,
          "StatusWarriorMax":  100,
          "StatusPirateMin":  0,
          "StatusPirateMax":  100,
          "DistSearch":  10000,
          "Dialog":  -1,
          "StrengthMin":  "0",
          "StrengthMax":  "0",
          "Ruins":  ""        
        },
        {
          "Type":  "TGroup",
          "Name":  "RandomAttackers",
          "Pos.x":  0,
          "Pos.y":  -100,
          "Parent":  4,
          "#":  110,
          "Owner":  62,
          "Group.Type":  126,
          "CntShipMin":  0,
          "CntShipMax":  0,
          "SpeedMin":  100,
          "SpeedMax":  10000,
          "Weapon":  0,
          "CargoHook":  0,
          "EmptySpace":  0,
          "AddPlayer":  false,
          "StatusTraderMin":  0,
          "StatusTraderMax":  100,
          "StatusWarriorMin":  0,
          "StatusWarriorMax":  100,
          "StatusPirateMin":  0,
          "StatusPirateMax":  100,
          "DistSearch":  10000,
          "Dialog":  -1,
          "StrengthMin":  "0",
          "StrengthMax":  "0",
          "Ruins":  ""        
        }      
      ],
      "Operations":      
      [
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  30,
          "Pos.y":  0,
          "Parent":  5,
          "#":  0,
          "Total.Lines":  1,
          "Code.Type":  "Global",
          "Code":          
          [
              "GRun();"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  20,
          "Pos.y":  0,
          "Parent":  0,
          "#":  8,
          "Total.Lines":  681,
          "Code.Type":  "Init",
          "Code":          
          [
              "//Впервые заводим таймер до спавна группы элитных военных",
              "EliteWarriorsSpawnTimer = 0;//CurTurn() + Rnd(9, 121);",
              "",
              "//Стартовый проход по всем станциям в Галактике",
              "//Вешаются инфошки логики отступления на все военные базы",
              "for(i = 0; i < GalaxyStars(); i = i + 1)",
              "{",
              "    cur_star = GalaxyStar(i);",
              "    for(j = 0; j < StarRuins(cur_star); j = j + 1)",
              "    {",
              "        cur_ruin = StarRuins(cur_star, j);",
              "        str ruin_type = Format(ShipType(cur_ruin), '_licensed', '', '');",
              "        if(ruin_type != 'WB') continue;",
              "",
              "        if(ShipFindCustomShipInfoByType(cur_ruin, 'ShuWarriors_MilitaryBaseSpecialLogic') == -1)",
              "        {",
              "            ShipAddCustomShipInfo(cur_ruin, 'ShuWarriors_MilitaryBaseSpecialLogic', 'NoShow');",
              "        }",
              "    }",
              "}",
              "",
              "function SpawnEliteWarrior(planet, money_coef)",
              "{",
              "    dword ship = BuyWarrior(planet, money_coef);",
              "    ShipType(ship,'EliteWarrior');",
              "",
              "    //Случайно подбираем акрин для нового военного",
              "    int acryn = RndObject(1, 5, ship);",
              "    if(acryn == 1) acryn = FindBonusByNameInCfg('351'); //Скала (старая, не из ExpHulls)",
              "    else if(acryn == 2) acryn = FindBonusByNameInCfg('359'); //Неуязвимый корпус III",
              "    else if(acryn == 3) acryn = FindBonusByNameInCfg('367'); //Миоплазменный корпус III",
              "    else if(acryn == 4) acryn = FindBonusByNameInCfg('371'); //Пигамарный корпус III",
              "    else acryn = FindBonusByNameInCfg('478'); //Корпус \"Броненосец\" III",
              "",
              "    //Надеваем акрин",
              "    SpecialToEquipment(acryn, ShipItems(ship, 0));",
              "    Chameleon(ship);",
              "",
              "    //Повышаем навыки элитного военного",
              "    ShipSkill(ship, 0, RndObject(4, 6, ship));",
              "    ShipSkill(ship, 1, RndObject(4, 6, ship));",
              "    ShipSkill(ship, 2, RndObject(3, 6, ship));",
              "    ShipSkill(ship, 3, RndObject(1, 2, ship));",
              "    ShipSkill(ship, 4, RndObject(1, 3, ship));",
              "    ShipSkill(ship, 5, RndObject(1, 4, ship));",
              "",
              "    //А также его звание до уровня не ниже истребителя",
              "    ShipRaiseRank(ship, max(4, ShipRank(ship)));",
              "",
              "    ShipRefit(ship);",
              "    ShipRefit(ship);",
              "    ShipRefit(ship);",
              "",
              "    ShipImproveItems(ship, RndObject(3, 8, ship));",
              "",
              "    result = ship;",
              "}",
              "",
              "//Для удобного вычисления полной, а не текущей силы кораблей",
              "function GetShipBestStrength(dword ship)",
              "{",
              "    int hp = HullHP(ship, 'To100');",
              "    ShipCalcParam(ship);",
              "    result = ShipStrengthInBestRanger(ship);",
              "    HullHP(ship, hp);",
              "    ShipCalcParam(ship);",
              "}",
              "function GetShipAverageStrength(dword ship)",
              "{",
              "    int hp = HullHP(ship, 'To100');",
              "    ShipCalcParam(ship);",
              "    result = ShipStrengthInAverageRanger(ship);",
              "    HullHP(ship, hp);",
              "    ShipCalcParam(ship);",
              "}",
              "",
              "function CutStrLenght(str line, int lenght)",
              "{",
              "    if(count(line) > lenght)",
              "    {",
              "        line = substr(line, 0, lenght - 2); //Снимаем с конца всего 2 символа вместо 3, т.к. символы точек сами по себе очень небольшие",
              "        if(substr(line, lenght - 3, 1) == ' ') line = substr(line, 0, lenght - 3); //Если последний оставшийся символ в строке - пробел",
              "        line = line + '...';",
              "    }",
              "",
              "    result = line;",
              "}",
              "",
              "function InitNewWBOperation(ref operation_array, dword military_base_id, int by_player = 0)",
              "{",
              "    ArrayClear(operation_array);",
              "    ArrayDelete(operation_array, 0);",
              "",
              "    ArrayAdd(operation_array, CurTurn(), 'PlanningDay'); //Нужен, чтобы не обнулять настройки операции каждый раз, когда игрок выходит из диалога планирования",
              "    ArrayAdd(operation_array, military_base_id, 'MilitaryBaseId');",
              "    //Возможные уровни вовлечения игрока в организацию атаки (полностью аналогично значениям operation_lvl):",
              "    //OrganizedByPlayer == 0 - игрок не может заказать никакую операцию, поскольку имеет 0 звание",
              "    //OrganizedByPlayer == 1 - игрок может заказать обычную операцию (аналог ванильной), когда целевую систему и состав нападающих определяет ВБ, а игрок только платит",
              "    //OrganizedByPlayer == 2 - игрок может заказать операцию, а также может выбрать один из флагманов (если он будет среди военных кораблей) своим командным кораблём и самолично повести атакующую группу в бой",
              "    //OrganizedByPlayer == 3 - игрок может заказать операцию с участием до двух флагманов, а также сам выбирает систему для атаки",
              "    //OrganizedByPlayer == 4 - игрок может заказать операцию с участием до двух флагманов (включая один дредноут, если подключена EvoArmada) и самой ВБ, а также сам выбирает систему для атаки",
              "    ArrayAdd(operation_array, by_player, 'OrganizedByPlayer');",
              "    ArrayAdd(operation_array, 0, 'StarToAttackId'); //Id звезды",
              "    //rrayAdd(operation_array, newarray(1), 'EnemyForcesId');",
              "    ArrayAdd(operation_array, newarray(1), 'AlliesForcesId'); //Список Id участвующих в атаке военных кораблей (после постройки корабли с планет из списка ниже также переносятся сюда)",
              "    ArrayAdd(operation_array, newarray(1), 'ShipyardsInvolvedId'); //Список Id планет (формат 'Id планеты,ход завершения постройки'), на которых будет запущено строительство новых кораблей для усиления атакующей группировки",
              "    ArrayAdd(operation_array, 0, 'FlagshipId'); //Id флагмана, возглавляющего атаку (имеет значение для игрока, решившего использовать линкор в качестве флагмана)",
              "    ArrayAdd(operation_array, 0, 'GatheringPlaceId'); //Id звезды, либо самой ВБ, если атакующие силы отправятся в бой вместе с ней",
              "    ArrayAdd(operation_array, 0, 'AttackDate'); //Дата начала атаки, когда военные корабли или ВБ получит приказ совершить прыжок в атакуемую систему",
              "    ArrayAdd(operation_array, 0, 'OperationCost'); //Для сохранения стоимости между вызовом диалогов",
              "}",
              "",
              "//Использовать общескриптовые плейсы, к сожалению, нельзя, т.к. одновременно может быть запущенно сразу несколько военных операций",
              "function OrderMoveToGatherPoint(dword ship, int oper_num)",
              "{",
              "    float angle = 0.01 * RndObject(0, 200, ship);",
              "    int dist = RndObject(0, round(0.95 * GlobalWBOperationsArray[oper_num, 'GatheringPointRadius']), ship);",
              "    OrderMove(ship, round(sin(angle * pi) * dist) + GlobalWBOperationsArray[oper_num, 'GatheringPointCoordX'], round(cos(angle * pi) * dist) + GlobalWBOperationsArray[oper_num, 'GatheringPointCoordY']);",
              "}",
              "function IsAllAtGatherPoint(int oper_num)",
              "{",
              "    int coordX = GlobalWBOperationsArray[oper_num, 'GatheringPointCoordX'];",
              "    int coordY = GlobalWBOperationsArray[oper_num, 'GatheringPointCoordY'];",
              "    int dist_to = GlobalWBOperationsArray[oper_num, 'GatheringPointRadius'];",
              "    for(int i = ArrayDim(GlobalWBOperationsArray[oper_num, 'AlliesForcesId']) - 1; i >= 1; i = i - 1)",
              "    {",
              "        dword ship = IdToShip(GlobalWBOperationsArray[oper_num, 'AlliesForcesId', i]);",
              "        if(Id(ShipStar(ship)) != GlobalWBOperationsArray[oper_num, 'GatheringPlaceId'])",
              "        {",
              "            result = 0;",
              "            exit;",
              "        }",
              "        if(DistCoords(coordX, coordY, CoordX(ship), CoordY(ship)) > dist_to)",
              "        {",
              "            result = 0;",
              "            exit;",
              "        }",
              "    }",
              "",
              "    result = 1;",
              "}",
              "function IsShipAtGatherPoint(dword ship, int oper_num)",
              "{",
              "    if(Id(ShipStar(ship)) != GlobalWBOperationsArray[oper_num, 'GatheringPlaceId'])",
              "    {",
              "        result = 0;",
              "        exit;",
              "    }",
              "    if(DistCoords(GlobalWBOperationsArray[oper_num, 'GatheringPointCoordX'], GlobalWBOperationsArray[oper_num, 'GatheringPointCoordY'], CoordX(ship), CoordY(ship)) > GlobalWBOperationsArray[oper_num, 'GatheringPointRadius'])",
              "    {",
              "        result = 0;",
              "        exit;",
              "    }",
              "",
              "    result = 1;",
              "}",
              "function IsAllAtMilitaryBase(dword base, int oper_num)",
              "{",
              "    for(int i = ArrayDim(GlobalWBOperationsArray[oper_num, 'AlliesForcesId']) - 1; i >= 1; i = i - 1)",
              "    {",
              "        dword ship = IdToShip(GlobalWBOperationsArray[oper_num, 'AlliesForcesId', i]);",
              "        if(GetShipRuins(ship) != base)",
              "        {",
              "            result = 0;",
              "            exit;",
              "        }",
              "    }",
              "",
              "    result = 1;",
              "}",
              "",
              "function AttackWarriorsActCode() //t_OnDeath",
              "{",
              "    dword warrior = ScriptItemActShip();",
              "    int oper_num = GetData(3, warrior);",
              "    warrior = Id(warrior);",
              "    for(int i = ArrayDim(GlobalWBOperationsArray[oper_num, 'AlliesForcesId']) - 1; i >= 1; i = i - 1)",
              "    {",
              "        if(GlobalWBOperationsArray[oper_num, 'AlliesForcesId', i] == warrior)",
              "        {",
              "            ArrayDelete(GlobalWBOperationsArray[oper_num, 'AlliesForcesId'], i);",
              "            exit;",
              "        }",
              "    }",
              "}",
              "",
              "function FindAllMilitaryShipsInSector(dword sector, ref array, int cost_count = 0)",
              "{",
              "    //Принцип ванильного подбора военных в группу для атаки системы (флагманы добавляются в группу, наряду с обычными военными):",
              "    //Военные собираются с одного случайного сектора, в котором обязательно должны присутствовать вражеские корабли (полностью коалиционный сектор выберет, только если на него в момент проверки напали)",
              "    //Проверяемый сектор обновляется при каждом новом запросе игрока с ВБ (но может рандомно выбрать один и тот же сектор несколько раз подряд) и поэтому постоянно снимает с него деньги, а не только при успехе поиска",
              "    //Перебор набирает военных в группу до тех пор, пока их суммарная относительная сила не сравняются с силой врага в атакуемой системе",
              "    //Сперва в группу добавляются военные, которые сидят на своих планетах, и только если их не хватило, происходит добавление тех, кто в данный момент занят чем-то ещё (на патруле или в другой системе, например)",
              "    //В группу никогда не набираются корабли с приказом преследования, т.к. считается, что они сражаются, а потому заняты",
              "",
              "    ArrayClear(array);",
              "",
              "    unknown warriors = newarray(1);",
              "    unknown battleships = newarray(1);",
              "    unknown dreadnoughts = newarray(1);",
              "    if(cost_count) //Если необходимо прикинуть стоимость \"найма\" военных на операцию с ВБ, то проще сделать это сразу",
              "    {",
              "        int cost;",
              "        unknown warriors_cost = newarray(1);",
              "        unknown battleships_cost = newarray(1);",
              "        unknown dreadnoughts_cost = newarray(1);",
              "    }",
              "    int wars_count = 0;",
              "    for(int i = ConStars(sector) - 1; i >= 0; i = i - 1)",
              "    {",
              "        dword star = ConStar(sector, i);",
              "        if(StarOwner(star)) continue; //Если система не под контролем Коалиции",
              "        if(StarBattle(star)) continue; //Если система под атакой",
              "",
              "        for(int j = StarPlanets(star) - 1; j >= 0; j = j - 1)",
              "        {",
              "            dword planet = StarPlanets(star, j);",
              "            if(PlanetOwner(planet) == None) continue;",
              "",
              "            for(int k = PlanetWarriors(planet) - 1; k >= 0; k = k - 1)",
              "            {",
              "                dword warrior = PlanetWarriors(planet, k);",
              "                if(ShipOrder(warrior) == 6) continue; //Если с кем-то сражается",
              "                if(ShipInGameEvent(warrior)) continue;",
              "                if(ShipInScript(warrior, 0))",
              "                {",
              "                    if(GetShipScriptName(warrior, 3) != 'Mod_EvoArmada.Dreadnought') continue;",
              "                }",
              "",
              "                //Обычный/элитный военный",
              "                if(!ShipSubType(warrior))",
              "                {",
              "                    ArrayAdd(warriors, warrior);",
              "                    if(cost_count) ArrayAdd(warriors_cost, CalcHireWarriorCost(warrior, 0));",
              "                }",
              "                else",
              "                {",
              "                    //Линкор",
              "                    if(ShipType(warrior) != 'Dreadnought')",
              "                    {",
              "                        ArrayAdd(battleships, warrior);",
              "                        if(cost_count) ArrayAdd(battleships_cost, CalcHireWarriorCost(warrior, 1));",
              "                    }",
              "                    //Дредноут (выносим в отдельную категорию, чтобы отсекать их при недостаточном звании/авторитете игрока)",
              "                    else",
              "                    {",
              "                        ArrayAdd(dreadnoughts, warrior);",
              "                        if(cost_count) ArrayAdd(dreadnoughts_cost, CalcHireWarriorCost(warrior, 2));",
              "                    }",
              "                }",
              "",
              "                wars_count = wars_count + 1;",
              "            }",
              "        }",
              "    }",
              "",
              "    ArrayAdd(array, warriors, 'Warriors');",
              "    warriors = newarray(1);",
              "    ArrayAdd(array, battleships, 'Battleships');",
              "    battleships = newarray(1);",
              "    ArrayAdd(array, dreadnoughts, 'Dreadnoughts');",
              "    dreadnoughts = newarray(1);",
              "    if(cost_count)",
              "    {",
              "        ArrayAdd(array, warriors_cost, 'WarriorsHireCost');",
              "        warriors_cost = newarray(1);",
              "        ArrayAdd(array, battleships_cost, 'BattleshipsHireCost');",
              "        battleships_cost = newarray(1);",
              "        ArrayAdd(array, dreadnoughts_cost, 'DreadnoughtsHireCost');",
              "        dreadnoughts_cost = newarray(1);",
              "    }",
              "",
              "    result = wars_count; //Чисто для возможности быстрой проверки, был ли найден хоть кто-нибудь",
              "}",
              "",
              "//Фактически обе эти функции одинаковы, но пофиг, т.к. понятые читабельные названия важнее",
              "function FindWBOperation(dword military_base_id)",
              "{",
              "    for(int i = ArrayDim(GlobalWBOperationsArray) - 1; i >= 1; i = i - 1)",
              "    {",
              "        if(GlobalWBOperationsArray[i, 'MilitaryBaseId'] == military_base_id)",
              "        {",
              "            result = i;",
              "            exit;",
              "        }",
              "    }",
              "",
              "    result = 0;",
              "}",
              "function FindObjectInArray(ref array, dword obj)",
              "{",
              "    for(int i = ArrayDim(array) - 1; i >= 1; i = i - 1)",
              "    {",
              "        if(array[i] == obj)",
              "        {",
              "            result = i;",
              "            exit;",
              "        }",
              "    }",
              "",
              "    result = -1;",
              "}",
              "",
              "//Ищет систему в автоматическом режиме, либо собирает массив подходящих для атаки систем, которые может выбрать игрок",
              "function FindStarToAttack(dword ruin = 0, ref array)",
              "{",
              "    //Принцип ванильного определения системы для атаки:",
              "    //Каждая захваченная врагом система суммирует дистанции до всех коалиционных систем в Галактике, после чего сумма этих дистанций перемножается на Rnd(1.0, 2.0)",
              "    //по итогу выбирается система с наименьшим значением",
              "",
              "    unknown stars_arr = newarray(1);",
              "    unknown dist_arr = newarray(1);",
              "    dist_arr[0] = -1; //Для корректности сортировки ебучих дабомассивов",
              "",
              "    dword pirate_sector = StarToCon(PlanetToStar(PlanetPirateClan()));",
              "    for(int i = GalaxyStars() - 1; i >= 0; i = i - 1)",
              "    {",
              "        dword star = GalaxyStar(i);",
              "        if(!StarOwner(star)) continue; //Проверяем только враждебные Коалиции системы",
              "        if(StarBattle(star)) continue;",
              "        if(StarToCon(star) == pirate_sector) continue;",
              "",
              "        int dist_summ = 0;",
              "        for(int j = GalaxyStars() - 1; j >= 1; j = j - 1)",
              "        {",
              "            dword coal_star = GalaxyStar(j);",
              "            if(StarOwner(coal_star)) continue; //Запоминаем дистанции только до коалиционных систем",
              "            if(StarCustomFaction(coal_star) != '') continue;",
              "            dist_summ = dist_summ + StarNearbyStarsDist(star, j);",
              "        }",
              "",
              "        ArrayAdd(stars_arr, star);",
              "        ArrayAdd(dist_arr, dist_summ);",
              "    }",
              "",
              "    //Заносим в массив список всех подходящих для атаки систем (далее игрок будет сам выбирать из списка)",
              "    //Игроку на выбор будут доступны N систем с ближайшими суммами дистанций до Коалиционных систем",
              "    if(GetVariableType(array) == 9)//if(array)",
              "    {",
              "        ArrayClear(array);",
              "        ArraySort(dist_arr, stars_arr);",
              "        for(i = 1; i < ArrayDim(stars_arr); i = i + 1) ArrayAdd(array, stars_arr[i]);",
              "        exit;",
              "    }",
              "    //Выбираем систему автоматически, по ванильному принципу",
              "    else",
              "    {",
              "        if(ruin) for(i = ArrayDim(dist_arr) - 1; i >= 1; i = i - 1) dist_arr[i] = round(0.1 * RndObject(10, 20, ruin) * dist_arr[i]);",
              "        else if(ruin) for(i = ArrayDim(dist_arr) - 1; i >= 1; i = i - 1) dist_arr[i] = round(0.1 * Rnd(10, 20) * dist_arr[i]);",
              "        ArraySort(dist_arr, stars_arr);",
              "        result = stars_arr[1];",
              "        exit;",
              "    }",
              "}",
              "",
              "function CalcHireWarriorCost(dword warrior, int type = 0)",
              "{",
              "    //Обычный военный",
              "    if(!type)",
              "    {",
              "        float coef = PortionInDiapason(GetShipBestStrength(warrior), 0.1, 10.0, 0.3, 3.0);",
              "        result = round(coef * GalaxyMoney(2, ShipPilotRace(warrior)));",
              "    }",
              "    //Линкор",
              "    else if(type == 1)",
              "    {",
              "        coef = PortionInDiapason(GetShipBestStrength(warrior), 0.75, 750.0, 2.5, 7.5);",
              "        result = round(coef * GalaxyMoney(2, ShipPilotRace(warrior)) * 12.5);",
              "    }",
              "    //Дредноут",
              "    else if(type == 2)",
              "    {",
              "        coef = PortionInDiapason(GetShipBestStrength(warrior), 1.0, 1000.0, 3.75, 12.5);",
              "        result = round(coef * GalaxyMoney(2, ShipPilotRace(warrior)) * 7.5);",
              "    }",
              "    //Военная база",
              "    else /*if(type == 3)*/",
              "    {",
              "        coef = PortionInDiapason(GetShipBestStrength(warrior), 1.0, 1000.0, 3.75, 12.5);",
              "        result = round(coef * GalaxyMoney(2, ShipPilotRace(warrior)) * 7.5);",
              "    }",
              "}",
              "",
              "function CalcBuildWarriorStats(dword planet, int type = 0)",
              "{",
              "    //Считаем цену постройки военного на данной планете (чем более продвинута планета по ТУ, тем дороже обойдётся постройка)",
              "    if(!type)",
              "    {",
              "        int stat = PlanetInventionLevel(planet, 7) - GalaxyTechLevel();",
              "        float coef = max(1.0 + (0.15 * stat), 0.2); //От 0.2 до 2.2",
              "        result = round(coef * GalaxyMoney(2, PlanetRace(planet)) * 3.0);",
              "    }",
              "    //Считаем условную силу будущего военного (также зависит от ТУ планеты)",
              "    else",
              "    {",
              "        stat = PlanetInventionLevel(planet, 7) - GalaxyTechLevel();",
              "        coef = max(1.0 + (0.15 * stat), 0.2); //От 0.2 до 2.2",
              "        result = round(coef * average_warrior_power);",
              "    }",
              "}",
              "",
              "function TransformShipsIntoEachOther(dword player, dword flagship)",
              "{",
              "    //Первым кораблём всегда должен быть игрок!",
              "    //Чтобы игрок мог продолжать пользоваться своими транками, но при этом случайно не получил чужих",
              "    str trancs_str = '';",
              "    for(int i = ShipArts(player); i >= 0; i = i - 1)",
              "    {",
              "        dword art = ShipArts(player, i);",
              "        if(ItemType(art) != t_ArtefactTranclucator) continue;",
              "        if(trancs_str != '') trancs_str = trancs_str + ',' + art;",
              "        else trancs_str = art;",
              "    }",
              "",
              "    ShipExchangeToShip(player, flagship, 0); //Обмен списками предметов, включая корпуса",
              "    ShipCalcParam(player);",
              "    ShipCalcParam(flagship);",
              "",
              "    dword hull = ShipEqInSlot(Player(), t_Hull);",
              "    //Выставляю и снимаю NoDrop, чтобы игрок не мог крашнуть игру, кликнув на флагманский корпус, для которого не имеется графики предмета",
              "    if(HullType(hull) == 10) hull_no_drop_mark = NoDropItem(hull, 1); //Игрок садится на флагман",
              "    else NoDropItem(ShipEqInSlot(flagship, t_Hull), hull_no_drop_mark); //Игрок покидает флагман",
              "",
              "    for(i = ShipArts(player); i >= 0; i = i - 1)",
              "    {",
              "        art = ShipArts(player, i);",
              "        if(ItemType(art) != t_ArtefactTranclucator) continue;",
              "        GetArtFromShip(player, art);",
              "        AddItemToShip(flagship, art);",
              "    }",
              "    for(i = ParsCountFromString(trancs_str, ','); i >= 0; i = i - 1)",
              "    {",
              "        art = GetParFromString(trancs_str, ',', i, 0);",
              "        GetArtFromShip(flagship, art);",
              "        AddItemToShip(player, art);",
              "    }",
              "",
              "    //По умолчанию вместе с пушками также переносятся и цели, записанные в них, а это нам здесь вообще не к чему",
              "    for(i = ShipCntWeapon(player); i >= 1; i = i - 1) WeaponTarget(ShipWeapon(player, i), 0);",
              "    for(i = ShipCntWeapon(flagship); i >= 1; i = i - 1) WeaponTarget(ShipWeapon(flagship, i), 0);",
              "",
              "    ShipExchangeToShip(player, flagship, 1); //Обмен ShipSpecialBonuses()",
              "",
              "    //Не хочу усложнять обмен инфошками сверх необходимости",
              "    i = ShipFindCustomShipInfoByType(player, 'EvoArmada_CapitalShipInfos');",
              "    if(~i)",
              "    {",
              "        i = ShipCustomShipInfoData(player, i, 1);",
              "        ShipDeleteCustomShipInfo(player, 'EvoArmada_CapitalShipInfos');",
              "        ShipSpecialBonuses(player, bonAttacks, 0);",
              "    }",
              "    int j = ShipFindCustomShipInfoByType(flagship, 'EvoArmada_CapitalShipInfos');",
              "    if(~j)",
              "    {",
              "        j = ShipCustomShipInfoData(flagship, j, 1);",
              "        ShipDeleteCustomShipInfo(flagship, 'EvoArmada_CapitalShipInfos');",
              "        ShipSpecialBonuses(flagship, bonAttacks, 0);",
              "    }",
              "",
              "    if(~i)",
              "    {",
              "        ShipAddCustomShipInfo(flagship, 'EvoArmada_CapitalShipInfos', 'NoShow', i);",
              "        ShipSpecialBonuses(flagship, bonAttacks, i);",
              "    }",
              "    if(~j)",
              "    {",
              "        ShipAddCustomShipInfo(player, 'EvoArmada_CapitalShipInfos', 'NoShow', j);",
              "        ShipSpecialBonuses(player, bonAttacks, j);",
              "    }",
              "",
              "    i = ShipFindCustomShipInfoByType(player, 'ShuNukes_NuclearMissiles');",
              "    if(~i)",
              "    {",
              "        //Сбрасываем маркер выстрела, который игрок, возможно, выставил перед посадкой на флагман или наоборот",
              "        ShipCustomShipInfoData(player, i, 1, 0);",
              "        ShipCustomShipInfoTextData(player, i, 3, '');",
              "",
              "        //Игрок садится на флагман",
              "        if(HullType(hull) == 10)",
              "        {",
              "            //Ищем ядерное оружие также на флагмане",
              "            j = ShipFindCustomShipInfoByType(flagship, 'ShuNukes_NPCNuclearMissiles');",
              "            if(j == -1) j = ShipFindCustomShipInfoByType(flagship, 'ShuNukes_NPCNuclearMissilesNoArmada');",
              "            if(~j)",
              "            {",
              "                //Взаимообмен",
              "                str params = ShipCustomShipInfoTextData(flagship, j, 1); //Тип экипированных торпед",
              "                ShipCustomShipInfoTextData(flagship, j, 1, ShipCustomShipInfoTextData(player, i, 1, params));",
              "                params = ShipCustomShipInfoTextData(flagship, j, 2); //Количество шахт и, через запятую, Id предмета, занимающего вес под установки",
              "                ShipCustomShipInfoTextData(flagship, j, 2, ShipCustomShipInfoTextData(player, i, 2, params));",
              "            }",
              "",
              "            //Пускай часть работы инфошка выполнит за меня автоматически",
              "            CreateActCodeEvent(t_OnPlayerChangeHull, 'ShuNukes_NuclearMissiles', Player(), ShipEqInSlot(Player(), t_Hull), ShipEqInSlot(flagship, t_Hull));",
              "            CreateActCodeEvent(t_OnReEnteringForm, 'ShuNukes_NuclearMissiles', Player(), 0, 0);",
              "",
              "            //Переносим таймер перезарядки флагмана на игрока (t_OnPlayerChangeHull заводит его с нуля)",
              "            if(~j) ShipCustomShipInfoData(player, i, 3, ShipCustomShipInfoData(flagship, j, 3));",
              "        }",
              "        //Игрок покидает флагман",
              "        else",
              "        {",
              "            //Ищем ядерное оружие также на флагмане",
              "            j = ShipFindCustomShipInfoByType(flagship, 'ShuNukes_NPCNuclearMissiles');",
              "            if(j == -1) j = ShipFindCustomShipInfoByType(flagship, 'ShuNukes_NPCNuclearMissilesNoArmada');",
              "            if(~j)",
              "            {",
              "                //Обновляем количество оставшихся на флагмане торпед с учётом тех, которые мог выстрелить игрок",
              "                dword nukes = RunFunctionFromScript('Mod_ShuNukes', 'FindShipItemById', flagship, ShipCustomShipInfoTextData(flagship, j, 3));",
              "                if(nukes) ShipCustomShipInfoData(flagship, j, 1, ItemSize(nukes, 'Count'));",
              "                else throw 'Choosed nuke torpedos are missing at hold of ' + Name(flagship) + '!';",
              "",
              "                //Взаимообмен",
              "                params = ShipCustomShipInfoTextData(player, i, 1); //Тип экипированных торпед",
              "                ShipCustomShipInfoTextData(player, i, 1, ShipCustomShipInfoTextData(flagship, j, 1, params));",
              "                params = ShipCustomShipInfoTextData(player, i, 2); //Количество шахт и, через запятую, Id предмета, занимающего вес под установки",
              "                ShipCustomShipInfoTextData(player, i, 2, ShipCustomShipInfoTextData(flagship, j, 2, params));",
              "            }",
              "",
              "            //Пускай часть работы инфошка выполнит за меня автоматически",
              "            CreateActCodeEvent(t_OnPlayerChangeHull, 'ShuNukes_NuclearMissiles', Player(), ShipEqInSlot(Player(), t_Hull), ShipEqInSlot(flagship, t_Hull));",
              "            CreateActCodeEvent(t_OnReEnteringForm, 'ShuNukes_NuclearMissiles', Player(), 0, 0);",
              "",
              "            //Переносим таймер перезарядки игрока (который типа управлял флагманом) на флагман (t_OnPlayerChangeHull заводит его с нуля)",
              "            if(~j)",
              "            {",
              "                ShipCustomShipInfoData(flagship, j, 3, ShipCustomShipInfoData(player, i, 3));",
              "                ShipCustomShipInfoData(player, i, 3, 0); //И сбрасываем таймер перезарядки игроку (типа перезарядила бортовая команда)",
              "            }",
              "        }",
              "    }",
              "",
              "    //Проверка на камуфляж игрока (меняет скин автоматически, так что запоминать его через Chameleon() не нужно)",
              "    if(~PlayerUsedCamo) //Ранее камуфляж был записан в переменную, активируем",
              "    {",
              "        PlayerChameleonCurType(PlayerUsedCamo);",
              "        //PlayerChameleonDetected(PlayerUsedCamo, PlayerUsedCamoDetect);",
              "        PlayerChameleonDetected(PlayerUsedCamo, 1); //Логично, что после вылета игрока прямо из флагмана, доминаторы НАВЕРНЯКА что-то заподозрят",
              "        PlayerUsedCamo = -1;",
              "        //PlayerUsedCamoDetect = 0;",
              "    }",
              "    else //Иначе записываем в переменную камуфляж, который, возможно, надет на игрока сейчас, после чего снимаем его",
              "    {",
              "        PlayerUsedCamo = PlayerChameleonCurType();",
              "        if(~PlayerUsedCamo)",
              "        {",
              "            //PlayerUsedCamoDetect = PlayerChameleonDetected(PlayerUsedCamo);",
              "            PlayerChameleonCurType(-1);",
              "        }",
              "    }",
              "",
              "    ShipExchangeToShip(player, flagship, 2); //Обмен графических оболочек (скинов)",
              "",
              "    str text = ShipName(player);",
              "    SetName(player, ShipName(flagship));",
              "    SetName(flagship, text);",
              "",
              "    i = ShipOwner(player);",
              "    ShipOwner(player, ShipOwner(flagship));",
              "    ShipOwner(flagship, i);",
              "",
              "    text = ShipType(player);",
              "    ShipType(player, ShipType(flagship));",
              "    ShipType(flagship, text);",
              "",
              "    ShipCalcParam(player);",
              "    ShipCalcParam(flagship);",
              "}",
              "",
              "function PlayerActCode() //t_OnStep11, t_OnChameleonConfusion",
              "{",
              "    if(ScriptItemActionType(t_OnStep))",
              "    {",
              "        if(ArrayDim(GlobalWBOperationsArray) <= 1) exit;",
              "",
              "        dword ship = GetShipRuins(Player());",
              "        if(ship)",
              "        {",
              "            //Игрок совершает посадку на флагман",
              "            if(ShipInCurScript(ship))",
              "            {",
              "                if(StateIs(ship, 'WarriorsOnAttack'))",
              "                {",
              "                    //На случай, если был подключён ExpScienceRanks и игрок летел на \"Клеще\"",
              "                    if(!findsubstr(BonusNumInCfg(HullSpecial(Player())), 'ExpScienceRanks_Tick')) InterfaceState('StarMap', 'TickHullModeSwitcher', 0);",
              "",
              "                    TransferShip(Player(), ShipStar(Player()));",
              "                    ShipSetCoords(Player(), CoordX(ship), CoordY(ship));",
              "                    ShipAngle(Player(), ShipAngle(ship));",
              "                    OrderNone(Player());",
              "",
              "                    TransferShip(ship, Player());",
              "                    OrderNone(ship);",
              "                    OrderLock(ship, 1);",
              "                    SetData(-3, 0, ship);",
              "",
              "                    if(ShipSkill(Player(), 'Leadership') >= 6) i = 2;",
              "                    else i = 3;",
              "                    TransformShipsIntoEachOther(Player(), ship);",
              "                    CapitalShipStats(Player(), 3);",
              "                    ShipSpecialBonuses(Player(), bonSkill1, ShipSpecialBonuses(Player(), bonSkill1) - i);",
              "                    ShipSpecialBonuses(Player(), bonSkill2, ShipSpecialBonuses(Player(), bonSkill2) - i);",
              "                    ShipAddCustomShipInfo(Player(), 'ShuWarriors_FlagshipDirectControl', '', Id(ship), i);",
              "",
              "                    ShipVisibility(Player(), -1, 0.0);",
              "",
              "                    dword star = ShipStar(Player());",
              "                    for(int i = StarPlanets(star) - 1; i >= 0; i = i - 1) NoLanding(StarPlanets(star, i), 1);",
              "                    for(i = StarRuins(star) - 1; i >= 0; i = i - 1) NoLanding(StarRuins(star, i), 1);",
              "                    NoJump(1);",
              "                }",
              "            }",
              "        }",
              "    }",
              "    else //if(ScriptItemActionType(t_OnChameleonConfusion))",
              "    {",
              "        if(!ScriptItemActParam()) exit; //Если корабль по умолчанию всегда распознаёт под камуфляжем игрока",
              "        if(ArrayDim(GlobalWBOperationsArray) <= 1) exit;",
              "        if(GetShipScriptName(ScriptItemActObject1(), 3) != 'Mod_ShuWarriors.OperativeWarriors') exit; //Если игрок ещё не достиг военного звания \"Истребитель\"",
              "        ScriptItemActParam(0);",
              "        exit;",
              "    }",
              "}",
              "",
              "//Вызывать строго из диалога MilitaryOperationWBDialog!",
              "function UpdateSidePowers()",
              "{",
              "    //Считаем силу атакующих военных, включая тех, которых дозаказал к постройке игрок",
              "    coals_cnt = 0;",
              "    big_coals_cnt = 0;",
              "    coals_power = 0.0;",
              "    for(int i = ArrayDim(new_operation_arr['AlliesForcesId']) - 1; i >= 1; i = i - 1)",
              "    {",
              "        dword ship = IdToShip(new_operation_arr['AlliesForcesId', i]);",
              "        if(ShipSubType(ship)) //Линкоры и дредноуты",
              "        {",
              "            big_coals_cnt = big_coals_cnt + 1;",
              "            coals_power = coals_power + GetShipAverageStrength(ship);",
              "            continue;",
              "        }",
              "",
              "        coals_cnt = coals_cnt + 1;",
              "        coals_power = coals_power + GetShipAverageStrength(ship);",
              "    }",
              "",
              "    if(new_operation_arr['GatheringPlaceId'] < 0)",
              "    {",
              "        coals_cnt = coals_cnt + 1;",
              "        coals_power = coals_power + GetShipAverageStrength(cur_ruin);",
              "    }",
              "",
              "    int cnt = ArrayDim(new_operation_arr['ShipyardsInvolvedId']);",
              "    if(cnt)",
              "    {",
              "        for(i = 1; i < cnt; i = i + 1) coals_power = coals_power + CalcBuildWarriorStats(IdToPlanet(new_operation_arr['ShipyardsInvolvedId', i]), 1);",
              "    }",
              "",
              "    //Считаем точную силу врага в атакуемой системе",
              "    dword star = GalaxyStar(new_operation_arr['StarToAttackId'] - 1);",
              "    enemies_cnt = 0;",
              "    enemies_power = 0;",
              "    for(i = StarShips(star) - 1; i >= 0; i = i - 1)",
              "    {",
              "        ship = StarShips(star, i);",
              "        if(ShipStanding(ship) >= 1 && ShipStanding(ship) <= 5) continue;",
              "        //Скипаем Блазера, Келлера и махпеллу про оценке сил в системе, т.к. все они товарищи непостоянные",
              "        if(ship == Blazer()) continue;",
              "        if(ship == Keller()) continue;",
              "        if(ShipType(ship) == 'Machpella') continue;",
              "",
              "        enemies_cnt = enemies_cnt + 1;",
              "        enemies_power = enemies_power + GetShipAverageStrength(ship);",
              "    }",
              "",
              "    //Слегка завышаем силы врага в системе в счёт его ожидаемого доспавна с планет во время боя",
              "    if(StarOwner(star) == 1) enemies_power = 1.25 * enemies_power;",
              "    else enemies_power = 0.75 * enemies_power; //Пираты - трусливые обрыганы",
              "",
              "    //Считаем соотношение сил между врагом в системе и атакующими военными в процентах",
              "    coals_power_percent = round((1.0 * coals_power) / (0.01 * enemies_power));",
              "}"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  20,
          "Pos.y":  0,
          "Parent":  113,
          "#":  9,
          "Total.Lines":  295,
          "Code.Type":  "Turn",
          "Code":          
          [
              "//Инфошки логики отступления развешиваются на все новопостроенные военные базы",
              "for(i = GalaxyEvents() - 1; i >= 0; i = i - 1)",
              "{",
              "    if(GalaxyEventDate(i) < CurTurn()) break;",
              "    if(GalaxyEventType(i) == 'RuinsCreated')",
              "    {",
              "        cur_ruin = IdToShip(GalaxyEventData(i, 1));",
              "        if(cur_ruin)",
              "        {",
              "            ruin_type = Format(ShipType(cur_ruin), '_licensed', '', '');",
              "            if(ruin_type != 'WB') continue;",
              "",
              "            if(ShipFindCustomShipInfoByType(cur_ruin, 'ShuWarriors_MilitaryBaseSpecialLogic') == -1)",
              "            {",
              "                ShipAddCustomShipInfo(cur_ruin, 'ShuWarriors_MilitaryBaseSpecialLogic', 'NoShow');",
              "            }",
              "        }",
              "    }",
              "}",
              "",
              "//Если в настоящий момент скриптом запущена хотя бы одна военная операция",
              "tint1 = ArrayDim(GlobalWBOperationsArray) - 1;",
              "if(tint1)",
              "{",
              "    for(i = tint1; i >= 1; i = i - 1)",
              "    {",
              "        //Если атакуемая система была как-либо захвачена Коалицией, то операция в любом случае завершена",
              "        cur_star = GalaxyStar(GlobalWBOperationsArray[i, 'StarToAttackId'] - 1);",
              "",
              "        check = 1;",
              "        if(!StarOwner(cur_star))",
              "        {",
              "            if(StarCustomFaction(cur_star) == '')",
              "            {",
              "                cur_ruin = IdToShip(GlobalWBOperationsArray[i, 'MilitaryBaseId']);",
              "                if(cur_ruin)",
              "                {",
              "                    //Если игрок уже лежит в криокапсуле на ВБ, то отменять операцию поздно",
              "                    if(GetShipRuins(Player()) != cur_ruin || CurrentForm() != 'Jump') check = 0;",
              "                }",
              "                else check = 0; //ВБ была уничтожена",
              "            }",
              "        }",
              "",
              "        //Проверка на завершение операции по причине освобождения атакуемой системы (даже если военные туда ещё не долетели)",
              "        if(!check)",
              "        {",
              "            if(cur_ruin) ShipOut(cur_ruin);",
              "            for(k = ArrayDim(GlobalWBOperationsArray[i, 'AlliesForcesId']) - 1; k >= 1; k = k - 1)",
              "            {",
              "                cur_ship = IdToShip(GlobalWBOperationsArray[i, 'AlliesForcesId', k]);",
              "",
              "                //Типа недостроенные военные, заказанные на планетах, \"отменяются\"",
              "                if(int(GetData(0, cur_ship)) > 0)",
              "                {",
              "                    if(StateIs(cur_ship, 'WarriorsOnPrepare'))",
              "                    {",
              "                        ShipOut(cur_ship);",
              "                        ShipDestroy(cur_ship, 1);",
              "                        ArrayDelete(GlobalWBOperationsArray[i, 'AlliesForcesId'], k);",
              "                        continue;",
              "                    }",
              "                }",
              "",
              "                //Если данный корабль является флагманом операции",
              "                if(GetData(0, cur_ship))",
              "                {",
              "                    //Если игрок находится в режиме прямого управления флагманом",
              "                    if(int(GetData(0, cur_ship)) == -3)",
              "                    {",
              "                        SetData(-4, 0, cur_ship);",
              "                        continue;",
              "                    }",
              "                    //Если игрок совершает посадку на флагман для перехода в режим прямого управления",
              "                    else if(ShipOrder(Player()) == 2)",
              "                    {",
              "                        if(ShipOrderObj(Player()) == cur_ship) OrderMove(Player(), CoordX(cur_ship), CoordY(cur_ship));",
              "                    }",
              "",
              "                    //Снимаем уникальный временный тип с флагмана",
              "                    ShipType(cur_ship, Format(ShipType(cur_ship), 'Flagship', '', ''));",
              "                }",
              "",
              "                OrderLock(cur_ship, 0);",
              "                ShipOut(cur_ship);",
              "                ArrayDelete(GlobalWBOperationsArray[i, 'AlliesForcesId'], k);",
              "            }",
              "            EtherDelete('ShuWarriors_Operation' + GlobalWBOperationsArray[i, 'MilitaryBaseId']);",
              "        }",
              "        else",
              "        {",
              "            //Если местом сбора военных была выбрана система",
              "            if(GlobalWBOperationsArray[i, 'GatheringPlaceId'] > -1)",
              "            {",
              "                //Если подошёл срок начинать операцию, начинаем её",
              "                if(GlobalWBOperationsArray[i, 'AttackDate'] <= CurTurn())",
              "                {",
              "                    //Если все военные уже добрались до точки сбора в системе (иначе откладываем начало)",
              "                    if(IsAllAtGatherPoint(i))",
              "                    {",
              "                        //Отправляем всех военных в атаку на целевую систему (смена стейта случится автоматически по прилёту)",
              "                        for(k = ArrayDim(GlobalWBOperationsArray[i, 'AlliesForcesId']) - 1; k >= 1; k = k - 1)",
              "                        {",
              "                            cur_ship = IdToShip(GlobalWBOperationsArray[i, 'AlliesForcesId', k]);",
              "                            SetData(-Id(cur_star), 1, cur_ship);",
              "                            SetData(0, 2, cur_ship);",
              "                            OrderLock(cur_ship, 0);",
              "                            ChangeState('WarriorsOnPrepare', cur_ship); //Сразу же применяем новый приказ",
              "                        }",
              "",
              "                        cur_ruin = IdToShip(GlobalWBOperationsArray[i, 'MilitaryBaseId']);",
              "                        if(cur_ruin) ShipOut(cur_ruin); //Больше нам ВБ по ходу операции не нужна",
              "                        EtherDelete('ShuWarriors_Operation' + GlobalWBOperationsArray[i, 'MilitaryBaseId']);",
              "                    }",
              "                }",
              "            }",
              "            //Если точкой сбора перед атакой для военных была выбрана ВБ",
              "            else",
              "            {",
              "                cur_ruin = IdToShip(GlobalWBOperationsArray[i, 'MilitaryBaseId']);",
              "                if(cur_ruin)",
              "                {",
              "                    //ВБ готовится к операции",
              "                    if(StateIs(cur_ruin, 'WBOnPrepare'))",
              "                    {",
              "                        //Если ВБ уже ушла в гипер на атакуемую систему",
              "                        if(ShipStar(cur_ruin) == cur_star)",
              "                        {",
              "                            for(k = ArrayDim(GlobalWBOperationsArray[i, 'AlliesForcesId']) - 1; k >= 1; k = k - 1)",
              "                            {",
              "                                cur_ship = IdToShip(GlobalWBOperationsArray[i, 'AlliesForcesId', k]);",
              "                                HullHP(cur_ship, 'To100');",
              "                                ShipRefit(cur_ship);",
              "                                ShipRefit(cur_ship);",
              "                                ShipImproveItems(cur_ship, 3);",
              "                                OrderLock(cur_ship, 0);",
              "                                ChangeState('WarriorsOnAttack', cur_ship);",
              "                            }",
              "",
              "                            ChangeState('WBOnAttack', cur_ruin);",
              "                            EtherDelete('ShuWarriors_Operation' + Id(cur_ruin));",
              "                        }",
              "                        else",
              "                        {",
              "                            if(GlobalWBOperationsArray[i, 'AttackDate'] <= CurTurn() + 1) //+1 здесь, чтобы предупредить выставление приказа телепортации ВБ на один день",
              "                            {",
              "                                //Если ещё не все военные добрались до ВБ (иначе откладываем начало)",
              "                                if(!IsAllAtMilitaryBase(cur_ruin, i)) ShipDestination(cur_ruin, 'Date', CurTurn() + 2);",
              "                            }",
              "",
              "                            //Пока ВБ находится в режиме подготовки к прыжку, она активно восстанавливает свой повреждённый корпус",
              "                            if(!StarBattle(ShipStar(cur_ruin)))",
              "                            {",
              "                                j = ItemSize(ShipItems(cur_ruin, 0));",
              "                                if(HullHP(cur_ruin) < j)",
              "                                {",
              "                                    j = round(0.034 * j);",
              "                                    HullHP(cur_ruin, HullHP(cur_ruin) + j);",
              "                                    //Из тёрна всё равно не получится...",
              "                                    //if(FilmFlags(0)) ShowEffect('Weapon.NoGraph', 0, cur_ruin, cur_ruin, j, 0, 0, 0,255,0);",
              "                                }",
              "                            }",
              "                        }",
              "                    }",
              "                }",
              "                else //Если ВБ была уничтожена",
              "                {",
              "                    for(k = ArrayDim(GlobalWBOperationsArray[i, 'AlliesForcesId']) - 1; k >= 1; k = k - 1)",
              "                    {",
              "                        cur_ship = IdToShip(GlobalWBOperationsArray[i, 'AlliesForcesId', k]);",
              "                        if(ShipStar(cur_ship) != GlobalWBOperationsArray[i, 'StarToAttackId'])",
              "                        {",
              "                            //Типа недостроенные военные, заказанные на планетах, \"отменяются\"",
              "                            if(int(GetData(0, cur_ship)) > 0)",
              "                            {",
              "                                if(StateIs(cur_ship, 'WarriorsOnPrepare'))",
              "                                {",
              "                                    ShipOut(cur_ship);",
              "                                    ShipDestroy(cur_ship, 1);",
              "                                    ArrayDelete(GlobalWBOperationsArray[i, 'AlliesForcesId'], k);",
              "                                    continue;",
              "                                }",
              "                            }",
              "",
              "                            if(GetData(0, cur_ship))",
              "                            {",
              "                                //Если игрок находится в режиме прямого управления флагманом",
              "                                if(int(GetData(0, cur_ship)) == -3)",
              "                                {",
              "                                    SetData(-4, 0, cur_ship);",
              "                                    continue;",
              "                                }",
              "                                //Если игрок совершает посадку на флагман для перехода в режим прямого управления",
              "                                else if(ShipOrder(Player()) == 2)",
              "                                {",
              "                                    if(ShipOrderObj(Player()) == cur_ship) OrderMove(Player(), CoordX(cur_ship), CoordY(cur_ship));",
              "                                }",
              "                            }",
              "",
              "                            OrderLock(cur_ship, 0);",
              "                            ShipOut(cur_ship);",
              "                            ArrayDelete(GlobalWBOperationsArray[i, 'AlliesForcesId'], k);",
              "                        }",
              "                    }",
              "                    EtherDelete('ShuWarriors_Operation' + GlobalWBOperationsArray[i, 'MilitaryBaseId']);",
              "                }",
              "            }",
              "        }",
              "",
              "        //Если все участники операции уничтожены, либо были выведены из скрипта, удаляем операцию",
              "        //(больше игрок с ней всё равно ничего сделать не сможет, даже если в атакуемой системе по-прежнему висит скакнувшая туда ВБ)",
              "        if(ArrayDim(GlobalWBOperationsArray[i, 'AlliesForcesId']) <= 1)",
              "        {",
              "            //Проверка на случай, если сама ВБ ещё жива и готовится к скачку",
              "            check = 1;",
              "            if(GlobalWBOperationsArray[i, 'GatheringPlaceId'] == -1)",
              "            {",
              "                cur_ruin = IdToShip(GlobalWBOperationsArray[i, 'MilitaryBaseId']);",
              "                if(cur_ruin)",
              "                {",
              "                    if(StateIs(cur_ruin, 'WBOnPrepare')) check = 0;",
              "                }",
              "            }",
              "",
              "            //Если с операцией уже ну совсем ничего нельзя сделать - удаляем её",
              "            if(check)",
              "            {",
              "                //Перед удалением операции из массива производим перенумерацию в скриптовых объектах военных в операциях выше по списку",
              "                //(короче говоря, компенсируем будущий сдвиг)",
              "                for(j = tint1; j > i; j = j - 1)",
              "                {",
              "                    for(k = ArrayDim(GlobalWBOperationsArray[j, 'AlliesForcesId']) - 1; k >= 1; k = k - 1)",
              "                    {",
              "                        cur_ship = IdToShip(GlobalWBOperationsArray[j, 'AlliesForcesId', k]);",
              "                        SetData(j - 1, 3, cur_ship);",
              "                    }",
              "                }",
              "",
              "                tint1 = tint1 - 1;",
              "                EtherDelete('ShuWarriors_Operation' + IdToShip(GlobalWBOperationsArray[i, 'MilitaryBaseId']));",
              "                ArrayDelete(GlobalWBOperationsArray, i);",
              "            }",
              "        }",
              "    }",
              "}",
              "",
              "//Если пришло время постройки новой партии элитных военных",
              "if(CurTurn() >= EliteWarriorsSpawnTimer)",
              "{",
              "    //Выбирается подходящая для спавна система, с военной базой и текущим числом военных менее N",
              "    ArrayClear(tarr1);",
              "    cur_ruin = 0;",
              "    for(i = GalaxyStars() - 1; i >= 0; i = i - 1)",
              "    {",
              "        cur_star = GalaxyStar(i);",
              "",
              "        //Пропускаем не коалиционные системы и системы, в которых в данный момент идёт бой",
              "        if(StarOwner(cur_star) != 0) continue;",
              "        if(StarBattle(cur_star)) continue;",
              "",
              "        //Пропускаем системы без военной базы",
              "        if(!StarRuins(cur_star, 'WB')) continue;",
              "",
              "        //Считаем военные корабли в системе и если их более 7, пропускаем систему",
              "        check = 0;",
              "        for(j = StarPlanets(cur_star) - 1; j >= 0; j = j - 1)",
              "        {",
              "            cur_planet = StarPlanets(cur_star, j);",
              "            if(PlanetOwner(cur_planet) == None) continue;",
              "            check = check + PlanetWarriors(cur_planet);",
              "        }",
              "",
              "        if(check < 7) ArrayAdd(tarr1, cur_star);",
              "        else continue;",
              "    }",
              "",
              "    //Если таковые системы найдены, начинается строительство военных в случайной из них",
              "    if(ArrayDim(tarr1) > 1)",
              "    {",
              "        cur_star = tarr1[Rnd(1, ArrayDim(tarr1) - 1, GetObjectGenerationSeed(GalaxyPtr()) + sqr(CurTurn()))];",
              "        cur_ruin = StarRuins(cur_star, 'WB');",
              "",
              "        //Спавним на выбранной планете от 5 до 8 элитных военных",
              "        for(i = RndObject(5, 8, cur_planet); i >= 1; i = i - 1)",
              "        {",
              "            cur_ship = SpawnEliteWarrior(FindPlanet(cur_star, 'NotNone'), 500);",
              "            //После чего отправляем их на военную базу, чтобы сымитировать его \"рождение\" корабля именно на ней",
              "            TransferShip(cur_ship, cur_ruin);",
              "        }",
              "",
              "        //Обновляем таймер до следующего возможного спавна группы элитных военных",
              "        //От двух до трёх лет",
              "        EliteWarriorsSpawnTimer = CurTurn() + Rnd(730, 1095);",
              "    }",
              "}"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  20,
          "Pos.y":  0,
          "Parent":  8,
          "#":  10,
          "Total.Lines":  176,
          "Code.Type":  "DialogBegin",
          "Code":          
          [
              "cur_ruin = GetShipRuins(Player());",
              "if(cur_ruin)",
              "{",
              "    if(ShipType(cur_ruin) == 'PlayerBridge')",
              "    {",
              "        //Если игрок в данный момент управляет флагманом",
              "        if(~ShipFindCustomShipInfoByType(Player(), 'ShuWarriors_FlagshipDirectControl'))",
              "        {",
              "            if(PlayerBridge() == 3)",
              "            {",
              "                cur_ship = IdToShip(ShipCustomShipInfoData(Player(), 'ShuWarriors_FlagshipDirectControl', 1));",
              "                tstr1 = Format(CT('Script.Mod_ShuWarriors.OperationFlagshipDialog.PlayerAbandonFlagship'), '<Flagship'+'>', Name(Player()));",
              "                AddDialogInject('OperationFlagshipDialog', '', tstr1, 50, 0, 3);",
              "            }",
              "        }",
              "    }",
              "    else if(ShipType(cur_ruin) == 'WB')",
              "    {",
              "        AddDialogBlock(CT('FormRuins.WB.WarOperation.PlayerSend'), 2); //Блокируем ванильный диалог о заказе военной операции (он всё равно говно)",
              "",
              "        if(!ShipOnSidePirateClan(Player()))",
              "        {",
              "            //Если ВБ уже организует операцию (в том числе, если сама она никуда не летит)",
              "            on_prepare = 0;",
              "            if(ShipInCurScript(cur_ruin))",
              "            {",
              "                if(StateIs(cur_ruin, 'WBOnPrepare')) on_prepare = 1;",
              "            }",
              "",
              "            if((!ShipInGameEvent(cur_ruin) && ShipInNormalSpace(cur_ruin)) || on_prepare)",
              "            {",
              "                check = (!ShipInScript(cur_ruin, 0) && !ShipOrder(cur_ruin) && !ShipDestination(cur_ruin) && !StarBattle(ShipStar(cur_ruin)));",
              "",
              "                //Возможные уровни вовлечения игрока в организацию атаки (зависят от военного звания и навыка лидерства):",
              "                //operation_lvl == 0 - игрок не может заказать никакую операцию, поскольку имеет 0 звание",
              "                //operation_lvl == 1 - игрок может заказать обычную операцию (аналог ванильной), когда целевую систему и состав нападающих определяет ВБ, а игрок только платит",
              "                //operation_lvl == 2 - игрок может заказать операцию, а также может выбрать один из флагманов (если он будет среди военных кораблей) своим командным кораблём и самолично повести атакующую группу в бой",
              "                //operation_lvl == 3 - игрок может заказать операцию с участием флагманов, а также сам выбирает систему для атаки",
              "                //operation_lvl == 4 - игрок может заказать операцию с участием флагманов (включая дредноуты, если подключена EvoArmada) и самой ВБ, а также сам выбирает систему для атаки",
              "                int leadership = ShipSkill(Player(), 'Leadership');",
              "                operation_lvl = 0;",
              "                player_rank = ShipRank(Player());",
              "                if(player_rank >= 7) //Адмирал",
              "                {",
              "                    if(leadership == 6) operation_lvl = 4;",
              "                    else operation_lvl = 3;",
              "                    player_str_rank = lowercase(CT('Rank.Admiral.Name'));",
              "                }",
              "                else if(player_rank == 6) //Командор",
              "                {",
              "                    if(leadership == 6) operation_lvl = 3;",
              "                    else operation_lvl = 2;",
              "                    player_str_rank = lowercase(CT('Rank.Commander.Name'));",
              "                }",
              "                else if(player_rank == 5) //Ас (Пилот)",
              "                {",
              "                    if(leadership == 6) operation_lvl = 2;",
              "                    else operation_lvl = 1;",
              "                    player_str_rank = lowercase(CT('Rank.Ace.Name'));",
              "                }",
              "                else if(player_rank == 4) //Истребитель",
              "                {",
              "                    operation_lvl = 1;",
              "                    player_str_rank = lowercase(CT('Rank.Leader.Name'));",
              "                }",
              "                else if(player_rank == 3) //Капитан",
              "                {",
              "                    operation_lvl = 1;",
              "                    player_str_rank = lowercase(CT('Rank.Wingman.Name'));",
              "                }",
              "                else if(player_rank == 2) //Пилот",
              "                {",
              "                    operation_lvl = 1;",
              "                    player_str_rank = lowercase(CT('Rank.Pilot.Name'));",
              "                }",
              "                else if(player_rank == 1) //Кадет",
              "                {",
              "                    operation_lvl = 1;",
              "                    player_str_rank = lowercase(CT('Rank.Cadet.Name'));",
              "                }",
              "                else player_str_rank = lowercase(CT('Rank.Rookie.Name')); //Новичок",
              "",
              "                //operation_lvl = 4; //Для отладки",
              "                dialog_path = 'Script.Mod_ShuWarriors.MilitaryOperationWBDialog.OnLevel' + operation_lvl;",
              "",
              "                if(!on_prepare)",
              "                {",
              "                    cur_sector = StarToCon(ShipStar(cur_ruin));",
              "                    operation_num = 0; //Будет получен после инициализации новой операции",
              "                    coals_power_percent = 0; //Т.к. атакующие ещё не выбраны",
              "",
              "                    if(operation_lvl == 1)",
              "                    {",
              "                        min_coals_power_percent = 100;",
              "                        max_coals_power_percent = 200; //Чисто визуальный индикатор критического превосходства",
              "                        stars_cnt_to_choose = 15; //Выбирается из этого числа автоматически",
              "                        //min_warriors_to_add_WB = 5;",
              "                    }",
              "                    else if(operation_lvl == 2)",
              "                    {",
              "                        min_coals_power_percent = 100;",
              "                        max_coals_power_percent = 200; //Чисто визуальный индикатор критического превосходства",
              "                        stars_cnt_to_choose = 15; //Выбирается из этого числа автоматически",
              "                        //min_warriors_to_add_WB = 5;",
              "                    }",
              "                    else if(operation_lvl == 3)",
              "                    {",
              "                        min_coals_power_percent = 85;",
              "                        max_coals_power_percent = 200; //Чисто визуальный индикатор критического превосходства",
              "                        stars_cnt_to_choose = 10; //Выбирает игрок",
              "                        //min_warriors_to_add_WB = 5;",
              "                    }",
              "                    else /*if(operation_lvl == 4)*/",
              "                    {",
              "                        min_coals_power_percent = 75;",
              "                        max_coals_power_percent = 200; //Чисто визуальный индикатор критического превосходства",
              "                        stars_cnt_to_choose = 15; //Выбирает игрок",
              "                        min_warriors_to_add_WB = 5;",
              "                    }",
              "",
              "                    if(!check) AddDialogBlock(CT(dialog_path + '.PlayerRequestOperation'), 1);",
              "                    AddDialogInject('MilitaryOperationWBDialog', '', CT('Script.Mod_ShuWarriors.MilitaryOperationWBDialog.OnLevel' + operation_lvl + '.PlayerRequestOperation'), 0, 0, 1);",
              "                }",
              "                else",
              "                {",
              "                    operation_num = FindWBOperation(Id(cur_ruin));",
              "                    AddDialogInject('MilitaryOperationWBDialog', '', CT(dialog_path + '.PlayerAskWBPrepareStatus'), 0, 0, 1);",
              "                }",
              "            }",
              "        }",
              "    }",
              "}",
              "else",
              "{",
              "    cur_ship = GetTalkShip();",
              "    if(cur_ship)",
              "    {",
              "        if(ShipInCurScript(cur_ship))",
              "        {",
              "            if(StateIs(cur_ship, 'WarriorsOnAttack'))",
              "            {",
              "                if(!TalkByAI())",
              "                {",
              "                    operation_num = GetData(3, cur_ship);",
              "",
              "                    //Игрок запрашивает разрешение у флагмана взять его под свой контроль",
              "                    i = GetData(0, cur_ship);",
              "                    if(i == -2)",
              "                    {",
              "                        tstr1 = CT('Script.Mod_ShuWarriors.OperationFlagshipDialog.PlayerAskDirectControl');",
              "                        AddDialogInject('OperationFlagshipDialog', '', tstr1, 0, 0, 1);",
              "                    }",
              "                    //Флагман принудительно прекращает прямой контроль игрока над собой",
              "                    else if(i < -3)",
              "                    {",
              "                        AddDialogOverride('OperationFlagshipDialog', 10000, 2);",
              "                        exit;",
              "                    }",
              "",
              "                    //Только со 2 уровня вовлечённости игрока",
              "                    if(GlobalWBOperationsArray[operation_num, 'OrganizedByPlayer'] >= 2)",
              "                    {",
              "                        tstr1 = CT('Script.Mod_ShuWarriors.OperationWarriorDialog.PlayerOrderTarget');",
              "                        AddDialogInject('OperationWarriorDialog', '', tstr1, 0, 0, 0);",
              "                        tdwd1 = IdToShip(GetData(1, cur_ship), 1);",
              "                        if(tdwd1) //Если военному задана конкретная цель для атаки",
              "                        {",
              "                            tstr1 = Format(CT('Script.Mod_ShuWarriors.OperationWarriorDialog.PlayerOrderCancel'), '<Target'+'>', Name(tdwd1));",
              "                            AddDialogInject('OperationWarriorDialog', '', tstr1, 0, 0, 1);",
              "                        }",
              "                    }",
              "                }",
              "            }",
              "        }",
              "    }",
              "}"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  -20,
          "Pos.y":  0,
          "Parent":  30,
          "#":  31,
          "Total.Lines":  164,
          "Code.Type":  "Turn",
          "Code":          
          [
              "//Data0 == номер хода до начала движения военного к месту сбора (если >0) или маркер (-1), что данный военный является флагманом операции (ожидается, что это может быть только линкор или дредноут)",
              "//Data1 == Id системы сбора, в которую полетит данный военный перед тем, как получить приказ прыгать в атакуемую систему (если <0, значит, военный уже летит в систему атаки, если 0, значит, военный уже долетел, либо сбор назначен на ВБ)",
              "//Data2 == принимает 3 значения: 0 - лететь в скриптовое место GatheringPlace, <0 - Id атакуемой системы, который обнулится, как только первый военный из группы долетит до системы сбора и выставит координаты точки сбора, >0 - Id ВБ, на которой необходимо собраться и ждать дальнейших приказов",
              "//Data3 == номер операции в массиве GlobalWBOperationsArray, к которой приписан данный военный",
              "",
              "int time_left = GetData(0);",
              "if(time_left > 0)",
              "{",
              "    if(time_left <= CurTurn()) SetData(0, 0);",
              "    else exit; //Военный ещё \"не достроен\" - скипаем всю его логику",
              "}",
              "",
              "dword object;",
              "dword cur_star = ShipStar(CurShip);",
              "",
              "if(ShipInHyperSpace(CurShip)) exit; //Не трогаем военного, пока тот находится в гипере",
              "",
              "if(ShipInNormalSpace(CurShip))",
              "{",
              "    ShipFreeFlight(CurShip, 1); //Автонаведение орудий",
              "",
              "    object = ShipGetBad(CurShip);",
              "    if(object)",
              "    {",
              "        //Всяких рандомных уёбков-пиратов, нападающих на отдельных военных, атакующие будут валить всей отарой",
              "        //Через 10 дней этот корабль автоматически удалится из группы",
              "        if(!ShipInScript(object, 0)) ShipJoin(RandomAttackers, object, '', CurTurn() + 10);",
              "    }",
              "}",
              "",
              "//Совершаем прыжок (ебаная нумерация систем начинается с 0)",
              "if(GetData(1))",
              "{",
              "    if(!ShipInNormalSpace(CurShip))",
              "    {",
              "        OrderTakeOff(CurShip);",
              "        exit;",
              "    }",
              "",
              "    object = GalaxyStar(abs(int(GetData(1))) - 1);",
              "    if(cur_star != object)",
              "    {",
              "        OrderJump(CurShip, object);",
              "        exit;",
              "    }",
              "    else //Военный добрался до указанной системы",
              "    {",
              "        if(int(GetData(1)) < 0) //Отрицательный номер системы означает, что военный прилетел в атакуемую систему",
              "        {",
              "            SetData(0, 1);",
              "            ChangeState('WarriorsOnAttack');",
              "            exit;",
              "        }",
              "        else",
              "        {",
              "            SetData(0, 1);",
              "",
              "            //Если он добрался туда первый, то он же задаёт координаты точки прыжка всем остальным военным в своей группе",
              "            if(GetData(2))",
              "            {",
              "                int oper_num = GetData(3);",
              "",
              "                OrderJump(CurShip, GalaxyStar(abs(int(GetData(2))) - 1));",
              "",
              "                GlobalWBOperationsArray[oper_num, 'GatheringPointCoordX'] = ShipOrder(CurShip, 'X');",
              "                GlobalWBOperationsArray[oper_num, 'GatheringPointCoordY'] = ShipOrder(CurShip, 'Y');",
              "                int count_wars = ArrayDim(GlobalWBOperationsArray[oper_num, 'AlliesForcesId']) - 1;",
              "                if(count_wars <= 20) GlobalWBOperationsArray[oper_num, 'GatheringPointRadius'] = 150;",
              "                else if(count_wars <= 30) GlobalWBOperationsArray[oper_num, 'GatheringPointRadius'] = 200;",
              "                else GlobalWBOperationsArray[oper_num, 'GatheringPointRadius'] = 250;",
              "",
              "                for(i = count_wars; i >= 1; i = i - 1)",
              "                {",
              "                    dword warrior = IdToShip(GlobalWBOperationsArray[oper_num, 'AlliesForcesId', i]);",
              "                    SetData(0, 2, warrior); //Маркер движения в точку сбора в целевой системе",
              "                    ChangeState('WarriorsOnPrepare'); //На всякий случай сразу же дёргаем логику, если кто-то из военных вышел из гипера одновременно с этим кораблём в той же системе",
              "                }",
              "",
              "                //Если военному требуется дозаправка, то сперва отправляем его к ближайшей заселённой планете",
              "                if(ShipFuelLow(CurShip))",
              "                {",
              "                    if(!StarOwner(cur_star)) OrderLanding(CurShip, NearCivilPlanet(CurShip));",
              "                    else OrderMoveToGatherPoint(CurShip, GetData(3));",
              "                }",
              "                else OrderMoveToGatherPoint(CurShip, GetData(3));",
              "            }",
              "            else",
              "            {",
              "                //Если военному требуется дозаправка, то сперва отправляем его к ближайшей заселённой планете",
              "                if(ShipFuelLow(CurShip))",
              "                {",
              "                    if(!StarOwner(cur_star)) OrderLanding(CurShip, NearCivilPlanet(CurShip));",
              "                    else OrderMoveToGatherPoint(CurShip, GetData(3));",
              "                }",
              "                else OrderMoveToGatherPoint(CurShip, GetData(3));",
              "            }",
              "",
              "            exit;",
              "        }",
              "    }",
              "}",
              "//Садимся на указанную ВБ, либо здесь просто временно висит Id атакуемой системы",
              "else if(GetData(2))",
              "{",
              "    if(int(GetData(2)) > 0)",
              "    {",
              "        object = IdToShip(GetData(2));",
              "        if(object)",
              "        {",
              "            if(GetShipRuins(CurShip) != object)",
              "            {",
              "                dword object_star = ShipStar(object);",
              "                if(object_star != cur_star)",
              "                {",
              "                    if(!ShipInNormalSpace(CurShip)) OrderTakeOff(CurShip);",
              "                    else OrderJump(CurShip, object_star);",
              "                    exit;",
              "                }",
              "                else",
              "                {",
              "                    if(!ShipInNormalSpace(CurShip)) OrderTakeOff(CurShip);",
              "                    else OrderLanding(CurShip, object);",
              "                    exit;",
              "                }",
              "            }",
              "            else //Военный долетел и совершил посадку на ВБ, теперь просто ожидаем от неё дальнейших приказов",
              "            {",
              "                exit;",
              "            }",
              "        }",
              "        else //Целевую ВБ уничтожили, операция отменяется",
              "        {",
              "            ShipOut(CurShip);",
              "            exit;",
              "        }",
              "    }",
              "}",
              "else if(!GetData(2))",
              "{",
              "    //Летим в указанное скриптовое место (в точку сбора перед прыжком)",
              "    if(!ShipInNormalSpace(CurShip))",
              "    {",
              "        ShipRefuel(CurShip);",
              "        OrderTakeOff(CurShip);",
              "    }",
              "    else",
              "    {",
              "        //Если военному требуется дозаправка, то сперва отправляем его к ближайшей заселённой планете",
              "        if(ShipFuelLow(CurShip))",
              "        {",
              "            if(!StarOwner(cur_star)) OrderLanding(CurShip, NearCivilPlanet(CurShip));",
              "            else OrderMoveToGatherPoint(CurShip, GetData(3));",
              "        }",
              "        else OrderMoveToGatherPoint(CurShip, GetData(3));",
              "    }",
              "    exit;",
              "}",
              "",
              "if(!ShipOrder(CurShip))",
              "{",
              "    OrderLock(CurShip, 0);",
              "    ShipFreeFlight(CurShip);",
              "    OrderLock(CurShip, 1);",
              "}"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  -20,
          "Pos.y":  0,
          "Parent":  32,
          "#":  33,
          "Total.Lines":  132,
          "Code.Type":  "Turn",
          "Code":          
          [
              "//Data0 == маркер (от -1 до -4), что данный военный является флагманом операции (ожидается, что это может быть только линкор или дредноут)",
              "//Data1 == ---",
              "//Data2 == ---",
              "//Data3 == номер операции в массиве GlobalWBOperationsArray, к которой приписан данный военный",
              "",
              "if(RelationToShip(CurShip, Player()) < 10)",
              "{",
              "    if(GetData(0))",
              "    {",
              "        //Если игрок находится в режиме прямого управления флагманом",
              "        if(int(GetData(0)) == -3)",
              "        {",
              "            SetData(-4, 0);",
              "            ShipFreeFlight(CurShip);",
              "            exit; //На следующий ход из акткода будет вызван диалог",
              "        }",
              "        //Если игрок совершал посадку на флагман для перехода в режим прямого управления",
              "        else if(ShipOrder(Player()) == 2)",
              "        {",
              "            if(ShipOrderObj(Player()) == CurShip) OrderMove(Player(), CoordX(CurShip), CoordY(CurShip));",
              "        }",
              "    }",
              "",
              "    int oper_num = GetData(3, CurShip);",
              "    for(int i = ArrayDim(GlobalWBOperationsArray[oper_num, 'AlliesForcesId']) - 1; i >= 1; i = i - 1)",
              "    {",
              "        if(GlobalWBOperationsArray[oper_num, 'AlliesForcesId', i] == Id(CurShip))",
              "        {",
              "            ArrayDelete(GlobalWBOperationsArray[oper_num, 'AlliesForcesId'], i);",
              "            break;",
              "        }",
              "    }",
              "    ShipOut(CurShip);",
              "    OrderLock(CurShip, 0);",
              "    ShipFreeFlight(CurShip);",
              "    exit;",
              "}",
              "",
              "if(ShipInHyperSpace(CurShip, 1)) exit; //Не трогаем военного, пока тот находится в гипере (в том числе на борту ВБ)",
              "if(!ShipInNormalSpace(CurShip)) exit;",
              "",
              "OrderLock(CurShip, 0);",
              "ShipFreeFlight(CurShip);",
              "",
              "int flagman_mark = GetData(0);",
              "if(flagman_mark)",
              "{",
              "    //Флагман атаки вызывает игрока, чтобы предложить тому взять флагман под прямой контроль",
              "    if(flagman_mark == -1)",
              "    {",
              "        if(ShipStar(Player()) == ShipStar(CurShip))",
              "        {",
              "            if(ShipInNormalSpace(Player()))",
              "            {",
              "                if(!ShipOnSidePirateClan(Player()))",
              "                {",
              "                    if(Dist(Player(), CurShip) <= ShipRadarRange(Player()))",
              "                    {",
              "                        GAnswerData = 0;",
              "                        Dialog(OperationFlagshipDialog, CurShip);",
              "                        if(ShipOrder(Player()) == 2) //Если игрок согласился взять флагман под контроль",
              "                        {",
              "                            if(ShipOrderObj(Player()) == CurShip)",
              "                            {",
              "                                OrderLock(CurShip, 1);",
              "                                OrderFollowShip(CurShip, Player(), 0);",
              "                                SetData(0, 1); //На всякий случай обнуляем приказ атаки конкретной цели",
              "                                ShipFreeFlight(CurShip, 1);",
              "                                exit;",
              "                            }",
              "                        }",
              "                    }",
              "                }",
              "            }",
              "        }",
              "    }",
              "    //Если игрок совершает посадку на флагман с целью взять его под свой контроль",
              "    else if(flagman_mark == -2)",
              "    {",
              "        if(ShipOrder(Player()) == 2)",
              "        {",
              "            if(ShipOrderObj(Player()) == CurShip)",
              "            {",
              "                OrderLock(CurShip, 1);",
              "                OrderFollowShip(CurShip, Player(), 0);",
              "                ShipFreeFlight(CurShip, 1);",
              "                exit;",
              "            }",
              "        }",
              "    }",
              "    //Игрок управляет флагманом, самому флагману в этот момент ничего делать не надо",
              "    else if(flagman_mark == -3)",
              "    {",
              "        //Производим небольшой \"полевой ремонт\" орудий, чтобы игрок на флагмане не мог превратиться в совсем уж \"тыкву\"",
              "        for(i = ShipCntWeapon(Player()); i >= 1; i = i - 1)",
              "        {",
              "            dword gun = ShipWeapon(Player(), i);",
              "            if(ItemIsBroken(gun))",
              "            {",
              "                if(RndObject(1, 100, CurShip) <= 50) ItemDurability(gun, RndObject(5, 21, CurShip));",
              "            }",
              "            if(MissilesToRearm(gun))",
              "            {",
              "                if(RndObject(1, 100, CurShip) <= 50) MissilesToRearm(gun, 1);",
              "            }",
              "        }",
              "        exit;",
              "    }",
              "    //Игрока принудительно выгоняют с флагмана, после чего флагман сразу же выводится из скрипта",
              "    //else if(flagman_mark == -4) exit;",
              "}",
              "",
              "//Если военному была задана конкретная цель для атаки",
              "if(GetData(1))",
              "{",
              "    dword target = IdToShip(GetData(1));",
              "    if(target) //Если цель ещё жива",
              "    {",
              "        if(ShipStar(target) == ShipStar(CurShip))",
              "        {",
              "            OrderLock(CurShip, 1);",
              "            OrderFollowShip(CurShip, target, 1);",
              "            ShipSetBad(CurShip, target);",
              "        }",
              "        else ShipFreeFlight(CurShip);",
              "    }",
              "    else",
              "    {",
              "        SetData(0, 1);",
              "        ShipFreeFlight(CurShip);",
              "    }",
              "}"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  35,
          "#":  36,
          "Total.Lines":  106,
          "Code.Type":  "Turn",
          "Code":          
          [
              "if(operation_lvl >= 2)",
              "{",
              "    //Если военные участники атаки ещё живы",
              "    if(ArrayDim(GlobalWBOperationsArray[operation_num, 'AlliesForcesId']) > 1)",
              "    {",
              "        //Статус даты атаки (укладывается ли операция в заданный график)",
              "        if(GlobalWBOperationsArray[operation_num, 'GatheringPlaceId'] > -1) //Военные собираются в системе",
              "        {",
              "            if((GlobalWBOperationsArray[operation_num, 'AttackDate'] + 1) > CurTurn()) //Операция укладывается в график",
              "            {",
              "                tstr1 = CT(dialog_path + '.WBDateStatusOk');",
              "                tstr2 = Name(GalaxyStar(GlobalWBOperationsArray[operation_num, 'GatheringPlaceId'] - 1));",
              "                tstr3 = GameDateTxtByTurn(GlobalWBOperationsArray[operation_num, 'AttackDate'] + 1);",
              "            }",
              "            else //Операция выбилась из графика",
              "            {",
              "                tstr1 = CT(dialog_path + '.WBDateStatusDelayed');",
              "                tstr2 = Name(GalaxyStar(GlobalWBOperationsArray[operation_num, 'GatheringPlaceId'] - 1));",
              "                tstr3 = CurTurn() - GlobalWBOperationsArray[operation_num, 'AttackDate'];",
              "            }",
              "        }",
              "        else //Военные собираются на военной базе",
              "        {",
              "            if((GlobalWBOperationsArray[operation_num, 'AttackDate'] + 1) > CurTurn()) //Операция укладывается в график",
              "            {",
              "                tstr1 = CT(dialog_path + '.WBDateStatusOkWithWB');",
              "                tstr3 = GameDateTxtByTurn(GlobalWBOperationsArray[operation_num, 'AttackDate'] + 1);",
              "            }",
              "            else //Операция выбилась из графика",
              "            {",
              "                tstr1 = CT(dialog_path + '.WBDateStatusDelayedWithWB');",
              "                tstr3 = CurTurn() - GlobalWBOperationsArray[operation_num, 'AttackDate'];",
              "            }",
              "        }",
              "",
              "        tstr1 = Format(tstr1,",
              "                       '<PlayerRank'+'>', player_str_rank,",
              "                       '<StarToAttack'+'>', '<color=0,50,200>' + Name(GalaxyStar(GlobalWBOperationsArray[operation_num, 'StarToAttackId'] - 1)) + '</color>',",
              "                       '<GatheringStar'+'>', '<color=0,50,200>' + tstr2 + '</color>',",
              "                       '<AttackDate'+'>', '<color=0,50,200>' + tstr3 + '</color>',",
              "                       '');",
              "",
              "        //Список и статус всех военных, готовящихся к операции",
              "        tstr2 = '';",
              "        for(i = 1; i < ArrayDim(GlobalWBOperationsArray[operation_num, 'AlliesForcesId']); i = i + 1)",
              "        {",
              "            cur_ship = IdToShip(GlobalWBOperationsArray[operation_num, 'AlliesForcesId', i]);",
              "",
              "            tstr2 = tstr2 + Format('<br>') + '- <color=0,50,200>' + Name(cur_ship) + '</color>';",
              "            if(GlobalWBOperationsArray[operation_num, 'GatheringPlaceId'] > -1) //Военные собираются в системе",
              "            {",
              "                if(IsShipAtGatherPoint(cur_ship, operation_num)) tstr2 = tstr2 + ' ' + CT(dialog_path + '.WBPrepareStatusShipArrived'); //Военный уже в точке сбора",
              "                else //Военный ещё в пути",
              "                {",
              "                    if((GlobalWBOperationsArray[operation_num, 'AttackDate'] + 1) > CurTurn())",
              "                    {",
              "                        if(int(GetData(0, cur_ship)) > 0) tstr2 = tstr2 + ' ' + CT(dialog_path + '.WBPrepareStatusShipBuilding'); //Военный ещё не достроен",
              "                        else tstr2 = tstr2 + ' ' + CT(dialog_path + '.WBPrepareStatusShipOnItsWay'); //Военный в пути",
              "                    }",
              "                    else tstr2 = tstr2 + ' ' + CT(dialog_path + '.WBPrepareStatusShipShipDelayed'); //Военный задерживается",
              "                }",
              "            }",
              "            else //Военные собираются на военной базе",
              "            {",
              "                if(GetShipRuins(cur_ship) == cur_ruin) tstr2 = tstr2 + ' ' + CT(dialog_path + '.WBPrepareStatusShipArrived'); //Военный прибыл на ВБ",
              "                else //Военный ещё в пути",
              "                {",
              "                    if((GlobalWBOperationsArray[operation_num, 'AttackDate'] + 1) > CurTurn())",
              "                    {",
              "                        if(int(GetData(0, cur_ship)) > 0) tstr2 = tstr2 + ' ' + CT(dialog_path + '.WBPrepareStatusShipBuilding'); //Военный ещё не достроен",
              "                        else tstr2 = tstr2 + ' ' + CT(dialog_path + '.WBPrepareStatusShipOnItsWay'); //Военный в пути",
              "                    }",
              "                    else tstr2 = tstr2 + ' ' + CT(dialog_path + '.WBPrepareStatusShipShipDelayed'); //Военный задерживается",
              "                }",
              "            }",
              "        }",
              "",
              "        //Собираем готовую реплику",
              "        tstr1 = '</color>' + Format(CT(dialog_path + '.WBPrepareStatus'),",
              "                                      '<PlayerRank'+'>', player_str_rank,",
              "                                      '<DateStatus'+'>', tstr1,",
              "                                      '<AttackShipsList'+'>', tstr2,",
              "                                      '');",
              "    }",
              "    else //Если все военные были уничтожены по пути к ВБ",
              "    {",
              "        //Собираем готовую реплику",
              "        tstr1 = '</color>' + Format(CT(dialog_path + '.WBPrepareStatusNoShips'),",
              "                                      '<PlayerRank'+'>', player_str_rank,",
              "                                      '<MilitaryBase'+'>', '<color=0,50,200>' + ShipName(cur_ruin) + '</color>',",
              "                                      '<StarToAttack'+'>', '<color=0,50,200>' + Name(GalaxyStar(GlobalWBOperationsArray[operation_num, 'StarToAttackId'] - 1)) + '</color>',",
              "                                      '<AttackDate'+'>', '<color=0,50,200>' + GameDateTxtByTurn(GlobalWBOperationsArray[operation_num, 'AttackDate'] + 1) + '</color>',",
              "                                      '');",
              "    }",
              "",
              "    if((GlobalWBOperationsArray[operation_num, 'AttackDate'] + 1) > CurTurn()) tstr2 = '</color>' + CT(dialog_path + '.PlayerPrepareStatusOk');",
              "    else tstr2 = '</color>' + CT(dialog_path + '.PlayerPrepareStatusDelayed');",
              "}",
              "else //Если уровень вовлечённости игрока недостаточно высок, чтобы получать подробный отчёт",
              "{",
              "    tstr1 = '</color>' + Format(CT(dialog_path + '.WBPrepareStatus'),",
              "                                  '<PlayerRank'+'>', player_str_rank,",
              "                                  '<StarToAttack'+'>', '<color=0,50,200>' + Name(GalaxyStar(GlobalWBOperationsArray[operation_num, 'StarToAttackId'] - 1)) + '</color>',",
              "                                  '');",
              "    tstr2 = '</color>' + CT(dialog_path + '.PlayerPrepareStatus');",
              "}"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  46,
          "#":  49,
          "Total.Lines":  190,
          "Code.Type":  "Turn",
          "Code":          
          [
              "//Если уровень вовлечённости игрока слишком мал, то операция составляется за него автоматически",
              "if(operation_lvl <= 1)",
              "{",
              "    InitNewWBOperation(new_operation_arr, Id(cur_ruin), operation_lvl);",
              "",
              "    for(k = 1; k <= 15; k = k + 1)",
              "    {",
              "        //До N ближайших систем на выбор (лимит выставляется в начале диалога)",
              "        dword attack_star = stars_to_attack_arr[Rnd(1, min(ArrayDim(stars_to_attack_arr), stars_cnt_to_choose + 1), GetObjectGenerationSeed(GalaxyPtr()) + sqr(CurTurn() + 5363))];",
              "",
              "        //Автоматически выбираем место сбора",
              "        ArrayClear(tarr1);",
              "        tint1 = 5;",
              "        dword pirate_sector = StarToCon(PlanetToStar(PlanetPirateClan()));",
              "        for(i = 1; i < GalaxyStars(attack_star); i = i + 1)",
              "        {",
              "            cur_star = StarNearbyStars(attack_star, i);",
              "            if(StarOwner(cur_star)) continue;",
              "            if(StarCustomFaction(cur_star) != '') continue;",
              "            if(StarToCon(cur_star) == pirate_sector) continue;",
              "",
              "            //Нельзя выбрать систему в закрытом секторе или атакованную в настоящий момент",
              "            j = 0;",
              "            if(!SectorVisible(StarToCon(cur_star)) || StarBattle(cur_star))",
              "            {",
              "                tstr1 = DeleteTags(tstr1);",
              "                if(StarBattle(cur_star)) tstr1 = tstr1 + ' ' + CT(dialog_path + '.PlayerPlanningChooseStarUnderAttack');",
              "                j = 1;",
              "            }",
              "",
              "            if(!j) ArrayAdd(tarr1, Id(cur_star));",
              "",
              "            tint1 = tint1 - 1;",
              "            if(!tint1) break;",
              "        }",
              "",
              "        //Ищем подходящую система сбора среди доступных до тех пор, пока не найдём, либо пока не кончится счётчик переборов",
              "        ArrayClear(new_operation_arr['AlliesForcesId']);",
              "        if(ArrayDim(tarr1) > 1)",
              "        {",
              "            new_operation_arr['StarToAttackId'] = Id(attack_star);",
              "            new_operation_arr['GatheringPlaceId'] = tarr1[Rnd(1, ArrayDim(tarr1) - 1, GetObjectGenerationSeed(GalaxyPtr()) + sqr(CurTurn() + 8967))];",
              "",
              "            j = ArrayDim(militaries_arr['Warriors']);",
              "            for(i = 1; i < j; i = i + 1)",
              "            {",
              "                cur_ship = militaries_arr['Warriors', i];",
              "                if(~FindObjectInArray(new_operation_arr['AlliesForcesId'], Id(cur_ship))) continue;",
              "",
              "                ArrayAdd(new_operation_arr['AlliesForcesId'], Id(cur_ship));",
              "                new_operation_arr['OperationCost'] = new_operation_arr['OperationCost'] + militaries_arr['WarriorsHireCost', i];",
              "                UpdateSidePowers();",
              "                if(coals_power_percent >= max_coals_power_percent)",
              "                {",
              "                    j = -1;",
              "                    break;",
              "                }",
              "            }",
              "            if(~j)",
              "            {",
              "                j = ArrayDim(militaries_arr['Battleships']);",
              "                for(i = 1; i < j; i = i + 1)",
              "                {",
              "                    cur_ship = militaries_arr['Battleships', i];",
              "                    if(~FindObjectInArray(new_operation_arr['AlliesForcesId'], Id(cur_ship))) continue;",
              "",
              "                    ArrayAdd(new_operation_arr['AlliesForcesId'], Id(cur_ship));",
              "                    new_operation_arr['OperationCost'] = new_operation_arr['OperationCost'] + militaries_arr['BattleshipsHireCost', i];",
              "                    UpdateSidePowers();",
              "                    if(coals_power_percent >= max_coals_power_percent)",
              "                    {",
              "                        j = -1;",
              "                        break;",
              "                    }",
              "                }",
              "            }",
              "",
              "            //Сверяем соотношение сил между врагом в системе и атакующими военными в процентах",
              "            if(coals_power_percent >= min_coals_power_percent)",
              "            {",
              "                //Автоматически выбираем дату атаки",
              "                int min_time = 40;",
              "                int max_time = CurTurn() + (min_time * 2);",
              "                min_time = CurTurn() + min_time;",
              "                new_operation_arr['AttackDate'] = Rnd(min_time, min_time + (max_time - min_time), GetObjectGenerationSeed(GalaxyPtr()) + sqr(CurTurn() + 3574));",
              "                break;",
              "            }",
              "        }",
              "    }",
              "}",
              "",
              "//Если игрок уже создал планирование операции для данной ВБ на текущем ходу, то загружаем его, не создавая новое планирование",
              "int init_new = 0;",
              "if(new_operation_arr[0/*'PlanningDay'*/] != CurTurn()) init_new = 1;",
              "else if(new_operation_arr['MilitaryBaseId'] != Id(cur_ruin)) init_new = 1;",
              "else if(new_operation_arr['OrganizedByPlayer'] != operation_lvl) init_new = 1; //Если игрок ранее обновлял массив операции до получения нового звания на этом же ходу",
              "",
              "if(init_new)",
              "{",
              "    InitNewWBOperation(new_operation_arr, Id(cur_ruin), operation_lvl);",
              "",
              "    //Автоматический выбор системы, если игроку ещё не разрешают её выбирать",
              "    cur_star = 0;",
              "    if(new_operation_arr['OrganizedByPlayer'] <= 2)",
              "    {",
              "        //До N ближайших систем на выбор (лимит выставляется в начале диалога)",
              "        cur_star = stars_to_attack_arr[Rnd(1, min(ArrayDim(stars_to_attack_arr), stars_cnt_to_choose + 1), GetObjectGenerationSeed(GalaxyPtr()) + sqr(CurTurn() + 5363))];",
              "        new_operation_arr['StarToAttackId'] = Id(cur_star);",
              "    }",
              "",
              "    if(!cur_star)",
              "    {",
              "        tstr1 = '<color=255,0,0>' + CT(dialog_path + '.WBPlanningScreenStarNotChoosed') + '</color>';",
              "        tstr3 = '<color=0,50,200>0</color>';",
              "    }",
              "    else",
              "    {",
              "        tstr1 = '<color=0,50,200>' + Name(cur_star) + '</color>';",
              "        UpdateSidePowers();",
              "        tstr3 = '<color=0,50,200>' + enemies_cnt + '</color>';",
              "    }",
              "",
              "    tstr1 = '</color>' + Format(CT(dialog_path + '.WBConfirmationYes'),",
              "                                  '<PlayerRank'+'>', player_str_rank,",
              "                                  '<StarToAttack'+'>', tstr1,",
              "                                  '<AlliesNumbers'+'>', '<color=255,0,0>0</color>',",
              "                                  '<EnemyNumbers'+'>', tstr3,",
              "                                  '<GatheringPlace'+'>', '<color=255,0,0>' + CT(dialog_path + '.WBPlanningScreenGatherNotChoosed') + '</color>',",
              "                                  '<AttackDate'+'>', '<color=255,0,0>' + CT(dialog_path + '.WBPlanningScreenDateNotChoosed') + '</color>',",
              "                                  '<Cost'+'>', '<color=0,50,200>0</color>',",
              "                                  '');",
              "    tstr2 = '</color>' + CT(dialog_path + '.PlayerToPlanning');",
              "    tstr3 = '</color>' + CT(dialog_path + '.PlayerBeginOperation');",
              "    tstr4 = '</color>' + CT(dialog_path + '.PlayerCancelOperation');",
              "}",
              "else",
              "{",
              "    if(ArrayDim(new_operation_arr['AlliesForcesId']) > 1) UpdateSidePowers(); //На всякий случай, т.к. часть переменных зануляются на старте диалога",
              "",
              "    if(new_operation_arr['StarToAttackId']) tstr1 = '<color=0,50,200>' + Name(GalaxyStar(new_operation_arr['StarToAttackId'] - 1)) + '</color>';",
              "    else tstr1 = '<color=255,0,0>' + CT(dialog_path + '.WBPlanningScreenStarNotChoosed') + '</color>';",
              "",
              "    //Записываем счётчик вовлечённых в атаку военных",
              "    tstr2 = '<clr>' + (coals_cnt + big_coals_cnt) + '</color>';",
              "    i = ArrayDim(new_operation_arr['ShipyardsInvolvedId']) - 1; //Если игрок также заказал достройку военных на планетах",
              "    if(i) tstr2 = tstr2 + '+<clr>' + i + '</color>';",
              "    //Сверяем соотношение сил между врагом в системе и атакующими военными в процентах",
              "    if(coals_power_percent < min_coals_power_percent) tstr2 = Format(tstr2, '<clr', '<color=255,0,0', '');",
              "",
              "    //Записываем счётчик врагов в атакуемой системе",
              "    if(new_operation_arr['StarToAttackId']) tstr3 = '<color=0,50,200>' + enemies_cnt + '</color>';",
              "    else tstr3 = '<color=0,50,200>0</color>';",
              "",
              "    if(new_operation_arr['GatheringPlaceId'])",
              "    {",
              "        if(new_operation_arr['GatheringPlaceId'] > -1) tstr4 = '<color=0,50,200>' + Format(CT('FormGS.StarInfo'), '<Star'+'>', Name(GalaxyStar(new_operation_arr['GatheringPlaceId'] - 1)), '') + '</color>';",
              "        else tstr4 = '<color=0,50,200>' + Name(cur_ruin) + '</color>';",
              "    }",
              "    else tstr4 = '<color=255,0,0>' + CT(dialog_path + '.WBPlanningScreenGatherNotChoosed') + '</color>';",
              "",
              "    if(new_operation_arr['AttackDate']) tstr5 = '<color=0,50,200>' + GameDateTxtByTurn(new_operation_arr['AttackDate']) + '</color>';",
              "    else tstr5 = '<color=255,0,0>' + CT(dialog_path + '.WBPlanningScreenDateNotChoosed') + '</color>';",
              "",
              "    if(new_operation_arr['OperationCost'] <= ShipMoney(Player())) tstr6 = '<color=0,50,200>' + new_operation_arr['OperationCost'] + '</color>';",
              "    else tstr6 = '<color=255,0,0>' + new_operation_arr['OperationCost'] + '</color>';",
              "",
              "    //Собираем готовую реплику (проверка на случай, если выше операция была определена автоматически)",
              "    if(new_operation_arr['AttackDate'] || new_operation_arr['OrganizedByPlayer'] > 1)",
              "    {",
              "        tstr1 = '</color>' + Format(CT(dialog_path + '.WBAfterPlanning'),",
              "                                      '<PlayerRank'+'>', player_str_rank,",
              "                                      '<StarToAttack'+'>', tstr1,",
              "                                      '<AlliesNumbers'+'>', tstr2,",
              "                                      '<EnemyNumbers'+'>', tstr3,",
              "                                      '<GatheringPlace'+'>', tstr4,",
              "                                      '<AttackDate'+'>', tstr5,",
              "                                      '<Cost'+'>', tstr6,",
              "                                      '');",
              "        tstr2 = '</color>' + CT(dialog_path + '.PlayerToPlanning');",
              "        tstr3 = '</color>' + CT(dialog_path + '.PlayerBeginOperation');",
              "        tstr4 = '</color>' + CT(dialog_path + '.PlayerCancelOperation');",
              "    }",
              "    else //Автоподбор не смог найти достаточных сил для организации атаки",
              "    {",
              "        tstr1 = '</color>' + Format(CT(dialog_path + '.WBAfterPlanningNotFound'),",
              "                                      '<PlayerRank'+'>', player_str_rank,",
              "                                      '');",
              "        tstr2 = '</color>' + CT(dialog_path + '.PlayerAfterPlanningNotFound');",
              "    }",
              "}"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  45,
          "#":  51,
          "Total.Lines":  4,
          "Code.Type":  "Turn",
          "Code":          
          [
              "tstr1 = '</color>' + Format(CT(dialog_path + '.WBConfirmationNo'),",
              "                              '<PlayerRank'+'>', player_str_rank,",
              "                              '');",
              "tstr2 = '';"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  59,
          "#":  60,
          "Total.Lines":  4,
          "Code.Type":  "Turn",
          "Code":          
          [
              "tstr1 = '</color>' + Format(CT(dialog_path + '.WBCancelOperation'),",
              "                              '<PlayerRank'+'>', player_str_rank,",
              "                              '');",
              "tstr2 = '';"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  57,
          "#":  62,
          "Total.Lines":  137,
          "Code.Type":  "Turn",
          "Code":          
          [
              "//Запускаем подготовку к новой операции по запросу игрока",
              "ShipMoney(Player(), ShipMoney(Player()) - new_operation_arr['OperationCost']);",
              "Sound('Sound.Buy');",
              "",
              "cur_star = GalaxyStar(new_operation_arr['StarToAttackId'] - 1);",
              "",
              "ArrayDelete(new_operation_arr, 'PlanningDay'); //На данном этапе это уже не нужно",
              "operation_num = ArrayAdd(GlobalWBOperationsArray, new_operation_arr) - 1;",
              "",
              "new_operation_arr = newarray(1);",
              "new_operation_arr[0] = 0;",
              "GlobalWBOperationsArray[operation_num, 'AttackDate'] = GlobalWBOperationsArray[operation_num, 'AttackDate'] - 1; //Тёрнкод обсчитывается в конце расчёта хода, поэтому номера хода не соответствуют здравой логике",
              "",
              "if(GlobalWBOperationsArray[operation_num, 'GatheringPlaceId'] > -1)",
              "{",
              "    tstr1 = CT(dialog_path + '.WBBeginOperation');",
              "",
              "    //Координаты и радиус точки сбора военных в системе, если для места сбора выбрана система, а не ВБ",
              "    ArrayAdd(GlobalWBOperationsArray[operation_num], 0, 'GatheringPointCoordX');",
              "    ArrayAdd(GlobalWBOperationsArray[operation_num], 0, 'GatheringPointCoordY');",
              "    ArrayAdd(GlobalWBOperationsArray[operation_num], 0, 'GatheringPointRadius');",
              "",
              "    if(StarOwner(cur_star) == 1) tstr2 = 'Create';",
              "    else /*if(StarOwner(cur_star) == 2)*/ tstr2 = 'CreatePirates';",
              "    j = RndObject(0, 2, cur_star);",
              "    if(j) tstr2 = tstr2 + j;",
              "",
              "    tdwd1 = GalaxyStar(GlobalWBOperationsArray[operation_num, 'GatheringPlaceId'] - 1);",
              "    tstr2 = Format(CT('GalaxyNews.Group.WarriorLiberator.' + tstr2),",
              "                      '<StarNormal'+'>', Name(tdwd1),",
              "                      '<SectorNormal'+'>', Name(StarToCon(tdwd1)),",
              "                      '<StarEnemy'+'>', Name(cur_star),",
              "                      '<SectorEnemy'+'>', Name(StarToCon(cur_star)),",
              "                      '<Date'+'>', GameDateTxtByTurn(GlobalWBOperationsArray[operation_num, 'AttackDate'] + 1));",
              "    AddPlanetNews(tstr2, 26);",
              "    Ether(7, 'ShuWarriors_Operation' + Id(cur_ruin), '<color=255,240,100>' + GameDateTxtByTurn(CurTurn()) + Format('</color><br> <br>') + tstr2);",
              "    Sound('Sound.NewMsg');",
              "}",
              "else",
              "{",
              "    tstr1 = CT(dialog_path + '.WBBeginOperationWithWB');",
              "    GlobalWBOperationsArray[operation_num, 'GatheringPlaceId'] = -1; //Ранее тут была записана стоимость участия ВБ в операции с отрицательным знаком",
              "    ShipDestination(cur_ruin, cur_star, GlobalWBOperationsArray[operation_num, 'AttackDate']);",
              "",
              "    tstr2 = 'Create';",
              "    j = RndObject(0, 2, cur_star);",
              "    if(j) tstr2 = tstr2 + j;",
              "",
              "    tdwd1 = ShipStar(cur_ruin);",
              "    tstr2 = Format(CT('GalaxyNews.WBGoToEnemyStar.' + tstr2),",
              "                      '<WB'+'>', ShipName(cur_ruin),",
              "                      '<WBStar'+'>', Name(tdwd1),",
              "                      '<WBSector'+'>', Name(StarToCon(tdwd1)),",
              "                      '<StarEnemy'+'>', Name(cur_star),",
              "                      '<SectorEnemy'+'>', Name(StarToCon(cur_star)),",
              "                      '<Date'+'>', GameDateTxtByTurn(GlobalWBOperationsArray[operation_num, 'AttackDate'] + 1));",
              "    AddPlanetNews(tstr2, 45);",
              "    Ether(7, 'ShuWarriors_Operation' + Id(cur_ruin), '<color=255,240,100>' + GameDateTxtByTurn(CurTurn()) + Format('</color><br> <br>') + tstr2, cur_ruin);",
              "    Sound('Sound.NewMsg');",
              "}",
              "",
              "for(i = ArrayDim(GlobalWBOperationsArray[operation_num, 'AlliesForcesId']) - 1; i >= 1; i = i - 1)",
              "{",
              "    cur_ship = IdToShip(GlobalWBOperationsArray[operation_num, 'AlliesForcesId', i]);",
              "    cur_planet = GetShipHomePlanet(cur_ship);",
              "    RelationToRanger(cur_planet, Player(), max(RelationToRanger(cur_planet, Player()), 50));",
              "    if(GetShipPlanet(cur_ship) == cur_planet) TransferShip(cur_ship, GetShipHomePlanet(cur_ship)); //\"Приводим в чувства\" военных в гарнизонах (спасибо дабу за какаху)",
              "    OrderLock(cur_ship, 1);",
              "    ShipJoinToScript(cur_ship, 'Mod_ShuWarriors.OperativeWarriors.WarriorsOnPrepare');",
              "    if(Id(cur_ship) == GlobalWBOperationsArray[operation_num, 'FlagshipId'])",
              "    {",
              "        SetData(-1, 0, cur_ship); //Помечаем флагмана операции (игрок сможет взять его под свой личный контроль)",
              "        str text = ShipType(cur_ship);",
              "        if(text == 'Warrior')",
              "        {",
              "            //Также добавляем уникальный временный тип флагману операции",
              "            text = text + 'Big';",
              "            ShipType(cur_ship, text + 'Flagship');",
              "",
              "            //Необходимо, чтобы залочить игроку возможность активации камуфляжа на корпусе флагмана",
              "            j = ShipPilotRace(cur_ship);",
              "            if(j == Maloc) Chameleon(cur_ship, 'Ship.Maloc.' + text);",
              "            else if(j == Peleng) Chameleon(cur_ship, 'Ship.Peleng.' + text);",
              "            else if(j == People) Chameleon(cur_ship, 'Ship.People.' + text);",
              "            else if(j == Fei) Chameleon(cur_ship, 'Ship.Fei.' + text);",
              "            else if(j == Gaal) Chameleon(cur_ship, 'Ship.Gaal.' + text);",
              "        }",
              "        else ShipType(cur_ship, text + 'Flagship');",
              "    }",
              "",
              "    if(~GlobalWBOperationsArray[operation_num, 'GatheringPlaceId']) //Местом сбора выбрана система",
              "    {",
              "        SetData(GlobalWBOperationsArray[operation_num, 'GatheringPlaceId'], 1, cur_ship);",
              "        SetData(-GlobalWBOperationsArray[operation_num, 'StarToAttackId'], 2, cur_ship); //Маркер движения в точку сбора здесь выставит первый долетевший до системы сбора военный",
              "    }",
              "    else //Местом сбора выбрана ВБ",
              "    {",
              "        SetData(GlobalWBOperationsArray[operation_num, 'MilitaryBaseId'], 2, cur_ship);",
              "    }",
              "    SetData(operation_num, 3, cur_ship);",
              "",
              "    ShipFreeFlight(cur_ship); //Сразу же применяем выданные военному приказы",
              "}",
              "for(i = ArrayDim(GlobalWBOperationsArray[operation_num, 'ShipyardsInvolvedId']) - 1; i >= 1; i = i - 1)",
              "{",
              "    cur_planet = IdToPlanet(GlobalWBOperationsArray[operation_num, 'ShipyardsInvolvedId', i]);",
              "    RelationToRanger(cur_planet, Player(), max(RelationToRanger(cur_planet, Player()), 50));",
              "    cur_ship = BuyWarrior(cur_planet, 300);",
              "    TransferShip(cur_ship, cur_planet); //Вводим военного в список системы, иначе он не будет исполнять свою логику",
              "    ArrayAdd(GlobalWBOperationsArray[operation_num, 'AlliesForcesId'], Id(cur_ship));",
              "    ShipRefit(cur_ship);",
              "    ShipRefit(cur_ship);",
              "    ShipRefit(cur_ship);",
              "    ShipRefit(cur_ship);",
              "    ShipImproveItems(cur_ship, PlanetInventionLevel(cur_planet, 7) + RndObject(0, 2, cur_planet));",
              "    OrderLock(cur_ship, 1);",
              "    ShipJoinToScript(cur_ship, 'Mod_ShuWarriors.OperativeWarriors.WarriorsOnPrepare');",
              "    SetData(CurTurn() + RndObject(7, 14, cur_planet), 0, cur_ship); //Задержка до возможности взлёта с планеты только что построенного военного (типа доделывают корабль)",
              "    if(~GlobalWBOperationsArray[operation_num, 'GatheringPlaceId']) //Местом сбора выбрана система",
              "    {",
              "        SetData(GlobalWBOperationsArray[operation_num, 'GatheringPlaceId'], 1, cur_ship);",
              "        SetData(-GlobalWBOperationsArray[operation_num, 'StarToAttackId'], 2, cur_ship); //Маркер движения в точку сбора здесь выставит первый долетевший до системы сбора военный",
              "    }",
              "    else //Местом сбора выбрана ВБ",
              "    {",
              "        SetData(GlobalWBOperationsArray[operation_num, 'MilitaryBaseId'], 2, cur_ship);",
              "    }",
              "    SetData(operation_num, 3, cur_ship);",
              "}",
              "ArrayDelete(GlobalWBOperationsArray[operation_num], 'ShipyardsInvolvedId');",
              "ShipJoin(OperativeWB, cur_ruin);",
              "",
              "tstr1 = '</color>' + Format(tstr1,",
              "                              '<PlayerRank'+'>', player_str_rank,",
              "                              '<AttackDate'+'>', '<color=0,50,200>' + GameDateTxtByTurn(GlobalWBOperationsArray[operation_num, 'AttackDate'] + 1) + '</color>',",
              "                              '<StarToAttack'+'>', '<color=0,50,200>' + Name(cur_star) + '</color>',",
              "                              '');"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  56,
          "#":  64,
          "Total.Lines":  106,
          "Code.Type":  "Turn",
          "Code":          
          [
              "//Здесь собирается текст для экрана планирования",
              "if(!new_operation_arr['StarToAttackId'])",
              "{",
              "    tstr1 = '<color=255,0,0>' + CT(dialog_path + '.WBPlanningScreenStarNotChoosed') + '</color>';",
              "    tstr2 = '<color=255,0,0>0</color>';",
              "    tstr3 = '<color=0,50,200>0</color>';",
              "    tstr4 = '<color=0,50,200>0%</color> / <color=0,50,200>0%</color>';",
              "    tstr5 = '<color=0,50,200>' + CT(dialog_path + '.WBPlanningScreenFlagshipNotChoosed') + '</color>';",
              "    tstr6 = '<color=255,0,0>' + CT(dialog_path + '.WBPlanningScreenGatherNotChoosed') + '</color>';",
              "    tstr7 = '<color=255,0,0>' + CT(dialog_path + '.WBPlanningScreenDateNotChoosed') + '</color>';",
              "    tstr8 = Format('<br>') + '- <color=0,50,200>' + CT(dialog_path + '.WBPlanningScreenShipsNotChoosed') + '</color>';",
              "}",
              "else",
              "{",
              "    cur_star = GalaxyStar(new_operation_arr['StarToAttackId'] - 1);",
              "",
              "    tstr1 = '<color=0,50,200>' + Name(GalaxyStar(new_operation_arr['StarToAttackId'] - 1)) + '</color>';",
              "",
              "    //Число атакующих военных",
              "    tstr2 = '<clr>' + (coals_cnt + big_coals_cnt) + '</color>';",
              "    //Если игрок также заказал достройку военных на планетах",
              "    i = ArrayDim(new_operation_arr['ShipyardsInvolvedId']) - 1;",
              "    if(i) tstr2 = tstr2 + '+<clr>' + i + '</color>';",
              "",
              "    //Выписываем число врагов в атакуемой системе",
              "    tstr3 = '<color=0,50,200>' + enemies_cnt + '</color>';",
              "",
              "    //Сверяем соотношение сил между врагом в системе и атакующими военными в процентах",
              "    if(coals_power_percent >= min_coals_power_percent)",
              "    {",
              "        if(coals_power_percent >= round(0.75 * max_coals_power_percent)) tstr4 = '<color=0,132,15>' + min(coals_power_percent, 999) + '%</color> / <color=0,50,200>100%</color>'; //Оптимальное значение силы атакующих подсвечивается зелёным",
              "        else tstr4 = '<color=0,50,200>' + min(coals_power_percent, 999) + '%</color> / <color=0,50,200>100%</color>';",
              "    }",
              "    else",
              "    {",
              "        tstr2 = Format(tstr2, '<clr', '<color=255,0,0', '');",
              "        tstr4 = '<color=255,0,0>' + min(coals_power_percent, 999) + '%</color> / <color=0,50,200>100%</color>';",
              "    }",
              "",
              "    //Выводим название выбранного флагмана, если тот выбран",
              "    if(!new_operation_arr['FlagshipId']) tstr5 = '<color=0,50,200>' + CT(dialog_path + '.WBPlanningScreenFlagshipNotChoosed') + '</color>';",
              "    else",
              "    {",
              "        tstr5 = Name(IdToShip(new_operation_arr['FlagshipId']));",
              "        i = GetGameOptions('FontDialog');",
              "        if(i == 1) tstr5 = CutStrLenght(tstr5, 23);",
              "        else if(i == 2) tstr5 = CutStrLenght(tstr5, 22);",
              "        else if(i == 3) tstr5 = CutStrLenght(tstr5, 21);",
              "        tstr5 = '<color=0,50,200>' + tstr5 + '</color>';",
              "    }",
              "",
              "    //Выводим название выбранного места сбора военных перед прыжком в атакуемую систему",
              "    if(!new_operation_arr['GatheringPlaceId']) tstr6 = '<color=255,0,0>' + CT(dialog_path + '.WBPlanningScreenGatherNotChoosed') + '</color>';",
              "    else",
              "    {",
              "        if(new_operation_arr['GatheringPlaceId'] > 0) tstr6 = '<color=0,50,200>' + Name(GalaxyStar(new_operation_arr['GatheringPlaceId'] - 1)) + '</color>';",
              "        else //Местом сбора выбрана текущая военная база",
              "        {",
              "            tstr6 = Name(cur_ruin);",
              "            i = GetGameOptions('FontDialog');",
              "            if(i == 1 && count(tstr6) > 20)",
              "            {",
              "                tstr6 = CT('Script.Mod_ShuWarriors.MilitaryBaseShort') + ' ' + ShortName(cur_ruin);",
              "                CutStrLenght(tstr6, 20);",
              "            }",
              "            else if(i == 2 && count(tstr6) > 19)",
              "            {",
              "                tstr6 = CT('Script.Mod_ShuWarriors.MilitaryBaseShort') + ' ' + ShortName(cur_ruin);",
              "                CutStrLenght(tstr6, 19);",
              "            }",
              "            else if(i == 3 && count(tstr6) > 18)",
              "            {",
              "                tstr6 = CT('Script.Mod_ShuWarriors.MilitaryBaseShort') + ' ' + ShortName(cur_ruin);",
              "                CutStrLenght(tstr6, 18);",
              "            }",
              "            tstr6 = '<color=0,50,200>' + tstr6 + '</color>';",
              "        }",
              "    }",
              "",
              "    //Выводим выбранную для атаки дату",
              "    if(!new_operation_arr['AttackDate']) tstr7 = '<color=255,0,0>' + CT(dialog_path + '.WBPlanningScreenDateNotChoosed') + '</color>';",
              "    else tstr7 = '<color=0,50,200>' + GameDateTxtByTurn(new_operation_arr['AttackDate']) + '</color>';",
              "",
              "    //Выводим список названий всех военных кораблей (а также ВБ, если участвует), записанных в операцию",
              "    tstr8 = '';",
              "    if(!coals_cnt) tstr8 = Format('<br>') + '- <color=0,50,200>' + CT(dialog_path + '.WBPlanningScreenShipsNotChoosed') + '</color>';",
              "    else for(i = 1; i < ArrayDim(new_operation_arr['AlliesForcesId']); i = i + 1) tstr8 = tstr8 + Format('<br>') + '- <color=0,50,200>' + Name(IdToShip(new_operation_arr['AlliesForcesId', i])) + '</color>';",
              "    if(new_operation_arr['GatheringPlaceId'] < 0) tstr8 = tstr8 + Format('<br>') + '- <color=0,50,200>' + Name(cur_ruin) + '</color>';",
              "}",
              "",
              "if(new_operation_arr['OperationCost'] <= ShipMoney(Player())) tstr9 = '<color=0,50,200>' + new_operation_arr['OperationCost'] + '</color>';",
              "else tstr9 = '<color=255,0,0>' + new_operation_arr['OperationCost'] + '</color>';",
              "",
              "tstr1 = '</color>' + Format(CT(dialog_path + '.WBPlanningScreen'),",
              "                              '<SplitLine'+'>', split_str,",
              "                              '<Indent'+'>', indent_str,",
              "                              '<StarToAttack'+'>', tstr1,",
              "                              '<AlliesNumbers'+'>', tstr2,",
              "                              '<EnemyNumbers'+'>', tstr3,",
              "                              '<ForcesRatio'+'>', tstr4,",
              "                              '<Flagship'+'>', tstr5,",
              "                              '<GatheringPlace'+'>', tstr6,",
              "                              '<AttackDate'+'>', tstr7,",
              "                              '<AttackShipsList'+'>', tstr8,",
              "                              '<Cost'+'>', tstr9,",
              "                              '');"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  65,
          "#":  66,
          "Total.Lines":  59,
          "Code.Type":  "Turn",
          "Code":          
          [
              "if(check < 0) exit; //Для отсечения лишних ответов при выборе системы/кораблей",
              "",
              "//Здесь собираются ответы для экрана планирования",
              "int star_not_choosed = 1;",
              "if(new_operation_arr['StarToAttackId']) star_not_choosed = 0;",
              "",
              "if(new_operation_arr['OrganizedByPlayer'] > 2)",
              "{",
              "    //Выбор системы для атаки",
              "    InjectAnswer('PlanScr', CT(dialog_path + '.PlayerPlanningChooseStar'), 1);",
              "}",
              "",
              "//Выбор атакующих военных",
              "AddDialogBlock(CT(dialog_path + '.PlayerPlanningChooseAttackers'), star_not_choosed);",
              "InjectAnswer('PlanScr', CT(dialog_path + '.PlayerPlanningChooseAttackers'), 2);",
              "",
              "//Выбор флагмана (доступен только, если в составе атакующих имеется линкор или дредноут)",
              "if(!CurrentMods('Tweaks\\SR2Dominators') && !CurrentMods('Tweaks\\SR2Reboot')) //В \"ретро-модах\" не существует флагманов",
              "{",
              "    check = 1;",
              "    if(!star_not_choosed)",
              "    {",
              "        if(big_coals_cnt) check = 0;",
              "    }",
              "    AddDialogBlock(CT(dialog_path + '.PlayerPlanningChooseFlagship'), check);",
              "    InjectAnswer('PlanScr', CT(dialog_path + '.PlayerPlanningChooseFlagship'), 3);",
              "}",
              "",
              "if(new_operation_arr['OrganizedByPlayer'] >= 2)",
              "{",
              "    //Заказать постройку кораблей на коалиционных планетах сектора (возможно только если игроку не хватает сил для нападения даже после выбора всех доступных военных кораблей в секторе)",
              "    check = 1;",
              "    if(!star_not_choosed)",
              "    {",
              "        //Достроить новые корабли можно, только если всех доступных для атаки сил в секторе не хватает",
              "        if(",
              "            (coals_power_percent < min_coals_power_percent && ArrayDim(new_operation_arr['AlliesForcesId']) - 1 >= ships_available) ||",
              "            ArrayDim(new_operation_arr['ShipyardsInvolvedId']) > 1",
              "          ) check = 0;",
              "    }",
              "    AddDialogBlock(CT(dialog_path + '.PlayerPlanningConstructionOrder'), check);",
              "    InjectAnswer('PlanScr', CT(dialog_path + '.PlayerPlanningConstructionOrder'), 4);",
              "}",
              "",
              "//Выбор места сбора военных перед атакой",
              "AddDialogBlock(CT(dialog_path + '.PlayerPlanningChooseGatheringPlace'), star_not_choosed);",
              "InjectAnswer('PlanScr', CT(dialog_path + '.PlayerPlanningChooseGatheringPlace'), 5);",
              "",
              "//Выбор точной даты атаки",
              "//Игрок может выбирать только из ограниченного диапазона и только после того, как все остальные обязательные условия для атаки будут выполнены",
              "if(star_not_choosed) check = 1;",
              "else if(!new_operation_arr['GatheringPlaceId']) check = 1;",
              "else if(coals_power_percent < min_coals_power_percent) check = 1;",
              "else check = 0;",
              "AddDialogBlock(CT(dialog_path + '.PlayerPlanningChooseAttackDate'), check);",
              "InjectAnswer('PlanScr', 'snap~' + CT(dialog_path + '.PlayerPlanningChooseAttackDate'), 6);",
              "",
              "//Завершить планирование",
              "InjectAnswer('PlanScr', CT(dialog_path + '.PlayerPlanningDone'), 0);"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  115,
          "#":  72,
          "Total.Lines":  63,
          "Code.Type":  "Turn",
          "Code":          
          [
              "FindStarToAttack(cur_ruin, stars_to_attack_arr);",
              "ships_available = FindAllMilitaryShipsInSector(cur_sector, militaries_arr, 1);",
              "",
              "if(ArrayDim(stars_to_attack_arr) > 1 && ArrayDim(militaries_arr['Warriors']) > 1)",
              "{",
              "    //Установка длины \"дефисного разделителя\" и отступа в зависимости от выбранного в игре размера шрифта",
              "    i = GetGameOptions('FontDialog');",
              "    if(!i)",
              "    {",
              "        split_str = '</color>-----------------------------------------------------------';",
              "        indent_str = CT('FormInfo.td_310') + CT('FormInfo.align_right');",
              "    }",
              "    else if(i == 1)",
              "    {",
              "        split_str = '</color>------------------------------------------';",
              "        indent_str = CT('FormInfo.td_312') + CT('FormInfo.align_right');",
              "    }",
              "    else if(i == 2)",
              "    {",
              "        split_str = '</color>-------------------------------------------';",
              "        indent_str = CT('FormInfo.td_324') + CT('FormInfo.align_right');",
              "    }",
              "    else //if(i == 3)",
              "    {",
              "        split_str = '</color>--------------------------------------';",
              "        indent_str = CT('FormInfo.td_325') + CT('FormInfo.align_right');",
              "    }",
              "",
              "    coals_cnt = ArrayDim(militaries_arr['Warriors']) - 1;",
              "    coals_power = 0;",
              "    for(i = coals_cnt; i >= 1; i = i - 1) coals_power = coals_power + GetShipAverageStrength(militaries_arr['Warriors', i]);",
              "    average_warrior_power = coals_power / coals_cnt; //Запоминаем среднюю силу для расчёта примерной сила при заказе достройки военных на планетах сектора",
              "    coals_cnt = 0;",
              "    coals_power = 0;",
              "}",
              "//Если вдруг атаковать нечего",
              "else if(ArrayDim(stars_to_attack_arr) > 1)",
              "{",
              "    tstr1 = '</color>' + Format(CT(dialog_path + '.WBRequestOperationNoTargetStars'),",
              "                                  '<PlayerRank'+'>', player_str_rank,",
              "                                  '<Sector'+'>', Name(cur_sector),",
              "                                  '');",
              "    tstr2 = '</color>' + CT(dialog_path + '.PlayerRequestOperationNoTargetStars');",
              "    operation_lvl = -1;",
              "}",
              "//Если вдруг атаковать некем (в секторе не нашлось ни одного простого военного)",
              "else //if(ArrayDim(militaries_arr['Warriors']) > 1)",
              "{",
              "    tstr1 = '</color>' + Format(CT(dialog_path + '.WBRequestOperationNoTargetStars'),",
              "                                  '<PlayerRank'+'>', player_str_rank,",
              "                                  '<Sector'+'>', Name(cur_sector),",
              "                                  '');",
              "    tstr2 = '</color>' + CT(dialog_path + '.PlayerRequestOperationNoTargetStars');",
              "    operation_lvl = -1;",
              "}",
              "",
              "tstr1 = '</color>' + Format(CT(dialog_path + '.WBRequestOperation'),",
              "                              '<PlayerRank'+'>', player_str_rank,",
              "                              '<Sector'+'>', '<color=0,50,200>' + Name(StarToCon(ShipStar(cur_ruin))) + '</color>',",
              "                              '<MilitaryBase'+'>', '<color=0,50,200>' + ShipName(cur_ruin) + '</color>',",
              "                              '');",
              "tstr2 = '</color>' + CT(dialog_path + '.PlayerConfirmationYes');",
              "tstr3 = '</color>' + CT(dialog_path + '.PlayerConfirmationNo');"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  40,
          "Parent":  67,
          "#":  80,
          "Total.Lines":  309,
          "Code.Type":  "Turn",
          "Code":          
          [
              "//Выбор системы для атаки",
              "if(GAnswerData == 1)",
              "{",
              "    check = -1; //Маркер для диалога с выбором",
              "",
              "    for(i = 1; i < min(ArrayDim(stars_to_attack_arr), stars_cnt_to_choose + 1); i = i + 1) //До N ближайших систем на выбор (зависит от уровня вовлечённости игрока)",
              "    {",
              "        cur_star = stars_to_attack_arr[i];",
              "        if(Id(cur_star) != new_operation_arr['StarToAttackId']) tstr1 = Format(CT(dialog_path + '.PlayerPlanningChooseStarToAttack'), '<Star'+'>', Name(cur_star), '');",
              "        else tstr1 = Format(CT(dialog_path + '.PlayerPlanningChooseStarToAttack'), '<Star'+'>', '<color=0,50,200>' + Name(cur_star) + '</color>', ''); //Пометка для уже выбранной системы",
              "",
              "        if(StarOwner(cur_star) == 1)",
              "        {",
              "            tstr2 = StarCustomFaction(cur_star);",
              "            if(tstr2 == '')",
              "            {",
              "                if(StarSeries(cur_star) == 0) tstr1 = tstr1 + ' (<color=255,0,0>' + lowercase(CT('FormInfo.Blazeroids')) + '</color>)';",
              "                else if(StarSeries(cur_star) == 1) tstr1 = tstr1 + ' (<color=0,135,185>' + lowercase(CT('FormInfo.Kelleroids')) + '</color>)';",
              "                else if(StarSeries(cur_star) == 2) tstr1 = tstr1 + ' (<color=61,155,0>' + lowercase(CT('FormInfo.Terronoids')) + '</color>)';",
              "            }",
              "            else if(tstr2 == 'Klissan') tstr1 = tstr1 + ' (<color=93,155,93>' + lowercase(CT('FormGameSet2.Common.LevelGroupKlissan')) + '</color>)';",
              "        }",
              "        else if(StarOwner(cur_star) == 2) tstr1 = tstr1 + ' (<color=235,235,235>' + lowercase(CT('FormGameSet2.Common.LevelGroup1')) + '</color>)';",
              "",
              "        if(!SectorVisible(StarToCon(cur_star))) //Нельзя выбрать систему в закрытом секторе",
              "        {",
              "            tstr1 = DeleteTags(tstr1);",
              "            AddDialogBlock(tstr1, 1);",
              "        }",
              "        else AddDialogBlock(tstr1, 0);",
              "        InjectAnswer('PlanScrChoose', tstr1, cur_star);",
              "    }",
              "",
              "    //Назад",
              "    InjectAnswer('PlanScrChoose', CT(dialog_path + '.PlayerPlanningChooseBack'), 0);",
              "}",
              "//Выбор атакующих военных (доступных кораблей из списка)",
              "else if(GAnswerData == 2)",
              "{",
              "    check = -2; //Маркер для диалога с выбором",
              "    k = 0;",
              "",
              "    //Простые военные",
              "    for(i = 1; i < ArrayDim(militaries_arr['Warriors']); i = i + 1)",
              "    {",
              "        cur_ship = militaries_arr['Warriors', i];",
              "        if(FindObjectInArray(new_operation_arr['AlliesForcesId'], Id(cur_ship)) == -1)",
              "        {",
              "            if(coals_power_percent >= max_coals_power_percent) j = 1;",
              "            else j = 0;",
              "            tstr1 = Name(cur_ship);",
              "        }",
              "        else",
              "        {",
              "            j = 0;",
              "            tstr1 = '<color=0,50,200>' + Name(cur_ship) + '</color>'; //Пометка для уже выбранного корабля",
              "        }",
              "",
              "        if(!j) k = k + 1;",
              "        AddDialogBlock(tstr1, j);",
              "        InjectAnswer('PlanScrChoose', 'snap~' + tstr1, '1' + i);",
              "    }",
              "    //Линкоры (если есть)",
              "    for(i = 1; i < ArrayDim(militaries_arr['Battleships']); i = i + 1)",
              "    {",
              "        cur_ship = militaries_arr['Battleships', i];",
              "        if(FindObjectInArray(new_operation_arr['AlliesForcesId'], Id(cur_ship)) == -1)",
              "        {",
              "            if(coals_power_percent >= max_coals_power_percent) j = 1;",
              "            else j = 0;",
              "            tstr1 = Name(cur_ship);",
              "        }",
              "        else",
              "        {",
              "            j = 0;",
              "            tstr1 = '<color=0,50,200>' + Name(cur_ship) + '</color>'; //Пометка для уже выбранного корабля",
              "        }",
              "",
              "        if(!j) k = k + 1;",
              "        AddDialogBlock(tstr1, j);",
              "        InjectAnswer('PlanScrChoose', 'snap~' + tstr1, '2' + i);",
              "    }",
              "    //Дредноуты (если есть)",
              "    if(new_operation_arr['OrganizedByPlayer'] >= 4)",
              "    {",
              "        for(i = 1; i < ArrayDim(militaries_arr['Dreadnoughts']); i = i + 1)",
              "        {",
              "            cur_ship = militaries_arr['Dreadnoughts', i];",
              "            if(FindObjectInArray(new_operation_arr['AlliesForcesId'], Id(cur_ship)) == -1)",
              "            {",
              "                if(coals_power_percent >= max_coals_power_percent) j = 1;",
              "                else j = 0;",
              "                tstr1 = Name(cur_ship);",
              "            }",
              "            else",
              "            {",
              "                j = 0;",
              "                tstr1 = '<color=0,50,200>' + Name(cur_ship) + '</color>'; //Пометка для уже выбранного корабля",
              "            }",
              "",
              "            if(!j) k = k + 1;",
              "            AddDialogBlock(tstr1, j);",
              "            InjectAnswer('PlanScrChoose', 'snap~' + tstr1, '3' + i);",
              "        }",
              "    }",
              "",
              "    //Выбрать всех",
              "    tstr1 = CT(dialog_path + '.PlayerPlanningChooseAttackersAddAll');",
              "    if(coals_power_percent >= max_coals_power_percent) j = 1;",
              "    else if(k <= ArrayDim(new_operation_arr['AlliesForcesId']) - 1) j = 1; //Если уже и так выбраны все возможные корабли",
              "    else j = 0;",
              "    AddDialogBlock(tstr1, j);",
              "    InjectAnswer('PlanScrChoose', 'snap~' + tstr1, -1);",
              "    //Отменить всех",
              "    tstr1 = CT(dialog_path + '.PlayerPlanningChooseAttackersRemoveAll');",
              "    if(ArrayDim(new_operation_arr['AlliesForcesId']) > 1) j = 0;",
              "    else j = 1;",
              "    AddDialogBlock(tstr1, j);",
              "    InjectAnswer('PlanScrChoose', 'snap~' + tstr1, -2);",
              "    //Назад",
              "    InjectAnswer('PlanScrChoose', CT(dialog_path + '.PlayerPlanningChooseBack'), 0);",
              "}",
              "//Выбор флагмана (доступен только, если в составе атакующих имеется линкор или дредноут)",
              "else if(GAnswerData == 3)",
              "{",
              "    check = -3; //Маркер для диалога с выбором",
              "",
              "    for(i = 1; i < ArrayDim(new_operation_arr['AlliesForcesId']); i = i + 1)",
              "    {",
              "        cur_ship = IdToShip(new_operation_arr['AlliesForcesId', i]);",
              "        if(!ShipSubType(cur_ship)) continue; //Флагманом могут быть назначены линкоры и дредноуты",
              "",
              "        if(Id(cur_ship) != new_operation_arr['FlagshipId']) tstr1 = Name(cur_ship);",
              "        else tstr1 = '<color=0,50,200>' + Name(cur_ship) + '</color>'; //Пометка для уже выбранного флагмана",
              "",
              "        InjectAnswer('PlanScrChoose', tstr1, cur_ship);",
              "    }",
              "",
              "    //Отменить выбор",
              "    tstr1 = CT(dialog_path + '.PlayerPlanningChooseRemoveFlagship');",
              "    if(!new_operation_arr['FlagshipId']) j = 1;",
              "    else j = 0;",
              "    AddDialogBlock(tstr1, j);",
              "    InjectAnswer('PlanScrChoose', tstr1, -1);",
              "    //Назад",
              "    InjectAnswer('PlanScrChoose', CT(dialog_path + '.PlayerPlanningChooseBack'), 0);",
              "}",
              "//Заказать постройку кораблей на коалиционных планетах сектора (возможно только если игроку не хватает сил для нападения даже после выбора всех доступных военных кораблей в секторе)",
              "else if(GAnswerData == 4)",
              "{",
              "    check = -4; //Маркер для диалога с выбором",
              "",
              "    k = 0;",
              "    for(i = 0; i < ConStars(cur_sector); i = i + 1)",
              "    {",
              "        cur_star = ConStar(cur_sector, i);",
              "        if(StarOwner(cur_star)) continue;",
              "        if(StarCustomFaction(cur_star) != '') continue;",
              "        if(cur_star == PlanetToStar(PlanetPirateClan())) continue;",
              "",
              "        for(j = 0; j < StarPlanets(cur_star); j = j + 1)",
              "        {",
              "            cur_planet = StarPlanets(cur_star, j);",
              "            if(PlanetOwner(cur_planet) == None) continue;",
              "",
              "            tstr1 = Format(CT(dialog_path + '.PlayerPlanningConstructionOrderPlanet'), '<Planet'+'>', PlanetName(cur_planet));",
              "            if(~FindObjectInArray(new_operation_arr['ShipyardsInvolvedId'], Id(cur_planet))) tstr1 = tstr1 + ' ' + CT(dialog_path + '.PlayerPlanningConstructionOrderPlanetSet');",
              "            //Использовать верфи допускается только в случае острой нехватки кораблей для атаки",
              "            else if(coals_power_percent >= min_coals_power_percent)",
              "            {",
              "                tstr1 = DeleteTags(tstr1);",
              "                AddDialogBlock(tstr1, 1);",
              "            }",
              "",
              "            k = k + 1;",
              "            InjectAnswer('PlanScrChoose', 'snap~' + tstr1, cur_planet);",
              "        }",
              "    }",
              "",
              "    //Задействовать все",
              "    tstr1 = CT(dialog_path + '.PlayerPlanningChooseConstructionOrderAddAll');",
              "    if(coals_power_percent >= min_coals_power_percent) j = 1;",
              "    else if(k <= ArrayDim(new_operation_arr['ShipyardsInvolvedId']) - 1) j = 1; //Если уже и так выбраны все возможные планеты",
              "    else j = 0;",
              "    AddDialogBlock(tstr1, j);",
              "    InjectAnswer('PlanScrChoose', 'snap~' + tstr1, -1);",
              "    //Остановить все",
              "    tstr1 = CT(dialog_path + '.PlayerPlanningChooseConstructionOrderRemoveAll');",
              "    if(ArrayDim(new_operation_arr['ShipyardsInvolvedId']) > 1) j = 0;",
              "    else j = 1;",
              "    AddDialogBlock(tstr1, j);",
              "    InjectAnswer('PlanScrChoose', 'snap~' + tstr1, -2);",
              "    //Назад",
              "    InjectAnswer('PlanScrChoose', CT(dialog_path + '.PlayerPlanningChooseBack'), 0);",
              "}",
              "//Выбор места сбора военных перед атакой",
              "else if(GAnswerData == 5)",
              "{",
              "    check = -5; //Маркер для диалога с выбором",
              "",
              "    tint1 = 5;",
              "    dword pirate_sector = StarToCon(PlanetToStar(PlanetPirateClan()));",
              "    dword attack_star = GalaxyStar(new_operation_arr['StarToAttackId'] - 1);",
              "    for(i = 1; i < GalaxyStars(attack_star); i = i + 1)",
              "    {",
              "        cur_star = StarNearbyStars(attack_star, i);",
              "        if(StarOwner(cur_star)) continue;",
              "        if(StarCustomFaction(cur_star) != '') continue;",
              "        if(StarToCon(cur_star) == pirate_sector) continue;",
              "",
              "        if(Id(cur_star) != new_operation_arr['GatheringPlaceId']) tstr1 = Name(cur_star);",
              "        else tstr1 = '<color=0,50,200>' + Name(cur_star) + '</color>'; //Пометка для уже выбранной системы",
              "",
              "        //Нельзя выбрать систему в закрытом секторе или атакованную в настоящий момент",
              "        j = 0;",
              "        if(!SectorVisible(StarToCon(cur_star)) || StarBattle(cur_star))",
              "        {",
              "            tstr1 = DeleteTags(tstr1);",
              "            if(StarBattle(cur_star)) tstr1 = tstr1 + ' ' + CT(dialog_path + '.PlayerPlanningChooseStarUnderAttack');",
              "            j = 1;",
              "        }",
              "",
              "        AddDialogBlock(tstr1, j);",
              "        InjectAnswer('PlanScrChoose', tstr1, cur_star);",
              "",
              "        tint1 = tint1 - 1;",
              "        if(!tint1) break;",
              "    }",
              "",
              "    if(new_operation_arr['OrganizedByPlayer'] > 3)",
              "    {",
              "        //Добавляем возможность выбора в качестве точки сбора текущей ВБ (маркер -1)",
              "        if(new_operation_arr['GatheringPlaceId'] > -1)",
              "        {",
              "            tstr1 = Name(cur_ruin);",
              "            //Для выбора ВБ местом сбора необходимо иметь не менее 5 военных в атакующей группе",
              "            if(ArrayDim(new_operation_arr['AlliesForcesId']) < (min_warriors_to_add_WB + 1))",
              "            {",
              "                tstr1 = tstr1 + ' ' + CT(dialog_path + '.PlayerPlanningChooseGatheringPlaceNotEnoughShips');",
              "                AddDialogBlock(tstr1, 1);",
              "            }",
              "        }",
              "        else tstr1 = '<color=0,50,200>' + Name(cur_ruin) + '</color>';",
              "        InjectAnswer('PlanScrChoose', tstr1, -1);",
              "    }",
              "",
              "    //Назад",
              "    InjectAnswer('PlanScrChoose', CT(dialog_path + '.PlayerPlanningChooseBack'), 0);",
              "}",
              "//Выбор точной даты атаки (игрок может выбирать только из ограниченного диапазона)",
              "else if(GAnswerData == 6)",
              "{",
              "    int min_time = 40;",
              "    if(ArrayDim(new_operation_arr['ShipyardsInvolvedId']) > 1) min_time = min_time + 15;",
              "    int max_time = CurTurn() + (min_time * 3);",
              "    min_time = CurTurn() + min_time;",
              "    ArrayClear(tarr1);",
              "    ArrayDelete(tarr1, 0);",
              "    for(i = min_time; i <= max_time; i = i + 1) ArrayAdd(tarr1, GameDateTxtByTurn(i));",
              "    new_operation_arr['AttackDate'] = NumberBox('Bm.Icons.DateCalendar', CT(dialog_path + '.PlayerPlanningChooseAttackDateChoose'), min_time, max_time, max_time, '', min_time, tarr1);",
              "",
              "    check = 6;",
              "}",
              "//Завершение планирования",
              "else",
              "{",
              "    if(new_operation_arr['StarToAttackId']) tstr1 = '<color=0,50,200>' + Name(GalaxyStar(new_operation_arr['StarToAttackId'] - 1)) + '</color>';",
              "    else tstr1 = '<color=255,0,0>' + CT(dialog_path + '.WBPlanningScreenStarNotChoosed') + '</color>';",
              "",
              "    //Записываем счётчик вовлечённых в атаку военных",
              "    tstr2 = '<clr>' + (coals_cnt + big_coals_cnt) + '</color>';",
              "    i = ArrayDim(new_operation_arr['ShipyardsInvolvedId']) - 1; //Если игрок также заказал достройку военных на планетах",
              "    if(i) tstr2 = tstr2 + '+<clr>' + i + '</color>';",
              "    //Сверяем соотношение сил между врагом в системе и атакующими военными в процентах",
              "    if(coals_power_percent < min_coals_power_percent) tstr2 = Format(tstr2, '<clr', '<color=255,0,0', '');",
              "",
              "    //Записываем счётчик врагов в атакуемой системе",
              "    if(new_operation_arr['StarToAttackId']) tstr3 = '<color=0,50,200>' + enemies_cnt + '</color>';",
              "    else tstr3 = '<color=0,50,200>0</color>';",
              "",
              "    if(new_operation_arr['GatheringPlaceId'])",
              "    {",
              "        if(new_operation_arr['GatheringPlaceId'] > -1) tstr4 = '<color=0,50,200>' + Format(CT('FormGS.StarInfo'), '<Star'+'>', Name(GalaxyStar(new_operation_arr['GatheringPlaceId'] - 1)), '') + '</color>';",
              "        else tstr4 = '<color=0,50,200>' + Name(cur_ruin) + '</color>';",
              "    }",
              "    else tstr4 = '<color=255,0,0>' + CT(dialog_path + '.WBPlanningScreenGatherNotChoosed') + '</color>';",
              "",
              "    if(new_operation_arr['AttackDate']) tstr5 = '<color=0,50,200>' + GameDateTxtByTurn(new_operation_arr['AttackDate']) + '</color>';",
              "    else tstr5 = '<color=255,0,0>' + CT(dialog_path + '.WBPlanningScreenDateNotChoosed') + '</color>';",
              "",
              "    if(new_operation_arr['OperationCost'] <= ShipMoney(Player())) tstr6 = '<color=0,50,200>' + new_operation_arr['OperationCost'] + '</color>';",
              "    else tstr6 = '<color=255,0,0>' + new_operation_arr['OperationCost'] + '</color>';",
              "",
              "    //Собираем готовую реплику",
              "    tstr1 = '</color>' + Format(CT(dialog_path + '.WBAfterPlanning'),",
              "                                  '<PlayerRank'+'>', player_str_rank,",
              "                                  '<StarToAttack'+'>', tstr1,",
              "                                  '<AlliesNumbers'+'>', tstr2,",
              "                                  '<EnemyNumbers'+'>', tstr3,",
              "                                  '<GatheringPlace'+'>', tstr4,",
              "                                  '<AttackDate'+'>', tstr5,",
              "                                  '<Cost'+'>', tstr6,",
              "                                  '');",
              "    tstr2 = '</color>' + CT(dialog_path + '.PlayerToPlanning');",
              "    tstr3 = '</color>' + CT(dialog_path + '.PlayerBeginOperation');",
              "    tstr4 = '</color>' + CT(dialog_path + '.PlayerCancelOperation');",
              "",
              "    check = 0;",
              "}"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  85,
          "#":  86,
          "Total.Lines":  265,
          "Code.Type":  "Turn",
          "Code":          
          [
              "//Выбор или перевыбор системы обнуляет всю ранее заданную информацию",
              "if(check == -1)",
              "{",
              "    if(GAnswerData) //Если игрок не закрыл экран выбора системы",
              "    {",
              "        if(Id(GAnswerData) != new_operation_arr['StarToAttackId'])",
              "        {",
              "            new_operation_arr['StarToAttackId'] = Id(GAnswerData);",
              "            ArrayClear(new_operation_arr['AlliesForcesId']);",
              "            ArrayClear(new_operation_arr['ShipyardsInvolvedId']);",
              "            new_operation_arr['FlagshipId'] = 0;",
              "            new_operation_arr['GatheringPlaceId'] = 0;",
              "            new_operation_arr['AttackDate'] = 0;",
              "",
              "            coals_cnt = 0;",
              "            big_coals_cnt = 0;",
              "            coals_power = 0.0;",
              "            coals_power_percent = 0;",
              "            enemies_cnt = 0;",
              "            enemies_power = 0.0;",
              "            new_operation_arr['OperationCost'] = 0;",
              "",
              "            UpdateSidePowers();",
              "        }",
              "    }",
              "",
              "    check = 0; //Чтобы больше не блокировать основные ответы экрана планирования после завершения выбора системы/кораблей",
              "}",
              "//Добавление/исключение военных в атакующую группу",
              "else if(check == -2)",
              "{",
              "    if(GAnswerData) //Если игрок не закрыл экран выбора военных",
              "    {",
              "        if(int(GAnswerData) == -1) //Игрок выбрал вариант \"Выбрать всех\"",
              "        {",
              "            j = ArrayDim(militaries_arr['Warriors']);",
              "            for(i = 1; i < j; i = i + 1)",
              "            {",
              "                cur_ship = militaries_arr['Warriors', i];",
              "                if(~FindObjectInArray(new_operation_arr['AlliesForcesId'], Id(cur_ship))) continue;",
              "",
              "                ArrayAdd(new_operation_arr['AlliesForcesId'], Id(cur_ship));",
              "                new_operation_arr['OperationCost'] = new_operation_arr['OperationCost'] + militaries_arr['WarriorsHireCost', i];",
              "                UpdateSidePowers();",
              "                if(coals_power_percent >= max_coals_power_percent)",
              "                {",
              "                    j = -1;",
              "                    break;",
              "                }",
              "            }",
              "            if(~j)",
              "            {",
              "                j = ArrayDim(militaries_arr['Battleships']);",
              "                for(i = 1; i < j; i = i + 1)",
              "                {",
              "                    cur_ship = militaries_arr['Battleships', i];",
              "                    if(~FindObjectInArray(new_operation_arr['AlliesForcesId'], Id(cur_ship))) continue;",
              "",
              "                    ArrayAdd(new_operation_arr['AlliesForcesId'], Id(cur_ship));",
              "                    new_operation_arr['OperationCost'] = new_operation_arr['OperationCost'] + militaries_arr['BattleshipsHireCost', i];",
              "                    UpdateSidePowers();",
              "                    if(coals_power_percent >= max_coals_power_percent)",
              "                    {",
              "                        j = -1;",
              "                        break;",
              "                    }",
              "                }",
              "            }",
              "            if(new_operation_arr['OrganizedByPlayer'] >= 4)",
              "            {",
              "                if(~j)",
              "                {",
              "                    j = ArrayDim(militaries_arr['Dreadnoughts']);",
              "                    for(i = 1; i < j; i = i + 1)",
              "                    {",
              "                        cur_ship = militaries_arr['Dreadnoughts', i];",
              "                        if(~FindObjectInArray(new_operation_arr['AlliesForcesId'], Id(cur_ship))) continue;",
              "",
              "                        ArrayAdd(new_operation_arr['AlliesForcesId'], Id(cur_ship));",
              "                        new_operation_arr['OperationCost'] = new_operation_arr['OperationCost'] + militaries_arr['DreadnoughtsHireCost', i];",
              "                        UpdateSidePowers();",
              "                        if(coals_power_percent >= max_coals_power_percent)",
              "                        {",
              "                            j = -1;",
              "                            break;",
              "                        }",
              "                    }",
              "                }",
              "            }",
              "        }",
              "        else if(int(GAnswerData) == -2) //Игрок выбрал вариант \"Отменить всех\"",
              "        {",
              "            ArrayClear(new_operation_arr['AlliesForcesId']);",
              "            ArrayClear(new_operation_arr['ShipyardsInvolvedId']);",
              "            new_operation_arr['FlagshipId'] = 0;",
              "            new_operation_arr['AttackDate'] = 0;",
              "            coals_cnt = 0;",
              "            big_coals_cnt = 0;",
              "            coals_power = 0;",
              "            coals_power_percent = 0;",
              "",
              "            //Если военных в атакующей группе стало недостаточно для использования ВБ в качестве места сбора",
              "            if(new_operation_arr['GatheringPlaceId'] < 0)",
              "            {",
              "                if(ArrayDim(new_operation_arr['AlliesForcesId']) < (min_warriors_to_add_WB + 1))",
              "                {",
              "                    new_operation_arr['OperationCost'] = new_operation_arr['OperationCost'] + new_operation_arr['GatheringPlaceId'];",
              "                    new_operation_arr['GatheringPlaceId'] = 0;",
              "                }",
              "            }",
              "",
              "            new_operation_arr['OperationCost'] = 0;",
              "        }",
              "        else",
              "        {",
              "            if(substr(GAnswerData, 0, 1) == 1) str section = 'Warriors';",
              "            else if(substr(GAnswerData, 0, 1) == 2) section = 'Battleships';",
              "            else /*if(substr(GAnswerData, 0, 1) == 3)*/ section = 'Dreadnoughts';",
              "            int num = substr(GAnswerData, 1);",
              "            cur_ship = Id(militaries_arr[section, num]);",
              "",
              "            //Военный ещё не добавлен в группу - добавляем",
              "            int inner_num = FindObjectInArray(new_operation_arr['AlliesForcesId'], cur_ship);",
              "            if(inner_num == -1)",
              "            {",
              "                ArrayAdd(new_operation_arr['AlliesForcesId'], cur_ship);",
              "                new_operation_arr['OperationCost'] = new_operation_arr['OperationCost'] + militaries_arr[section + 'HireCost', num];",
              "            }",
              "            //Военный уже в группе - исключаем",
              "            else",
              "            {",
              "                ArrayDelete(new_operation_arr['AlliesForcesId'], inner_num);",
              "                new_operation_arr['OperationCost'] = new_operation_arr['OperationCost'] - new_operation_arr['ShipyardsInvolvedId', 0];",
              "                ArrayClear(new_operation_arr['ShipyardsInvolvedId']);",
              "                if(cur_ship == new_operation_arr['FlagshipId']) new_operation_arr['FlagshipId'] = 0;",
              "                new_operation_arr['OperationCost'] = new_operation_arr['OperationCost'] - militaries_arr[section + 'HireCost', num];",
              "",
              "                //Если военных в атакующей группе стало недостаточно для использования ВБ в качестве места сбора",
              "                if(new_operation_arr['GatheringPlaceId'] < 0)",
              "                {",
              "                    if(ArrayDim(new_operation_arr['AlliesForcesId']) < (min_warriors_to_add_WB + 1))",
              "                    {",
              "                        new_operation_arr['OperationCost'] = new_operation_arr['OperationCost'] + new_operation_arr['GatheringPlaceId'];",
              "                        new_operation_arr['GatheringPlaceId'] = 0;",
              "                    }",
              "                }",
              "            }",
              "",
              "            UpdateSidePowers();",
              "            if(coals_power_percent < min_coals_power_percent) new_operation_arr['AttackDate'] = 0;",
              "        }",
              "",
              "        GAnswerData = 2;",
              "    }",
              "    else check = 0; //Снимаем блокировку",
              "}",
              "//Выбор флагмана",
              "else if(check == -3)",
              "{",
              "    //Если игрок не закрыл экран выбора флагмана",
              "    if(GAnswerData == -1) new_operation_arr['FlagshipId'] = 0;",
              "    else if(GAnswerData) new_operation_arr['FlagshipId'] = Id(GAnswerData);",
              "",
              "    check = 0; //Снимаем блокировку",
              "}",
              "//Заказ постройки новых кораблей на коалиционных планетах сектора (возможен только если игроку не хватает сил для нападения даже после выбора всех доступных военных кораблей в секторе)",
              "else if(check == -4)",
              "{",
              "    if(GAnswerData)",
              "    {",
              "        if(GAnswerData == -1) //Игрок выбрал вариант \"Задействовать все\"",
              "        {",
              "            for(i = 0; i < ConStars(cur_sector); i = i + 1)",
              "            {",
              "                cur_star = ConStar(cur_sector, i);",
              "                if(StarOwner(cur_star)) continue;",
              "                if(StarCustomFaction(cur_star) != '') continue;",
              "                if(cur_star == PlanetToStar(PlanetPirateClan())) continue;",
              "",
              "                for(j = 0; j < StarPlanets(cur_star); j = j + 1)",
              "                {",
              "                    cur_planet = StarPlanets(cur_star, j);",
              "                    if(PlanetOwner(cur_planet) == None) continue;",
              "                    if(~FindObjectInArray(new_operation_arr['ShipyardsInvolvedId'], Id(cur_planet))) continue;",
              "",
              "                    ArrayAdd(new_operation_arr['ShipyardsInvolvedId'], Id(cur_planet));",
              "                    //Считаем цену постройки военного на данной планете (чем более продвинута планета по ГТУ, тем дороже обойдётся постройка)",
              "                    tint1 = CalcBuildWarriorStats(cur_planet, 0);",
              "",
              "                    new_operation_arr['ShipyardsInvolvedId', 0] = tint1 + new_operation_arr['ShipyardsInvolvedId', 0];",
              "                    new_operation_arr['OperationCost'] = new_operation_arr['OperationCost'] + tint1;",
              "                    UpdateSidePowers();",
              "                    if(coals_power_percent >= min_coals_power_percent) break;",
              "                }",
              "            }",
              "        }",
              "        else if(GAnswerData == -2) //Игрок выбрал вариант \"Отменить все\"",
              "        {",
              "            new_operation_arr['OperationCost'] = new_operation_arr['OperationCost'] - new_operation_arr['ShipyardsInvolvedId', 0];",
              "            ArrayClear(new_operation_arr['ShipyardsInvolvedId']);",
              "            UpdateSidePowers();",
              "        }",
              "        else //Игрок выбрал из списка конкретную планету",
              "        {",
              "            cur_planet = GAnswerData;",
              "",
              "            //Считаем цену постройки военного на данной планете (чем более продвинута планета по ГТУ, тем дороже обойдётся постройка)",
              "            tint1 = CalcBuildWarriorStats(cur_planet, 0);",
              "",
              "            j = FindObjectInArray(new_operation_arr['ShipyardsInvolvedId'], Id(cur_planet));",
              "            if(j == -1) //Планеты ещё нет в списке, добавляем",
              "            {",
              "                ArrayAdd(new_operation_arr['ShipyardsInvolvedId'], Id(cur_planet));",
              "                new_operation_arr['ShipyardsInvolvedId', 0] = tint1 + new_operation_arr['ShipyardsInvolvedId', 0];",
              "                new_operation_arr['OperationCost'] = new_operation_arr['OperationCost'] + tint1;",
              "            }",
              "            else //Планета уже добавлена в список, удаляем",
              "            {",
              "                ArrayDelete(new_operation_arr['ShipyardsInvolvedId'], j);",
              "                new_operation_arr['ShipyardsInvolvedId', 0] = new_operation_arr['ShipyardsInvolvedId', 0] - tint1;",
              "                new_operation_arr['OperationCost'] = new_operation_arr['OperationCost'] - tint1;",
              "            }",
              "",
              "            UpdateSidePowers();",
              "        }",
              "",
              "        GAnswerData = 4;",
              "    }",
              "    else check = 0; //Снимаем блокировку",
              "}",
              "//Выбор места сбора перед атакой",
              "else if(check == -5)",
              "{",
              "    //Если игрок не закрыл экран выбора места сбора",
              "    if(GAnswerData)",
              "    {",
              "        if(~int(GAnswerData)) //В качестве места сбора была выбрана система",
              "        {",
              "            if(new_operation_arr['GatheringPlaceId'] != GAnswerData)",
              "            {",
              "                if(new_operation_arr['GatheringPlaceId'] < 0) //Если ранее была выбрана военная база",
              "                {",
              "                    new_operation_arr['OperationCost'] = new_operation_arr['OperationCost'] + new_operation_arr['GatheringPlaceId'];",
              "",
              "                    new_operation_arr['GatheringPlaceId'] = Id(GAnswerData);",
              "                    UpdateSidePowers();",
              "                }",
              "                else new_operation_arr['GatheringPlaceId'] = Id(GAnswerData);",
              "            }",
              "        }",
              "        else //В качестве места сбора была выбрана текущая ВБ",
              "        {",
              "            if(new_operation_arr['GatheringPlaceId'] > -1) //Если военная база не была выбрана ранее",
              "            {",
              "                i = CalcHireWarriorCost(cur_ruin, 3);",
              "                new_operation_arr['OperationCost'] = new_operation_arr['OperationCost'] + i;",
              "",
              "                new_operation_arr['GatheringPlaceId'] = -i;",
              "                UpdateSidePowers();",
              "            }",
              "        }",
              "    }",
              "",
              "    check = 0; //Снимаем блокировку",
              "}"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  -20,
          "Pos.y":  0,
          "Parent":  111,
          "#":  112,
          "Total.Lines":  6,
          "Code.Type":  "Turn",
          "Code":          
          [
              "//В эту группу попадают всякие случайные мудаки (пираты), рандомно нападающие на атакующих военных",
              "//Data0 - таймер до автоматического вывода данного корабля из группы",
              "if(GetData(0))",
              "{",
              "    if(GetData(0) <= CurTurn()) ShipOut(CurShip);",
              "}"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  91,
          "#":  116,
          "Total.Lines":  5,
          "Code.Type":  "Turn",
          "Code":          
          [
              "tstr1 = '</color>' + Format(CT(dialog_path + '.WBRequestOperationNo'),",
              "                              '<PlayerRank'+'>', player_str_rank,",
              "                              '');",
              "tstr2 = '</color>' + CT(dialog_path + '.PlayerRequestOperationNo');",
              "operation_lvl = -1;"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  126,
          "#":  118,
          "Total.Lines":  20,
          "Code.Type":  "Turn",
          "Code":          
          [
              "cur_ship = CurShip;",
              "SetData(-2, 0, cur_ship);",
              "",
              "player_rank = ShipRank(Player());",
              "if(player_rank >= 7) player_str_rank = lowercase(CT('Rank.Admiral.Name')); //Адмирал",
              "else if(player_rank == 6) player_str_rank = lowercase(CT('Rank.Commander.Name')); //Командор",
              "else if(player_rank == 5) player_str_rank = lowercase(CT('Rank.Ace.Name')); //Ас (Пилот)",
              "else if(player_rank == 4) player_str_rank = lowercase(CT('Rank.Leader.Name')); //Истребитель",
              "else /*if(player_rank == 3)*/ player_str_rank = lowercase(CT('Rank.Wingman.Name')); //Капитан",
              "",
              "if(ShipType(cur_ship) != 'Dreadnought') tstr1 = CT('Script.Mod_ShuWarriors.BattleshipDeclension');",
              "else tstr1 = CT('Script.Mod_ShuWarriors.DreadnoughtDeclension');",
              "tstr1 = '</color>' + Format(CT('Script.Mod_ShuWarriors.OperationFlagshipDialog.FlagshipAskDirectControl'),",
              "                               '<PlayerRank'+'>', player_str_rank,",
              "                               '<Flagship'+'>', '<color=0,50,200>' + Name(cur_ship) + '</color>',",
              "                               '<FlagshipShort'+'>', '<color=0,50,200>' + ShipName(cur_ship) + '</color>',",
              "                               '<FlagshipDeclension'+'>', '<color=0,50,200>' + tstr1 + ' ' + ShipName(cur_ship) + '</color>',",
              "                               '');",
              "tstr2 = '</color>' + CT('Script.Mod_ShuWarriors.OperationFlagshipDialog.PlayerDirectControlYes');",
              "tstr3 = '</color>' + CT('Script.Mod_ShuWarriors.OperationFlagshipDialog.PlayerDirectControlNo');"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  -20,
          "Pos.y":  0,
          "Parent":  123,
          "#":  124,
          "Total.Lines":  8,
          "Code.Type":  "Turn",
          "Code":          
          [
              "tstr1 = '</color>' + Format(CT('Script.Mod_ShuWarriors.OperationFlagshipDialog.FlagshipAskDirectControlYes'),",
              "                               '<PlayerRank'+'>', player_str_rank,",
              "                               '<Flagship'+'>', '<color=0,50,200>' + Name(cur_ship) + '</color>',",
              "                               '<FlagshipShort'+'>', '<color=0,50,200>' + ShipName(cur_ship) + '</color>',",
              "                               '');",
              "tstr2 = '</color>' + CT('Talk.Exit');",
              "",
              "OrderLanding(Player(), cur_ship);"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  125,
          "#":  127,
          "Total.Lines":  34,
          "Code.Type":  "Turn",
          "Code":          
          [
              "cur_ship = GetTalkShip();",
              "SetData(-2, 0, cur_ship); //На всякий случай",
              "",
              "player_rank = ShipRank(Player());",
              "if(player_rank >= 7) player_str_rank = lowercase(CT('Rank.Admiral.Name')); //Адмирал",
              "else if(player_rank == 6) player_str_rank = lowercase(CT('Rank.Commander.Name')); //Командор",
              "else if(player_rank == 5) player_str_rank = lowercase(CT('Rank.Ace.Name')); //Ас (Пилот)",
              "else if(player_rank == 4) player_str_rank = lowercase(CT('Rank.Leader.Name')); //Истребитель",
              "else /*if(player_rank == 3)*/ player_str_rank = lowercase(CT('Rank.Wingman.Name')); //Капитан",
              "",
              "if(HullDamage(cur_ship) < 85)",
              "{",
              "    tstr1 = '</color>' + Format(CT('Script.Mod_ShuWarriors.OperationFlagshipDialog.FlagshipDirectControlYes'),",
              "                                   '<PlayerRank'+'>', player_str_rank,",
              "                                   '<Flagship'+'>', '<color=0,50,200>' + Name(cur_ship) + '</color>',",
              "                                   '<FlagshipShort'+'>', '<color=0,50,200>' + ShipName(cur_ship) + '</color>',",
              "                                   '');",
              "    tstr2 = '</color>' + CT('Talk.Exit');",
              "",
              "    OrderLanding(Player(), cur_ship);",
              "    OrderLock(cur_ship, 1);",
              "    OrderFollowShip(cur_ship, Player(), 0);",
              "    SetData(0, 1, cur_ship); //На всякий случай обнуляем приказ атаки конкретной цели",
              "    ShipFreeFlight(cur_ship, 1);",
              "}",
              "else //Флагман откажет игроку в прямом управлении, поскольку имеет критические повреждения",
              "{",
              "    tstr1 = '</color>' + Format(CT('Script.Mod_ShuWarriors.OperationFlagshipDialog.FlagshipDirectControlNo'),",
              "                                   '<PlayerRank'+'>', player_str_rank,",
              "                                   '<Flagship'+'>', '<color=0,50,200>' + Name(cur_ship) + '</color>',",
              "                                   '<FlagshipShort'+'>', '<color=0,50,200>' + ShipName(cur_ship) + '</color>',",
              "                                   '');",
              "    tstr2 = '</color>' + CT('Talk.Exit');",
              "}"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  131,
          "#":  132,
          "Total.Lines":  100,
          "Code.Type":  "Turn",
          "Code":          
          [
              "//Игрока выгоняют с флагмана за плохое поведение или потому, что бой в системе подошёл к концу",
              "dword flagship = cur_ship;",
              "dword star = ShipStar(Player());",
              "",
              "player_rank = ShipRank(Player());",
              "if(player_rank >= 7) player_str_rank = lowercase(CT('Rank.Admiral.Name')); //Адмирал",
              "else if(player_rank == 6) player_str_rank = lowercase(CT('Rank.Commander.Name')); //Командор",
              "else if(player_rank == 5) player_str_rank = lowercase(CT('Rank.Ace.Name')); //Ас (Пилот)",
              "else if(player_rank == 4) player_str_rank = lowercase(CT('Rank.Leader.Name')); //Истребитель",
              "else /*if(player_rank == 3)*/ player_str_rank = lowercase(CT('Rank.Wingman.Name')); //Капитан",
              "",
              "if(RelationToShip(flagship, Player()) > 9) //Игрока выгоняют, потому что подошло время",
              "{",
              "    tstr1 = '</color>' + Format(CT('Script.Mod_ShuWarriors.OperationFlagshipDialog.FlagshipPlayerFliesOut'),",
              "                                   '<PlayerRank'+'>', player_str_rank,",
              "                                   '<Flagship'+'>', '<color=0,50,200>' + Name(flagship) + '</color>',",
              "                                   '<FlagshipShort'+'>', '<color=0,50,200>' + ShipName(flagship) + '</color>',",
              "                                   '<Star'+'>', '<color=0,50,200>' + Name(star) + '</color>',",
              "                                   '');",
              "    tstr2 = '</color>' + CT('Script.Mod_ShuWarriors.OperationFlagshipDialog.PlayerFliesOut');",
              "",
              "    //Чинится, по сути, корабль игрока, а не флагман",
              "    HullHP(flagship, 'To100');",
              "    if(ShipFuelLow(flagship)) ShipRefuel(flagship);",
              "    for(i = ShipItems(flagship) - 1; i >= 1; i = i - 1)",
              "    {",
              "        dword cur_item = ShipItems(flagship, 1);",
              "        //Чинят только стандартную оборудку",
              "        if(ItemType(cur_item) >= t_Weapon13 && ItemType(cur_item) <= t_Weapon15) continue;",
              "        else if(ItemType(cur_item) == t_CustomWeapon)",
              "        {",
              "            if(GetCustomWeaponData(CustomWeaponType(cur_item), 'Availability') == 'NotSoldAndNodeRepair') continue;",
              "        }",
              "",
              "        ItemDurability(cur_item, max(ItemDurability(cur_item), RndObject(75, 85, flagship)));",
              "    }",
              "",
              "    check = 1;",
              "}",
              "else //Игрока выгоняют за плохое поведение",
              "{",
              "    tstr1 = '</color>' + Format(CT('Script.Mod_ShuWarriors.OperationFlagshipDialog.FlagshipPlayerKickedOut'),",
              "                                   '<PlayerRank'+'>', player_str_rank,",
              "                                   '<Flagship'+'>', '<color=0,50,200>' + Name(flagship) + '</color>',",
              "                                   '<FlagshipShort'+'>', '<color=0,50,200>' + ShipName(flagship) + '</color>',",
              "                                   '<Star'+'>', '<color=0,50,200>' + Name(star) + '</color>',",
              "                                   '');",
              "",
              "    if(Rnd(1, 100, GetObjectGenerationSeed(GalaxyPtr()) + sqr(CurTurn())) <= 33) //Игроку удалость бежать",
              "    {",
              "        tstr2 = '</color>' + CT('Script.Mod_ShuWarriors.OperationFlagshipDialog.PlayerKickedOutRun');",
              "        check = 2;",
              "    }",
              "    else //Игрока застрелили",
              "    {",
              "        tstr2 = '</color>' + CT('Script.Mod_ShuWarriors.OperationFlagshipDialog.PlayerKickedOutDead');",
              "        check = 0;",
              "    }",
              "}",
              "",
              "if(check)",
              "{",
              "    TransferShip(flagship, star);",
              "    ShipSetCoords(flagship, CoordX(Player()), CoordY(Player()));",
              "    ShipAngle(flagship, ShipAngle(Player()));",
              "    OrderLock(flagship, 0);",
              "    int oper_num = GetData(3, flagship);",
              "    for(int i = ArrayDim(GlobalWBOperationsArray[oper_num, 'AlliesForcesId']) - 1; i >= 1; i = i - 1)",
              "    {",
              "        if(GlobalWBOperationsArray[oper_num, 'AlliesForcesId', i] == Id(flagship))",
              "        {",
              "            ArrayDelete(GlobalWBOperationsArray[oper_num, 'AlliesForcesId'], i);",
              "            break;",
              "        }",
              "    }",
              "    ShipOut(flagship);",
              "    ShipFreeFlight(flagship);",
              "    ShipType(flagship, Format(ShipType(flagship), 'Flagship', '', ''));",
              "",
              "    i = ShipCustomShipInfoData(Player(), 'ShuWarriors_FlagshipDirectControl', 2);",
              "    ShipSpecialBonuses(Player(), bonSkill1, ShipSpecialBonuses(Player(), bonSkill1) + i);",
              "    ShipSpecialBonuses(Player(), bonSkill2, ShipSpecialBonuses(Player(), bonSkill2) + i);",
              "    CapitalShipStats(Player(), 0);",
              "    TransformShipsIntoEachOther(Player(), flagship);",
              "    if(!findsubstr(ShipType(flagship), 'Warrior')) ShipType(flagship, '');",
              "    else ShipType(flagship, 'Dreadnought');",
              "    ShipDeleteCustomShipInfo(Player(), 'ShuWarriors_FlagshipDirectControl');",
              "",
              "    //На случай, если был подключён ExpScienceRanks и игрок садился на флагман на \"Клеще\"",
              "    if(!findsubstr(BonusNumInCfg(HullSpecial(Player())), 'ExpScienceRanks_Tick')) InterfaceState('StarMap', 'TickHullModeSwitcher', 1);",
              "",
              "    for(i = StarPlanets(star) - 1; i >= 0; i = i - 1) NoLanding(StarPlanets(star, i), 0);",
              "    for(i = StarRuins(star) - 1; i >= 0; i = i - 1) NoLanding(StarRuins(star, i), 0);",
              "    NoJump(0);",
              "",
              "    OrderNone(Player());",
              "    ShipOrder(Player(), 5);",
              "    ShipOrder(Player(), 'X', CoordX(Player()));",
              "    ShipOrder(Player(), 'Y', CoordX(Player()));",
              "}"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  20,
          "Pos.y":  0,
          "Parent":  137,
          "#":  138,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "ShipCustomShipInfoData(Player(), 'ShuWarriors_FlagshipDirectControl', 1, -1);"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  141,
          "#":  142,
          "Total.Lines":  9,
          "Code.Type":  "Turn",
          "Code":          
          [
              "//Игрок выбрал ответ на мостике для покидания флагмана",
              "player_rank = ShipRank(Player());",
              "if(player_rank >= 7) player_str_rank = lowercase(CT('Rank.Admiral.Name')); //Адмирал",
              "else if(player_rank == 6) player_str_rank = lowercase(CT('Rank.Commander.Name')); //Командор",
              "else if(player_rank == 5) player_str_rank = lowercase(CT('Rank.Ace.Name')); //Ас (Пилот)",
              "else if(player_rank == 4) player_str_rank = lowercase(CT('Rank.Leader.Name')); //Истребитель",
              "else /*if(player_rank == 3)*/ player_str_rank = lowercase(CT('Rank.Wingman.Name')); //Капитан",
              "",
              "check = MessageBoxYesNo(Format(CT('Script.Mod_ShuWarriors.OperationFlagshipDialog.FlagshipAbandonConfirm'), '<PlayerRank'+'>', player_str_rank, ''));"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  143,
          "#":  145,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "PlayerBridge(3);"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  146,
          "#":  147,
          "Total.Lines":  33,
          "Code.Type":  "Turn",
          "Code":          
          [
              "dword star = ShipStar(Player());",
              "dword flagship = IdToShip(ShipCustomShipInfoData(Player(), 'ShuWarriors_FlagshipDirectControl', 1));",
              "TransferShip(flagship, star);",
              "ShipSetCoords(flagship, CoordX(Player()), CoordY(Player()));",
              "ShipAngle(flagship, ShipAngle(Player()));",
              "OrderLock(flagship, 0);",
              "SetData(-2, 0, flagship);",
              "ShipFreeFlight(flagship);",
              "",
              "i = ShipCustomShipInfoData(Player(), 'ShuWarriors_FlagshipDirectControl', 2);",
              "ShipSpecialBonuses(Player(), bonSkill1, ShipSpecialBonuses(Player(), bonSkill1) + i);",
              "ShipSpecialBonuses(Player(), bonSkill2, ShipSpecialBonuses(Player(), bonSkill2) + i);",
              "CapitalShipStats(Player(), 0);",
              "TransformShipsIntoEachOther(Player(), flagship);",
              "if(!findsubstr(ShipType(flagship), 'Warrior')) ShipType(flagship, '');",
              "else ShipType(flagship, 'Dreadnought');",
              "ShipDeleteCustomShipInfo(Player(), 'ShuWarriors_FlagshipDirectControl');",
              "",
              "//На случай, если был подключён ExpScienceRanks и игрок садился на флагман на \"Клеще\"",
              "if(!findsubstr(BonusNumInCfg(HullSpecial(Player())), 'ExpScienceRanks_Tick')) InterfaceState('StarMap', 'TickHullModeSwitcher', 1);",
              "",
              "for(int i = StarPlanets(star) - 1; i >= 0; i = i - 1) NoLanding(StarPlanets(star, i), 0);",
              "for(i = StarRuins(star) - 1; i >= 0; i = i - 1) NoLanding(StarRuins(star, i), 0);",
              "NoJump(0);",
              "",
              "Sound('Sound.ForsageOn');",
              "TransferShip(Player(), star);",
              "OrderNone(Player());",
              "ShipOrder(Player(), 5);",
              "ShipOrder(Player(), 'X', CoordX(Player()));",
              "ShipOrder(Player(), 'Y', CoordX(Player()));",
              "FormChange('StarMap');",
              "ForceNextDay();"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  -20,
          "Pos.y":  0,
          "Parent":  134,
          "#":  149,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "FormChange('StarMap');"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  150,
          "#":  151,
          "Total.Lines":  34,
          "Code.Type":  "Turn",
          "Code":          
          [
              "cur_ship = GetTalkShip();",
              "",
              "player_rank = ShipRank(Player());",
              "if(player_rank >= 7) player_str_rank = lowercase(CT('Rank.Admiral.Name')); //Адмирал",
              "else if(player_rank == 6) player_str_rank = lowercase(CT('Rank.Commander.Name')); //Командор",
              "else if(player_rank == 5) player_str_rank = lowercase(CT('Rank.Ace.Name')); //Ас (Пилот)",
              "else if(player_rank == 4) player_str_rank = lowercase(CT('Rank.Leader.Name')); //Истребитель",
              "else /*if(player_rank == 3)*/ player_str_rank = lowercase(CT('Rank.Wingman.Name')); //Капитан",
              "",
              "if(!GAnswerData) //Указание новой цели",
              "{",
              "    tstr1 = '</color>' + Format(CT('Script.Mod_ShuWarriors.OperationWarriorDialog.WarriorWhatTarget'),",
              "                               '<PlayerRank'+'>', player_str_rank,",
              "                               '');",
              "}",
              "else //if(GAnswerData == 1) //Отмена установленной ранее цели",
              "{",
              "    target_Id = GetData(1, cur_ship);",
              "    check = 0;",
              "    for(i = ArrayDim(GlobalWBOperationsArray[operation_num, 'AlliesForcesId']) - 1; i >= 1; i = i - 1)",
              "    {",
              "        tdwd1 = IdToShip(GlobalWBOperationsArray[operation_num, 'AlliesForcesId', i]);",
              "        if(target_Id == GetData(1, tdwd1)) //Если ещё хотя бы один военный из группы имеет приказ атаковать ту же цель",
              "        {",
              "            check = 1;",
              "            break;",
              "        }",
              "    }",
              "",
              "    tstr1 = '</color>' + Format(CT('Script.Mod_ShuWarriors.OperationWarriorDialog.WarriorCancelConfirm'),",
              "                               '<PlayerRank'+'>', player_str_rank,",
              "                               '');",
              "    if(check) tstr1 = tstr1 + Format('<br>') + CT('Script.Mod_ShuWarriors.OperationWarriorDialog.WarriorCancelConfirmAll');",
              "}"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  152,
          "#":  153,
          "Total.Lines":  27,
          "Code.Type":  "Turn",
          "Code":          
          [
              "if(!GAnswerData) //Указание новой цели",
              "{",
              "    j = ShipNearbyShips(cur_ship, -1, 0, 1+2+8+128+4096, '', '');",
              "    for(i = 1; i < j; i = i + 1)",
              "    {",
              "        tdwd1 = ShipNearbyShips(cur_ship, i, 1, 1+2+8+128+4096, '', '');",
              "        if(ShipStanding(tdwd1) && ShipStanding(tdwd1) <= 5) continue;",
              "        InjectAnswer('OperationWarriorSetTargetDialog', Format(CT('Script.Mod_ShuWarriors.OperationWarriorDialog.PlayerTarget'), '<Target'+'>', Name(tdwd1) + '<Object=' + tdwd1 + ',23,17,0>'), tdwd1);",
              "    }",
              "",
              "    DAnswer('restart~' + CT('Script.Mod_ShuWarriors.OperationWarriorDialog.PlayerBack')); //Отставить",
              "    DAnswer('fastexit~' + CT('Talk.Exit')); //Конец связи",
              "}",
              "else //if(GAnswerData == 1) //Отмена установленной ранее цели",
              "{",
              "    SetData(0, 1, cur_ship); //Отменяем цель",
              "    OrderLock(cur_ship, 0);",
              "    ShipFreeFlight(cur_ship);",
              "",
              "    if(!check) DAnswer('fastexit~' + CT('Talk.Exit')); //Конец связи",
              "    else",
              "    {",
              "        tdwd1 = target_Id;",
              "        InjectAnswer('', CT('Script.Mod_ShuWarriors.OperationWarriorDialog.PlayerCancelSendOthers'), 1, 'DialogAttach(1);'); //Передать приказ остальным",
              "        DAnswer('fastexit~' + CT('Script.Mod_ShuWarriors.OperationWarriorDialog.PlayerCancelPersonalOrder')); //Конец связи",
              "    }",
              "}"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  154,
          "#":  155,
          "Total.Lines":  29,
          "Code.Type":  "Turn",
          "Code":          
          [
              "target_Id = Id(GAnswerData);",
              "",
              "check = 0;",
              "for(i = ArrayDim(GlobalWBOperationsArray[operation_num, 'AlliesForcesId']) - 1; i >= 1; i = i - 1)",
              "{",
              "    tdwd1 = IdToShip(GlobalWBOperationsArray[operation_num, 'AlliesForcesId', i]);",
              "    if(target_Id != GetData(1, tdwd1)) //Если ещё хотя бы один военный из группы имеет приказ атаковать ту же цель",
              "    {",
              "        check = 1;",
              "        break;",
              "    }",
              "}",
              "",
              "if(GetData(1, cur_ship) != target_Id)",
              "{",
              "    tstr1 = '</color>' + Format(CT('Script.Mod_ShuWarriors.OperationWarriorDialog.WarriorTargetConfirm'),",
              "                                   '<PlayerRank'+'>', player_str_rank,",
              "                                   '<Target'+'>', '<color=0,50,200>' + Name(GAnswerData) + '</color>',",
              "                                   '');",
              "    if(check) tstr1 = tstr1 + Format('<br>') + CT('Script.Mod_ShuWarriors.OperationWarriorDialog.WarriorTargetConfirmAll');",
              "}",
              "else",
              "{",
              "    tstr1 = '</color>' + Format(CT('Script.Mod_ShuWarriors.OperationWarriorDialog.WarriorTargetConfirmAgain'),",
              "                                   '<PlayerRank'+'>', player_str_rank,",
              "                                   '<Target'+'>', '<color=0,50,200>' + Name(GAnswerData) + '</color>',",
              "                                   '');",
              "    if(check) tstr1 = tstr1 + Format('<br>') + CT('Script.Mod_ShuWarriors.OperationWarriorDialog.WarriorTargetConfirmAllAgain');",
              "}"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  156,
          "#":  157,
          "Total.Lines":  11,
          "Code.Type":  "Turn",
          "Code":          
          [
              "SetData(target_Id, 1, cur_ship); //Задаём военному новую цель",
              "OrderLock(cur_ship, 1);",
              "OrderFollowShip(cur_ship, GAnswerData, 1);",
              "",
              "if(!check) DAnswer('fastexit~' + CT('Talk.Exit')); //Конец связи",
              "else",
              "{",
              "    tdwd1 = target_Id;",
              "    InjectAnswer('', CT('Script.Mod_ShuWarriors.OperationWarriorDialog.PlayerTargetSendOthers'), 0, 'DialogAttach(0);'); //Передать приказ остальным",
              "    DAnswer('fastexit~' + CT('Script.Mod_ShuWarriors.OperationWarriorDialog.PlayerTargetPersonalOrder')); //Конец связи",
              "}"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  260,
          "Pos.y":  70,
          "Parent":  -1,
          "#":  159,
          "Total.Lines":  31,
          "Code.Type":  "Init",
          "Code":          
          [
              "function DialogAttach(int action = 0)",
              "{",
              "    target_Id = tdwd1;",
              "    if(!action) //Указание новой цели",
              "    {",
              "        cur_ship = IdToShip(tdwd1);",
              "        for(i = ArrayDim(GlobalWBOperationsArray[operation_num, 'AlliesForcesId']) - 1; i >= 1; i = i - 1)",
              "        {",
              "            tdwd1 = IdToShip(GlobalWBOperationsArray[operation_num, 'AlliesForcesId', i]);",
              "            if(target_Id != GetData(1, tdwd1)) //Если ещё хотя бы один военный из группы имеет приказ атаковать ту же цель",
              "            {",
              "                SetData(target_Id, 1, tdwd1);",
              "                OrderLock(tdwd1, 1);",
              "                OrderFollowShip(tdwd1, cur_ship, 1);",
              "            }",
              "        }",
              "    }",
              "    else //if(action == 1) //Отмена установленной ранее цели",
              "    {",
              "        for(i = ArrayDim(GlobalWBOperationsArray[operation_num, 'AlliesForcesId']) - 1; i >= 1; i = i - 1)",
              "        {",
              "            tdwd1 = IdToShip(GlobalWBOperationsArray[operation_num, 'AlliesForcesId', i]);",
              "            if(target_Id == GetData(1, tdwd1)) //Если ещё хотя бы один военный из группы имеет приказ атаковать ту же цель",
              "            {",
              "                SetData(0, 1, tdwd1);",
              "                OrderLock(tdwd1, 0);",
              "                ShipFreeFlight(tdwd1);",
              "            }",
              "        }",
              "    }",
              "}"          
          ]        
        },
        {
          "Type":  "Top",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  164,
          "#":  165,
          "Total.Lines":  20,
          "Code.Type":  "Turn",
          "Code":          
          [
              "if(!VarNew)",
              "{",
              "    VarNew = 1;",
              "",
              "    for(i = 0; i < GalaxyStars(); i = i + 1)",
              "    {",
              "        cur_star = GalaxyStar(i);",
              "        for(j = 0; j < StarRuins(cur_star); j = j + 1)",
              "        {",
              "            cur_ruin = StarRuins(cur_star, j);",
              "            str ruin_type = Format(ShipType(cur_ruin), '_licensed', '', '');",
              "            if(ruin_type != 'WB') continue;",
              "    ",
              "            if(ShipFindCustomShipInfoByType(cur_ruin, 'ShuWarriors_MilitaryBaseSpecialLogic') == -1)",
              "            {",
              "                ShipAddCustomShipInfo(cur_ruin, 'ShuWarriors_MilitaryBaseSpecialLogic', 'NoShow');",
              "            }",
              "        }",
              "    }",
              "}"          
          ]        
        }      
      ],
      "Planets":      
      [
        {
          "Type":  "TPlanet",
          "Name":  "InitPlanet",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  3,
          "#":  4,
          "Race":  62,
          "Owner":  62,
          "Economy":  14,
          "Goverment":  62,
          "RangeMin":  0,
          "RangeMax":  100,
          "Dialog":  -1        
        }      
      ],
      "Ships":      
      [
        {
          "Type":  "TStarShip",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  -20,
          "Parent":  3,
          "#":  5,
          "Count":  1,
          "Owner":  62,
          "Ship.Type":  126,
          "Player":  true,
          "SpeedMin":  0,
          "SpeedMax":  10000,
          "Weapon":  0,
          "CargoHook":  0,
          "EmptySpace":  0,
          "StatusTraderMin":  0,
          "StatusTraderMax":  100,
          "StatusWarriorMin":  0,
          "StatusWarriorMax":  100,
          "StatusPirateMin":  0,
          "StatusPirateMax":  100,
          "StrengthMin":  "0",
          "StrengthMax":  "0",
          "Ruins":  ""        
        }      
      ],
      "Stars":      
      [
        {
          "Type":  "TStar",
          "Name":  "InitStar",
          "Pos.x":  300,
          "Pos.y":  290,
          "Parent":  -1,
          "#":  3,
          "Constellation":  0,
          "Priority":  0,
          "NoKling":  false,
          "NoComeKling":  false        
        }      
      ],
      "Statements":      
      [
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  60,
          "Pos.y":  20,
          "Parent":  25,
          "#":  35,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "on_prepare"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  30,
          "Pos.y":  20,
          "Parent":  37,
          "#":  43,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "1"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  37,
          "#":  44,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "1"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  -40,
          "Pos.y":  20,
          "Parent":  50,
          "#":  52,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "new_operation_arr['OrganizedByPlayer'] >= 2"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  -20,
          "Pos.y":  20,
          "Parent":  50,
          "#":  53,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "new_operation_arr['AttackDate'] && ShipMoney(Player()) >= new_operation_arr['OperationCost']"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  20,
          "Pos.y":  20,
          "Parent":  50,
          "#":  54,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "1"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  50,
          "#":  55,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "!new_operation_arr['AttackDate'] || ShipMoney(Player()) < new_operation_arr['OperationCost']"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  20,
          "Pos.y":  0,
          "Parent":  80,
          "#":  68,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "!check"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  40,
          "Parent":  80,
          "#":  69,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "check"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  60,
          "Parent":  86,
          "#":  87,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "!check"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  20,
          "Pos.y":  0,
          "Parent":  47,
          "#":  89,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "1"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  -60,
          "Pos.y":  20,
          "Parent":  25,
          "#":  91,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "!operation_lvl && !on_prepare"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  20,
          "Pos.y":  0,
          "Parent":  86,
          "#":  97,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "check"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  100,
          "Parent":  89,
          "#":  107,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "1"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  63,
          "#":  108,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "1"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  20,
          "Pos.y":  0,
          "Parent":  10,
          "#":  113,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "!ShipIsTakeoff(Player())"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  25,
          "#":  115,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "operation_lvl && !on_prepare"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  -10,
          "Pos.y":  20,
          "Parent":  119,
          "#":  120,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "1"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  10,
          "Pos.y":  20,
          "Parent":  119,
          "#":  121,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "1"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  -20,
          "Pos.y":  20,
          "Parent":  117,
          "#":  125,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "GAnswerData == 1"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  -50,
          "Pos.y":  20,
          "Parent":  117,
          "#":  126,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "!GAnswerData"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  20,
          "Pos.y":  20,
          "Parent":  117,
          "#":  131,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "GAnswerData == 2"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  -10,
          "Pos.y":  20,
          "Parent":  133,
          "#":  135,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "check"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  10,
          "Pos.y":  20,
          "Parent":  133,
          "#":  136,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "!check"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  50,
          "Pos.y":  20,
          "Parent":  117,
          "#":  141,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "GAnswerData == 3"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  142,
          "#":  143,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "!check"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  20,
          "Pos.y":  20,
          "Parent":  142,
          "#":  144,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "check"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  540,
          "Pos.y":  120,
          "Parent":  -1,
          "#":  160,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "new_operation_arr['OrganizedByPlayer'] >= 2 || new_operation_arr['AttackDate']"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  560,
          "Pos.y":  120,
          "Parent":  -1,
          "#":  161,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "new_operation_arr['OrganizedByPlayer'] <= 1 && !new_operation_arr['AttackDate']"          
          ]        
        },
        {
          "Type":  "Tif",
          "Name":  "",
          "Pos.x":  580,
          "Pos.y":  120,
          "Parent":  -1,
          "#":  162,
          "Total.Lines":  1,
          "Code.Type":  "Turn",
          "Code":          
          [
              "1"          
          ]        
        }      
      ],
      "States":      
      [
        {
          "Type":  "TState",
          "Name":  "PlayerGroup",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  6,
          "#":  7,
          "Move":  0,
          "MoveObj":  -1,
          "Attack.Count":  0,
          "TakeItem":  -1,
          "TakeAllItem":  false,
          "OnTalk":  "",
          "OnActCode":  "[t_OnChameleonConfusion,t_OnStep|11]\r\nPlayerActCode();",
          "EType":  1,
          "EUnique":  "",
          "EMsg":  ""        
        },
        {
          "Type":  "TState",
          "Name":  "WBOnPrepare",
          "Pos.x":  -130,
          "Pos.y":  0,
          "Parent":  26,
          "#":  27,
          "Move":  5,
          "MoveObj":  -1,
          "Attack.Count":  1,
          "Attack.Items":          
          [
            {
              "Target.0":  110            
            }          
          ],
          "TakeItem":  -1,
          "TakeAllItem":  false,
          "OnTalk":  "",
          "OnActCode":  "",
          "EType":  1,
          "EUnique":  "",
          "EMsg":  ""        
        },
        {
          "Type":  "TState",
          "Name":  "WBOnAttack",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  27,
          "#":  29,
          "Move":  5,
          "MoveObj":  -1,
          "Attack.Count":  1,
          "Attack.Items":          
          [
            {
              "Target.0":  110            
            }          
          ],
          "TakeItem":  -1,
          "TakeAllItem":  false,
          "OnTalk":  "",
          "OnActCode":  "",
          "EType":  1,
          "EUnique":  "",
          "EMsg":  ""        
        },
        {
          "Type":  "TState",
          "Name":  "WarriorsOnPrepare",
          "Pos.x":  -130,
          "Pos.y":  0,
          "Parent":  28,
          "#":  30,
          "Move":  5,
          "MoveObj":  -1,
          "Attack.Count":  1,
          "Attack.Items":          
          [
            {
              "Target.0":  110            
            }          
          ],
          "TakeItem":  -1,
          "TakeAllItem":  false,
          "OnTalk":  "",
          "OnActCode":  "[t_OnDeath|]\r\nAttackWarriorsActCode();",
          "EType":  1,
          "EUnique":  "",
          "EMsg":  ""        
        },
        {
          "Type":  "TState",
          "Name":  "WarriorsOnAttack",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  30,
          "#":  32,
          "Move":  5,
          "MoveObj":  -1,
          "Attack.Count":  1,
          "Attack.Items":          
          [
            {
              "Target.0":  110            
            }          
          ],
          "TakeItem":  -1,
          "TakeAllItem":  false,
          "OnTalk":  "",
          "OnActCode":  "[t_OnDeath|]\r\nAttackWarriorsActCode();",
          "EType":  1,
          "EUnique":  "",
          "EMsg":  ""        
        },
        {
          "Type":  "TState",
          "Name":  "RandomAttackersState",
          "Pos.x":  -130,
          "Pos.y":  0,
          "Parent":  110,
          "#":  111,
          "Move":  5,
          "MoveObj":  -1,
          "Attack.Count":  0,
          "TakeItem":  -1,
          "TakeAllItem":  false,
          "OnTalk":  "",
          "OnActCode":  "",
          "EType":  1,
          "EUnique":  "",
          "EMsg":  ""        
        }      
      ],
      "Variables":      
      [
        {
          "Type":  "TVar",
          "Name":  "i",
          "Pos.x":  60,
          "Pos.y":  0,
          "Parent":  11,
          "#":  1,
          "Var.Type":  "Int",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "EliteWarriorsSpawnTimer",
          "Pos.x":  -20,
          "Pos.y":  -20,
          "Parent":  8,
          "#":  2,
          "Var.Type":  "Int",
          "Init":  "0",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "tstr1",
          "Pos.x":  100,
          "Pos.y":  -20,
          "Parent":  14,
          "#":  11,
          "Var.Type":  "Str",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "cur_ruin",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  20,
          "#":  12,
          "Var.Type":  "Dword",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "check",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  22,
          "#":  13,
          "Var.Type":  "Int",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "cur_star",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  82,
          "#":  14,
          "Var.Type":  "Dword",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "j",
          "Pos.x":  30,
          "Pos.y":  0,
          "Parent":  1,
          "#":  15,
          "Var.Type":  "Int",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "cur_ship",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  12,
          "#":  16,
          "Var.Type":  "Dword",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "tstr2",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  11,
          "#":  17,
          "Var.Type":  "Str",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "tstr3",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  17,
          "#":  18,
          "Var.Type":  "Str",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "tdwd1",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  158,
          "#":  19,
          "Var.Type":  "Dword",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "cur_planet",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  14,
          "#":  20,
          "Var.Type":  "Dword",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "tint1",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  1,
          "#":  21,
          "Var.Type":  "Int",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "rand",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  21,
          "#":  22,
          "Var.Type":  "Int",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "waitingTimer",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  19,
          "#":  23,
          "Var.Type":  "Dword",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "tarr1",
          "Pos.x":  100,
          "Pos.y":  0,
          "Parent":  1,
          "#":  24,
          "Var.Type":  "Array",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "operation_lvl",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  73,
          "#":  34,
          "Var.Type":  "Int",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "on_prepare",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  34,
          "#":  39,
          "Var.Type":  "Int",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "dialog_path",
          "Pos.x":  510,
          "Pos.y":  290,
          "Parent":  -1,
          "#":  40,
          "Var.Type":  "Str",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "player_str_rank",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  42,
          "#":  41,
          "Var.Type":  "Str",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "player_rank",
          "Pos.x":  670,
          "Pos.y":  290,
          "Parent":  -1,
          "#":  42,
          "Var.Type":  "Int",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "tstr4",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  18,
          "#":  48,
          "Var.Type":  "Str",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "split_str",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  94,
          "#":  70,
          "Var.Type":  "Str",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "indent_str",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  70,
          "#":  71,
          "Var.Type":  "Str",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "operation_num",
          "Pos.x":  410,
          "Pos.y":  290,
          "Parent":  -1,
          "#":  73,
          "Var.Type":  "Int",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "GlobalWBOperationsArray",
          "Pos.x":  330,
          "Pos.y":  230,
          "Parent":  -1,
          "#":  74,
          "Var.Type":  "Array",
          "Init":  "1",
          "Global":  true        
        },
        {
          "Type":  "TVar",
          "Name":  "cost",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  13,
          "#":  75,
          "Var.Type":  "Dword",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "tstr5",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  48,
          "#":  76,
          "Var.Type":  "Str",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "tstr6",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  76,
          "#":  77,
          "Var.Type":  "Str",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "tstr7",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  77,
          "#":  78,
          "Var.Type":  "Str",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "tstr8",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  78,
          "#":  79,
          "Var.Type":  "Str",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "ships_available",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  40,
          "#":  81,
          "Var.Type":  "Int",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "cur_sector",
          "Pos.x":  410,
          "Pos.y":  420,
          "Parent":  -1,
          "#":  82,
          "Var.Type":  "Dword",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "coals_power_percent",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  81,
          "#":  83,
          "Var.Type":  "Int",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "min_coals_power_percent",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  83,
          "#":  84,
          "Var.Type":  "Int",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "stars_to_attack_arr",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  24,
          "#":  90,
          "Var.Type":  "Array",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "tstr9",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  79,
          "#":  94,
          "Var.Type":  "Str",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "militaries_arr",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  90,
          "#":  95,
          "Var.Type":  "Array",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "new_operation_arr",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  95,
          "#":  96,
          "Var.Type":  "Array",
          "Init":  "[0]",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "stars_cnt_to_choose",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  41,
          "#":  98,
          "Var.Type":  "Int",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "coals_cnt",
          "Pos.x":  810,
          "Pos.y":  290,
          "Parent":  -1,
          "#":  99,
          "Var.Type":  "Int",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "big_coals_cnt",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  99,
          "#":  100,
          "Var.Type":  "Int",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "coals_power",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  100,
          "#":  101,
          "Var.Type":  "Float",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "enemies_cnt",
          "Pos.x":  0,
          "Pos.y":  30,
          "Parent":  104,
          "#":  102,
          "Var.Type":  "Int",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "enemies_power",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  102,
          "#":  103,
          "Var.Type":  "Float",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "average_warrior_power",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  101,
          "#":  104,
          "Var.Type":  "Int",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "max_coals_power_percent",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  84,
          "#":  105,
          "Var.Type":  "Int",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "min_warriors_to_add_WB",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  105,
          "#":  106,
          "Var.Type":  "Int",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "k",
          "Pos.x":  30,
          "Pos.y":  0,
          "Parent":  15,
          "#":  109,
          "Var.Type":  "Int",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "PlayerUsedCamo",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  7,
          "#":  130,
          "Var.Type":  "Int",
          "Init":  "-1",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "target_Id",
          "Pos.x":  0,
          "Pos.y":  20,
          "Parent":  16,
          "#":  158,
          "Var.Type":  "Dword",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "hull_no_drop_mark",
          "Pos.x":  300,
          "Pos.y":  390,
          "Parent":  -1,
          "#":  163,
          "Var.Type":  "Int",
          "Init":  "",
          "Global":  false        
        },
        {
          "Type":  "TVar",
          "Name":  "VarNew",
          "Pos.x":  740,
          "Pos.y":  160,
          "Parent":  -1,
          "#":  164,
          "Var.Type":  "Int",
          "Init":  "0",
          "Global":  false        
        }      
      ]    
    }  
  ],
  "Visual.Links":  
  [
    {
      "Type":  "TGraphLink",
      "Begin":  4,
      "End":  3,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  5,
      "End":  3,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  6,
      "End":  4,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  6,
      "End":  7,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  26,
      "End":  4,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  28,
      "End":  4,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  30,
      "End":  31,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  32,
      "End":  33,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  28,
      "End":  30,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  35,
      "End":  36,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  36,
      "End":  38,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  37,
      "End":  43,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  43,
      "End":  45,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  37,
      "End":  44,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  44,
      "End":  46,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  46,
      "End":  49,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  45,
      "End":  51,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  50,
      "End":  52,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  50,
      "End":  53,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  50,
      "End":  54,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  50,
      "End":  55,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  52,
      "End":  56,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  53,
      "End":  57,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  55,
      "End":  58,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  54,
      "End":  59,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  59,
      "End":  60,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  60,
      "End":  61,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  57,
      "End":  62,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  62,
      "End":  63,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  56,
      "End":  64,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  64,
      "End":  65,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  65,
      "End":  66,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  68,
      "End":  50,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  69,
      "End":  64,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  67,
      "End":  80,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  80,
      "End":  68,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  80,
      "End":  69,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  85,
      "End":  86,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  86,
      "End":  87,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  87,
      "End":  64,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  61,
      "End":  88,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  47,
      "End":  89,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  92,
      "End":  93,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  86,
      "End":  97,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  97,
      "End":  80,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  89,
      "End":  107,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  107,
      "End":  88,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  63,
      "End":  108,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  108,
      "End":  88,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  110,
      "End":  4,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  110,
      "End":  111,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  111,
      "End":  112,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  26,
      "End":  27,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  113,
      "End":  9,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  38,
      "End":  114,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  25,
      "End":  35,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  25,
      "End":  91,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  25,
      "End":  115,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  115,
      "End":  72,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  91,
      "End":  116,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  116,
      "End":  92,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  72,
      "End":  37,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  118,
      "End":  119,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  119,
      "End":  120,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  119,
      "End":  121,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  120,
      "End":  123,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  121,
      "End":  122,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  117,
      "End":  126,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  117,
      "End":  125,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  126,
      "End":  118,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  125,
      "End":  127,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  127,
      "End":  128,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  128,
      "End":  129,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  117,
      "End":  131,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  131,
      "End":  132,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  132,
      "End":  133,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  133,
      "End":  135,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  135,
      "End":  134,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  133,
      "End":  136,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  136,
      "End":  137,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  137,
      "End":  138,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  123,
      "End":  124,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  124,
      "End":  139,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  139,
      "End":  140,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  117,
      "End":  141,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  141,
      "End":  142,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  142,
      "End":  143,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  143,
      "End":  145,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  142,
      "End":  144,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  146,
      "End":  147,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  147,
      "End":  148,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  144,
      "End":  146,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  134,
      "End":  149,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  150,
      "End":  151,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  151,
      "End":  152,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  154,
      "End":  155,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  155,
      "End":  156,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  152,
      "End":  153,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  156,
      "End":  157,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  49,
      "End":  160,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  160,
      "End":  50,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  49,
      "End":  161,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  161,
      "End":  47,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  51,
      "End":  162,
      "Nom":  0,
      "Arrow":  true    
    },
    {
      "Type":  "TGraphLink",
      "Begin":  162,
      "End":  47,
      "Nom":  0,
      "Arrow":  true    
    }  
  ],
  "BlockPar.EC.Total.Strings":  2,
  "BlockPar.EC":  
  [
    {
      "#":  "41",
      "String":  "<0>"    
    },
    {
      "#":  "42",
      "String":  ""    
    }  
  ]
}